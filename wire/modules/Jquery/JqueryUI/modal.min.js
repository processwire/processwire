var pwModalWindows=[];function pwModalWindowSettings(b){var d=ProcessWire.config.modals[b];if(typeof d=="undefined"){d=ProcessWire.config.modals.medium}d=d.split(",");var a={modal:true,draggable:false,resizable:true,hide:250,show:100,hideOverflow:true,closeOnEscape:false};if(d.length>=4){for(var f=4;f<d.length;f++){var e=d[f];if(e.indexOf("=")<1){continue}e=e.split("=");var c=jQuery.trim(e[0]);e=jQuery.trim(e[1].toLowerCase());if(typeof a[c]=="undefined"){continue}if(e=="true"||e=="1"){e=true}else{if(e=="false"||e=="0"){e=false}else{e=parseInt(e)}}a[c]=e}}return{modal:a.modal,draggable:a.draggable,resizable:a.resizable,position:[parseInt(d[0]),parseInt(d[1])],width:jQuery(window).width()-parseInt(d[2]),height:jQuery(window).height()-parseInt(d[3]),hide:a.hide,show:a.show,closeOnEscape:a.closeOnEscape,create:function(g,h){if(a.hideOverflow){parent.jQuery("body").css("overflow","hidden")}var i=jQuery(this).dialog("widget");jQuery(".ui-dialog-titlebar-close",i).css("padding-top",0).prepend("<i class='fa fa-times'></i>").find(".ui-icon").remove();if(frameElement&&parent.jQuery!="undefined"&&parent.jQuery(".ui-dialog").length){parent.jQuery(".ui-dialog .ui-button").addClass("pw-modal-hidden").hide();parent.jQuery(".ui-dialog-buttonpane").css("margin-top","-10px");jQuery("body").css("overflow","hidden")}},beforeClose:function(g,h){if(parent.jQuery!="undefined"&&parent.jQuery(".ui-dialog").length){if(frameElement){parent.jQuery(".pw-modal-hidden").show();jQuery("body").css("overflow","")}else{if(a.hideOverflow){parent.jQuery("body").css("overflow","")}}}}}}function pwModalWindow(c,j,i){for(var e=0;e<=pwModalWindows.length;e++){var h=pwModalWindows[e];if(h==null){continue}if(h.dialog("isOpen")){continue}h.dialog("destroy").remove();pwModalWindows[e]=null}if(c.indexOf("modal=")>0){var b=c}else{var b=c+(c.indexOf("?")>-1?"&":"?")+"modal=1"}var h=jQuery('<iframe class="pw-modal-window" frameborder="0" src="'+b+'"></iframe>');h.attr("id","pw-modal-window-"+(pwModalWindows.length+1));if(typeof i=="undefined"||i.length==0){var i="large"}var f=pwModalWindowSettings(i);if(f==null){alert("Unknown modal setting: "+i);return h}if(typeof j!="undefined"){jQuery.extend(f,j)}h.on("dialogopen",function(k,l){jQuery(document).trigger("pw-modal-opened",{event:k,ui:l})});h.on("dialogclose",function(k,l){jQuery(document).trigger("pw-modal-closed",{event:k,ui:l})});h.dialog(f);h.data("settings",f);h.load(function(){if(typeof f.title=="undefined"||!f.title){h.dialog("option","title",h.contents().find("title").text())}h.contents().find("form").css("-webkit-backface-visibility","hidden")});var d=0;var g=0;function a(){var n=jQuery(window).width();var l=jQuery(window).height();if(n==d&&l==g){return}var m=i;if(n<=960&&i!="full"&&i!="large"){m="large"}if(n<=700&&i!="full"){m="full"}var o=pwModalWindowSettings(m);var p=h.closest(".ui-dialog");if(p.length>0){var k=p.find(".ui-dialog-buttonpane").outerHeight()+p.find(".ui-dialog-titlebar").outerHeight();o.height-=k}h.dialog("option","width",o.width);h.dialog("option","height",o.height);h.dialog("option","position",o.position);h.width(o.width).height(o.height);d=n;g=l}a();jQuery(window).resize(a);h.refresh=function(){d=0;g=0;a()};h.setButtons=function(k){h.dialog("option","buttons",k);h.refresh()};h.setTitle=function(k){h.dialog("option","title",k)};return h}function pwModalOpenEvent(j){var c=jQuery(this);var a=c.attr("data-autoclose");var l=a!=null;var i=l&&a.length>1?a:"";var h=c.attr("data-close");var k=false;var f="medium";if(c.hasClass("pw-modal-large")){f="large"}else{if(c.hasClass("pw-modal-small")){f="small"}else{if(c.hasClass("pw-modal-full")){f="full"}}}var d={title:c.attr("title"),close:function(p,q){var r=typeof p.toElement!="undefined"&&jQuery(p.toElement).hasClass("fa-times");var e={event:p,ui:q,abort:r};c.trigger("modal-close",e);c.trigger("pw-modal-closed",e);jQuery(document).trigger("pw-modal-closed",e);g.remove()}};var o=c.attr("data-buttons");if(h==null){h=""}h+=(h.length>0?", ":"")+".pw-modal-cancel";var g=jQuery("<i class='fa fa-spin fa-spinner fa-2x ui-priority-secondary'></i>").css({position:"absolute",top:(parseInt(jQuery(window).height()/2)-80)+"px",left:(parseInt(jQuery(window).width()/2)-20)+"px","z-index":9999}).hide();var b=c.attr("data-pw-modal-href");if(b&&b.length){}else{if(c.is("button")){var m=c.closest("a");b=m.length?m.attr("href"):c.attr("data-href");if(!b){b=c.find("a").attr("href")}}else{if(c.is("a")){b=c.attr("href")}else{b=c.attr("data-href")}}}if(!b){alert("Unable to find href attribute for: "+c.text());return false}var n=pwModalWindow(b,d,f);jQuery("body").append(g.fadeIn("fast"));setTimeout(function(){c.removeClass("ui-state-active")},500);n.load(function(){var p=[];var r=n.contents();var s=0;g.fadeOut("fast",function(){g.remove()});if(k){if(r.find(".NoticeError, .NoticeWarning, .ui-state-error").length==0){if(typeof Notifications!="undefined"){var e=[];r.find(".NoticeMessage").each(function(){e[e.length]=jQuery(this).text()});if(e.length>0){setTimeout(function(){for(var t=0;t<e.length;t++){Notifications.message(e[t])}},500)}}n.dialog("close");return}}var q=r.find("body");q.hide();if(o){r.find(o).each(function(){var v=jQuery(this);v.find(".ui-button-text").removeClass("ui-button-text");var w=v.html();var u=false;for(var t=0;t<p.length;t++){if(p[t].text==w||w.length<1){u=true}}if(!u){p[s]={html:w,"class":(v.is(".ui-priority-secondary")?"ui-priority-secondary":""),click:function(x){v.click();if(h.length>0&&v.is(h)){n.dialog("close")}if(l){jQuery("body").append(g.fadeIn());if(i.length>1){k=v.is(i)}else{k=true}}}};s++}if(!v.hasClass("pw-modal-button-visible")){v.hide()}})}if(p.length>0){n.setButtons(p)}q.fadeIn("fast",function(){q.show()})});return false}(function(a){a.event.special.pwdoubletap={bindType:"touchend",delegateType:"touchend",handle:function(e){var d=e.handleObj,f=jQuery.data(e.target),c=new Date().getTime(),g=f.lastTouch?c-f.lastTouch:0,b=b==null?300:b;if(g<b&&g>30){f.lastTouch=null;e.type=d.origType;["clientX","clientY","pageX","pageY"].forEach(function(h){e[h]=e.originalEvent.changedTouches[0][h]});d.handler.apply(this,arguments)}else{f.lastTouch=c}}}})(jQuery);function pwModalDoubleClick(){var b=0,d=null,c=false;jQuery(document).on("click",".pw-modal-dblclick a",function(){var e=jQuery(this);if(c){c=false;return true}b++;if(b===1){d=setTimeout(function(){b=0;c=true;e[0].click();return true},700)}else{clearTimeout(d);c=false;b=0;jQuery(this).closest(".pw-modal-dblclick").trigger("dblclick")}return false});jQuery(document).on("dblclick",".pw-modal-dblclick a",function(f){f.stopPropagation();return false});var a=(("ontouchstart" in window)||(navigator.MaxTouchPoints>0)||(navigator.msMaxTouchPoints>0));if(a){jQuery(document).on("pwdoubletap",".pw-modal-dblclick",pwModalOpenEvent)}}jQuery(document).ready(function(a){a.widget("ui.dialog",a.extend({},a.ui.dialog.prototype,{_title:function(b){if(!this.options.title){b.html("&#160;")}else{b.html(this.options.title)}}}));a(document).on("pwdblclick",".pw-modal-dblclick",pwModalOpenEvent);a(document).on("click",".pw-modal:not(.pw-modal-dblclick):not(.pw-modal-longclick)",pwModalOpenEvent);a(document).on("dblclick",".pw-modal-dblclick",pwModalOpenEvent);a(document).on("longclick",".pw-modal-longclick",pwModalOpenEvent);pwModalDoubleClick()});