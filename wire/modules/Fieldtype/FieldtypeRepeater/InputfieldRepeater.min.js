var InputfieldRepeaterDepthSize=50;function InputfieldRepeaterDeleteClick(d){var c=$(this).parent("label").parent("li");if(c.is(".InputfieldRepeaterNewItem")){var a=c.parent().parent().find(".InputfieldRepeaterAddItem").children("input");a.attr("value",parseInt(a.attr("value")-1));c.remove()}else{var b=c.find(".InputfieldRepeaterDelete");if(b.is(":checked")){b.removeAttr("checked");c.children("label").removeClass("ui-state-error").addClass("ui-state-default");c.removeClass("InputfieldRepeaterDeletePending")}else{b.attr("checked","checked");c.children("label").removeClass("ui-state-default").addClass("ui-state-error");if(!c.hasClass("InputfieldStateCollapsed")){c.toggleClass("InputfieldStateCollapsed",100)}c.addClass("InputfieldRepeaterDeletePending")}}InputfieldRepeaterCheckMax(c.closest(".InputfieldRepeater"));d.stopPropagation()}function InputfieldRepeaterDeleteDblClick(c){var d=$(this).closest("li");var a=d.hasClass("InputfieldRepeaterDeletePending");function b(){d.parent().children("li").each(function(){var e=$(this);var f=e.children(".InputfieldHeader").children(".InputfieldRepeaterTrash");if(e.hasClass("InputfieldRepeaterDeletePending")){if(a){f.click()}}else{if(!a){f.click()}}})}if(a){b()}else{ProcessWire.confirm(ProcessWire.config.InputfieldRepeater.labels.removeAll,b)}}function InputfieldRepeaterCloneClick(b){var a=$(this).closest(".InputfieldRepeaterItem");ProcessWire.confirm(ProcessWire.config.InputfieldRepeater.labels.clone,function(){var d=a.attr("data-page");var c=a.closest(".InputfieldRepeater").children(".InputfieldContent").children(".InputfieldRepeaterAddItem").find(".InputfieldRepeaterAddLink:eq(0)");c.attr("data-clone",d).click();$("html, body").animate({scrollTop:c.offset().top-100},250,"swing")});return false}function InputfieldRepeaterToggleClick(f){var d=$(this);var c=d.attr("data-on");var a=d.attr("data-off");var b=d.closest(".InputfieldRepeaterItem");var g=b.find(".InputfieldRepeaterPublish");if(d.hasClass(c)){d.removeClass(c).addClass(a);b.addClass("InputfieldRepeaterUnpublished InputfieldRepeaterOff");g.val("-1")}else{d.removeClass(a).addClass(c);b.removeClass("InputfieldRepeaterUnpublished InputfieldRepeaterOff");g.val("1")}f.stopPropagation()}function InputfieldRepeaterItemOpenReady(c){var a=$(this);var b=a.find(".InputfieldRepeaterLoaded");if(parseInt(b.val())>0){return}a.addClass("InputfieldRepeaterItemLoading")}function InputfieldRepeaterUpdateState(a){if(a.closest(".InputfieldRepeaterRememberOpen").length){var b="";$(".InputfieldRepeaterItem:not(.InputfieldStateCollapsed)").each(function(){var c=parseInt($(this).attr("data-page"));if(c>0){b+=c+"|"}});$.cookie("repeaters_open",b)}}function InputfieldRepeaterCheckMax(d){if(!d.hasClass("InputfieldRepeaterMax")){return}var a=parseInt(d.attr("data-max"));if(a<=0){return}var c=d.children(".InputfieldContent");var b=c.children(".Inputfields").children("li:not(.InputfieldRepeaterDeletePending)").length;var e=c.children(".InputfieldRepeaterAddItem");if(b>a){e.hide()}else{if(!e.is(":visible")){e.show()}}}function InputfieldRepeaterCheckDepths(a){a.find(".InputfieldRepeaterDepth").each(function(){var d=$(this);var e=d.val();var b=d.closest(".InputfieldRepeaterItem");var c=b.css("margin-left");if(c=="auto"){c=0}c=parseInt(c);var f=e*InputfieldRepeaterDepthSize;if(f!=c){b.css("margin-left",f+"px");b.data("lastLeft",f)}})}function InputfieldRepeaterItemClosed(a){InputfieldRepeaterUpdateState($(this))}function InputfieldRepeaterItemOpened(h){var j=$(this);var m=j.find(".InputfieldRepeaterLoaded");InputfieldRepeaterUpdateState(j);if(parseInt(m.val())>0){return}m.val("1");var b=j.find(".InputfieldContent").hide();var d=j.closest(".InputfieldRepeater");var i=d.attr("data-page");var c=parseInt(j.attr("data-page"));var l=d.attr("id");var k=l.replace("wrap_Inputfield_","");var a=ProcessWire.config.InputfieldRepeater.editorUrl+"?id="+i+"&field="+k+"&repeater_edit="+c;var f=j.find(".InputfieldRepeaterDrag");var g=m.closest(".Inputfields");f.removeClass("fa-arrows").addClass("fa-spin fa-spinner");l=l.replace(/_repeater\d+$/,"");$.get(a,function(o){var e=$(o).find("#"+l+" > .InputfieldContent > .Inputfields > .InputfieldRepeaterItem > .InputfieldContent > .Inputfields > .InputfieldWrapper > .Inputfields > .Inputfield");g.append(e);j.removeClass("InputfieldRepeaterItemLoading");InputfieldsInit(g);var n=e.filter(".InputfieldRepeater");if(n.length){n.each(function(){InputfieldRepeaterInit($(this))})}b.slideDown("fast",function(){f.removeClass("fa-spin fa-spinner").addClass("fa-arrows")});setTimeout(function(){g.find(".Inputfield").trigger("reloaded",["InputfieldRepeaterItemEdit"])},50)})}function InputfieldRepeaterAdjustLabel(c,d){var b=c.children("label");var e=b.html();var a=e;if(d&&e.indexOf("#")>-1){num=c.siblings(".InputfieldRepeaterItem:visible").length+1;e=e.replace(/#[0-9]+/,"#"+num)}if(e.indexOf("{")>-1){e=e.replace(/\{/,'<span class="ui-priority-secondary" style="font-weight:normal">');e=e.replace(/}/,"</span>")}if(e!=a){b.html(e)}}function InputfieldRepeaterInit(l){if(l.hasClass("InputfieldRepeaterItem")){var h=l;var b=l.closest(".InputfieldRepeater");var g=true}else{var h=l.find(".Inputfields:eq(0)");var b=l;var g=false}if(h.hasClass("InputfieldRepeaterInit")){return}h.addClass("InputfieldRepeaterInit");var f=h.closest(".InputfieldRenderValueMode").length>0;var k=$("<i class='fa fa-copy InputfieldRepeaterClone'></i>").css("display","block");var i=$("<i class='fa fa-trash InputfieldRepeaterTrash'></i>");var a=$("<i class='fa InputfieldRepeaterToggle' data-on='fa-toggle-on' data-off='fa-toggle-off'></i>");var j=ProcessWire.config.InputfieldRepeater;var e=!b.hasClass("InputfieldRepeaterNoAjaxAdd");if(j){a.attr("title",j.labels.toggle);i.attr("title",j.labels.remove);k.attr("title",j.labels.clone)}$("input.InputfieldRepeaterDelete",l).parents(".InputfieldCheckbox").hide();function m(o){o.each(function(){var r=$(this);if(r.hasClass("InputfieldRepeaterHeaderInit")){return}var q="fa-arrows";var p=r.parent();if(p.hasClass("InputfieldRepeaterNewItem")){q="fa-plus";r.addClass("ui-priority-secondary")}r.addClass("ui-state-default InputfieldRepeaterHeaderInit");r.prepend("<i class='fa fa-fw "+q+" InputfieldRepeaterDrag'></i>");if(!f){if(e){r.prepend(k.clone(true))}r.prepend(a.clone(true).addClass(r.parent().hasClass("InputfieldRepeaterOff")?"fa-toggle-off":"fa-toggle-on"));r.prepend(i.clone(true))}InputfieldRepeaterAdjustLabel(p,false)})}if(g){m(l.children(".InputfieldHeader"))}else{m($(".InputfieldRepeaterItem > .InputfieldHeader",l))}if(f){return}$(".InputfieldRepeaterDrag",l).hover(function(){$(this).parent("label").addClass("ui-state-focus")},function(){$(this).parent("label").removeClass("ui-state-focus")});$(".InputfieldRepeaterTrash",l).hover(function(){var o=$(this).parent("label");if(!o.parent().is(".InputfieldRepeaterDeletePending")){o.addClass("ui-state-error")}},function(){var o=$(this).parent("label");if(!o.parent().is(".InputfieldRepeaterDeletePending")){o.removeClass("ui-state-error")}});if(g){h=l.closest(".InputfieldRepeater").find(".Inputfields:eq(0)")}var d={items:"> li:not(.InputfieldRepeaterNewItem)",handle:".InputfieldRepeaterDrag",start:function(p,o){o.item.find(".InputfieldHeader").addClass("ui-state-highlight");o.item.find("textarea.InputfieldCKEditorNormal.InputfieldCKEditorLoaded").each(function(){$(this).removeClass("InputfieldCKEditorLoaded");var q=CKEDITOR.instances[$(this).attr("id")];q.destroy();CKEDITOR.remove($(this).attr("id"))});o.item.find(".InputfieldTinyMCE textarea").each(function(){tinyMCE.execCommand("mceRemoveControl",false,$(this).attr("id"))})},stop:function(p,o){o.item.find(".InputfieldHeader").removeClass("ui-state-highlight");$(this).children().each(function(q){$(this).find(".InputfieldRepeaterSort").slice(0,1).attr("value",q)});o.item.find("textarea.InputfieldCKEditorNormal:not(.InputfieldCKEditorLoaded)").each(function(){$(this).closest(".InputfieldCKEditor").trigger("reloaded",["InputfieldRepeaterSort"])});o.item.find(".InputfieldTinyMCE textarea").each(function(){tinyMCE.execCommand("mceAddControl",false,$(this).attr("id"))})}};var c=parseInt(b.attr("data-depth"));if(c>0){InputfieldRepeaterCheckDepths(b);d.grid=[InputfieldRepeaterDepthSize,1];d.beforeStop=function(o,p){var r=p.item.data("lastLeft");if(!r){r=0}var q=r+p.position.left;q-=InputfieldRepeaterDepthSize/2;if(q>10&&q<InputfieldRepeaterDepthSize){q=InputfieldRepeaterDepthSize}var s=Math.round(q/InputfieldRepeaterDepthSize);if(s<1){s=0}if(s>c){s=c}if(s){p.item.css("margin-left",(s*InputfieldRepeaterDepthSize)+"px")}else{p.item.css("margin-left",0)}p.item.find(".InputfieldRepeaterDepth").val(s);p.item.data("lastLeft",q);p.item.children(".InputfieldHeader").removeClass("ui-state-error")};d.sort=function(p,q){var s=q.item.data("lastLeft");if(!s){s=0}var r=s+q.position.left;var o=q.item.children(".InputfieldHeader");if(r>(InputfieldRepeaterDepthSize*c)+(InputfieldRepeaterDepthSize/2)){o.addClass("ui-state-error")}else{if(o.hasClass("ui-state-error")){o.removeClass("ui-state-error")}}}}else{d.axis="y"}h.sortable(d);var n=$(".InputfieldRepeaterAddLink:not(.InputfieldRepeaterAddLinkInit)",l);n.addClass("InputfieldRepeaterAddLinkInit");n.click(function(){var q=$(this);var w=$(this).parent("p").prev("ul.Inputfields");var r=$(this).parent().children("input");var v=0;var B=q.attr("data-noajax").length==0;var p=q.attr("data-clone");function z(C){var D=C.attr("id")+"_";while($("#"+D).length>0){D+="_"}C.attr("id",D);w.append(C);C.css("display","block");InputfieldRepeaterAdjustLabel(C,true);q.trigger("repeateradd",[C])}if(typeof p=="undefined"||!p){p=null}if(p){q.removeAttr("data-clone")}if(!B){var s=w.children(".InputfieldRepeaterNewItem");v=s.length;if(v>0){if(v>1){s=s.slice(0,1)}var u=s.clone(true);z(u);r.attr("value",v);InputfieldRepeaterCheckMax(b)}}else{var x=q.closest(".InputfieldRepeater").attr("data-page");var A=q.closest(".InputfieldRepeater").attr("id").replace("wrap_Inputfield_","");var t=q.parent().find(".InputfieldRepeaterSpinner");var o=ProcessWire.config.InputfieldRepeater.editorUrl+"?id="+x+"&field="+A;t.removeClass(t.attr("data-off")).addClass(t.attr("data-on"));if(p){o+="&repeater_clone="+p}else{o+="&repeater_add="+q.attr("data-type")}var y=w.find(".InputfieldRepeaterUnpublished");if(y.length){o+="&repeater_not=";y.each(function(){o+=$(this).attr("data-page")+","})}$.get(o,function(D){t.removeClass(t.attr("data-on")).addClass(t.attr("data-off"));var C=$(D).find(".InputfieldRepeaterItemRequested");if(!C.length){return}z(C);C.wrap("<div />");InputfieldsInit(C.parent());InputfieldRepeaterInit(C);C.unwrap();C.find(".Inputfield").trigger("reloaded",["InputfieldRepeaterItemAdd"]);C.find(".InputfieldRepeaterSort").val(w.children().length);$("html, body").animate({scrollTop:C.offset().top},500,"swing");InputfieldRepeaterUpdateState(C);InputfieldRepeaterCheckMax(b);$nestedRepeaters=C.find(".InputfieldRepeater");if($nestedRepeaters.length){$nestedRepeaters.each(function(){InputfieldRepeaterInit($(this))})}})}return false});if(b.hasClass("InputfieldRepeaterMax")){InputfieldRepeaterCheckMax(b)}}$(document).ready(function(){$(".InputfieldRepeater").each(function(){InputfieldRepeaterInit($(this))});$(document).on("reloaded",".InputfieldRepeater",function(b,c){if(typeof c!="undefined"){if(c=="InputfieldRepeaterItemEdit"||c=="InputfieldRepeaterItemAdd"){b.stopPropagation();var a=$(this).find(".InputfieldRepeater");if(a.length){InputfieldRepeaterInit(a)}return}}InputfieldRepeaterInit($(this))});$(document).on("click",".InputfieldRepeaterTrash",InputfieldRepeaterDeleteClick).on("dblclick",".InputfieldRepeaterTrash",InputfieldRepeaterDeleteDblClick).on("click",".InputfieldRepeaterClone",InputfieldRepeaterCloneClick).on("click",".InputfieldRepeaterToggle",InputfieldRepeaterToggleClick).on("opened",".InputfieldRepeaterItem",InputfieldRepeaterItemOpened).on("closed",".InputfieldRepeaterItem",InputfieldRepeaterItemClosed).on("openReady",".InputfieldRepeaterItem",InputfieldRepeaterItemOpenReady)});