function InputfieldImage(v){var k=null;var b={file:"",item:null,edit:null};var F={type:"image",closeOnContentClick:true,closeBtnInside:true};var c=null;var r=[];function s(){var M=window.File&&window.FileList&&window.FileReader;var L=v(".InputfieldAllowAjaxUpload").length>0;var N=v("#PageIDIndicator").length>0;return(M&&(N||L))}function y(N,L,M){L||(L=250);var O,P;return function(){var S=M||this;var R=+new Date(),Q=arguments;if(O&&R<O+L){clearTimeout(P);P=setTimeout(function(){O=R;N.apply(S,Q)},L)}else{O=R;N.apply(S,Q)}}}function f(M,L){return !L}function B(M){if(M.hasClass("ui-sortable")){M.sortable("destroy");M.children("li").each(function(P){var O=v(this).find("input.InputfieldFileSort");O.val(P)})}var N;var L={items:"> .gridImage",start:function(Q,P){var O=E(M.closest(".Inputfield"),"size");P.placeholder.append(v("<div/>").css({display:"block",height:O+"px",width:O+"px"}));N=window.setTimeout(function(){G(M,null)},100);M.addClass("InputfieldImageSorting")},stop:function(Q,O){var P=v(this);if(N!==null){O.item.find(".InputfieldImageEdit__edit").click();clearTimeout(N)}P.children("li").each(function(S){var R=v(this).find(".InputfieldFileSort");if(R.val()!=S){R.val(S).change()}});M.removeClass("InputfieldImageSorting")},cancel:".InputfieldImageEdit"};M.sortable(L)}function p(M){var L=v.extend(true,{},F);L.callbacks={elementParse:function(N){var O=v(N.el).attr("data-original");if(typeof O=="undefined"||!O){O=v(N.el).attr("src")}N.src=O}};L.gallery={enabled:true};M.find("img").magnificPopup(L)}function t(M){var L=v.extend(true,{},F);L.callbacks={elementParse:function(N){N.src=v(N.el).attr("src")}};L.gallery={enabled:false};M.find("img").magnificPopup(L)}function C(L){return L.find(".InputfieldImageEdit--active")}function u(L){return v("#"+L.find(".InputfieldImageEdit__edit").attr("data-current"))}function D(N){var L=N.is(":checked");var M=N.parents(".gridImages").find(".gridImage__deletebox");if(L){M.prop("checked","checked").change()}else{M.removeAttr("checked").change()}}function J(M){if(typeof M=="undefined"){var L=v(".gridImages")}else{var L=M.find(".gridImages")}L.each(function(){var N=v(this),O=C(N);if(O.length){i(u(O),O)}})}function w(R){var N=[];var Q=[];var P=0,L=0;var O;if(typeof R=="undefined"){O=v(".InputfieldImage.Inputfield")}else{O=R}O.removeClass("InputfieldImageNarrow");O.each(function(){var T=v(this);var U=T.width();if(U<1){return}if(U<=500){N[P]=T;P++}});for(var S=0;S<P;S++){var M=N[S];M.addClass("InputfieldImageNarrow")}}function g(){J();w()}function o(L){if(L.is(":checked")){L.parents(".ImageOuter").addClass("gridImage--delete")}else{L.parents(".ImageOuter").removeClass("gridImage--delete")}}function d(O,L){if(O.closest(".InputfieldImageEditAll").length){return}var N=L.find(".InputfieldImageEdit__image");var Q=O.find("img");N.attr({src:Q.attr("data-original"),"data-original":Q.attr("data-original"),alt:Q.attr("alt")});var M=v.extend(true,{},F);M.callbacks={elementParse:function(R){R.src=v(R.el).attr("data-original")}};M.gallery={enabled:true};L.attr("id","edit-"+O.attr("id"));var P=L.parents(".gridImages").find(".gridImage").not(O).find("img").add(N).magnificPopup(M);L.find(".InputfieldImageEdit__edit").attr("data-current",O.attr("id")).append(O.find(".ImageData").children().not(".InputfieldFileSort"))}function m(L){$inputArea=L.find(".InputfieldImageEdit__edit");if($inputArea.children().not(".InputfieldFileSort").length){var M=$inputArea.children();v("#"+$inputArea.attr("data-current")).find(".ImageData").append(M)}}function G(N,M){var L;if(N){L=N.find(".InputfieldImageEdit--active")}else{if(M){L=v(".InputfieldImageEdit--active").not(M.find(".InputfieldImageEdit--active"))}else{L=v(".InputfieldImageEdit--active")}}if(L.length){m(L);L.removeClass("InputfieldImageEdit--active").removeAttr("id");v("#"+L.attr("data-for")).removeClass("gridImageEditing")}v(".InputfieldImageEdit__replace").removeClass("InputfieldImageEdit__replace")}function i(O,M){if(!O||!O.length){return}var L=O.parent().children().not(".InputfieldImageEdit");var P=0;var Q=false;var R=null;L.each(function(){if(R){return}var S=v(this);var T=S.offset().top;if(Q&&T!=P){R=S}else{if(S.attr("id")==O.attr("id")){Q=true}}P=T});if(R){M.insertBefore(R)}else{M.insertAfter(L.eq(L.length-1))}var N=M.find(".InputfieldImageEdit__arrow");if(N.length){N.css("left",O.position().left+(O.outerWidth()/2)+"px")}}function x(){v(window).resize(y(g,200));v(document).on("click dblclick",".gridImage__trash",function(L){var M=v(this).find("input");M.prop("checked",f).change();if(L.type=="dblclick"){D(M);L.preventDefault();L.stopPropagation()}});v(document).on("change",".gridImage__deletebox",function(){o(v(this))});v(document).on("click",".gridImage__edit",function(O){var M=v(this).closest(".gridImage");if(!M.length){return}if(M.closest(".InputfieldImageEditAll").length){return false}var N=M.closest(".gridImages");var L=N.find(".InputfieldImageEdit");if(M.hasClass("gridImageEditing")){L.find(".InputfieldImageEdit__close").click()}else{i(M,L);m(L);d(M,L);L.addClass("InputfieldImageEdit--active").attr("data-for",M.attr("id"));N.find(".gridImageEditing").removeClass("gridImageEditing");M.addClass("gridImageEditing")}}).on("click",".InputfieldImageEditAll img",function(N){N.stopPropagation();N.preventDefault();v.magnificPopup.close();var L=v.extend(true,{},F);var M=v(this);L.items={src:M.attr("data-original"),title:M.attr("alt")};v.magnificPopup.open(L);return true});v(document).on("click",function(M){var L=v(M.target);if(L.closest(".InputfieldImageEdit").length){G(null,L.parents(".gridImages"))}else{if(L.is("input, textarea")&&L.closest(".InputfieldImageEditAll").length){L.focus().one("blur",function(){L.closest(".gridImages").sortable("enable")});L.closest(".gridImages").sortable("disable")}else{if(L.closest(".gridImage__inner").length){G(null,L.parents(".gridImages"))}else{if(L.closest(".mfp-container").length){return}else{if(L.closest(".ui-dialog").length){return}else{if(L.is(".mfp-close")){return}else{if(L.is("a.remove")){return}else{G(null,null)}}}}}}}});v(document).on("click",".InputfieldImageEdit__close",function(L){G(v(this).parents(".gridImages"),null)});v(document).on("change",".InputfieldImage",function(){v(this).find(".InputfieldImageButtonCrop:not(.pw-modal-dblclick)").addClass("pw-modal-dblclick ui-state-disabled")}).on("click",".InputfieldImageButtonCrop.ui-state-disabled",function(N){var M=v(this);var L=M.closest(".gridImages");if(!L.hasClass("gridImagesAlerted")){ProcessWire.alert(ProcessWire.config.InputfieldImage.labels.changes);L.addClass("gridImagesAlerted")}setTimeout(function(){M.removeClass("ui-state-active")},500);return false});v(".ImagesGrid").on("click","button.pw-modal",function(L){L.preventDefault()});q();w()}function q(){v(document).on("click",".InputfieldImageEdit__name",function(N){var L=v(this).children("span");var O=L.closest(".gridImage, .InputfieldImageEdit").find(".InputfieldFileRename");var M=L.closest(".gridImages");M.sortable("disable");O.val(L.text());L.on("keypress",function(P){if(P.which==13){L.blur();return false}return true});L.attr("autocomplete","off").attr("autocorrect","off").attr("autocapitalize","off").attr("spellcheck","false");L.focus().on("blur",function(){var P=v(this).text();if(v.trim(P).length<1){L.text(O.val())}else{if(P!=O.val()){O.val(P).change();M.closest(".Inputfield").trigger("change")}}L.off("keypress");M.sortable("enable")})})}function l(L,M){M=Math.floor(M);L.find(".gridImage__overflow").each(function(){var N=100-M;v(this).css("width",M+"%");v(this).siblings(".ImageData").css("width",N+"%")});e(L,"listSize",M)}function j(P,L,N){if(!L){return}var M=L+"px";var O=P.find(".gridImages");if(typeof N=="undefined"||N==null){N=O.attr("data-ragged")?true:false}if(N){O.attr("data-ragged",1)}else{O.removeAttr("data-ragged")}O.find(".gridImage__overflow").each(function(){h(v(this),L,N)});O.find(".gridImage__edit, .gridImage__resize").css("line-height",M);O.attr("data-size",L);e(P,"size",L);if(r.length){setTimeout(function(){while(r.length){var Q=r.pop();h(Q,L,N)}},150)}}function h(N,M,P){if(N.hasClass("gridImage__overflow")){var O=N.children("img")}else{if(N.is("img")){var O=N;N=O.closest(".gridImage__overflow")}else{return}}if(!M){O.removeAttr("width").removeAttr("height");N.width("auto").height("auto");return}var L=O.width();var Q=O.height();if(!L){L=parseInt(O.attr("data-w"))}if(!Q){Q=parseInt(O.attr("data-h"))}if(P){O.css("max-height","100%").css("max-width","none");O.attr("height",M).removeAttr("width")}else{if(L>=Q){O.css("max-height","100%").css("max-width","none");O.attr("height",M).removeAttr("width")}else{if(Q>L){O.css("max-height","none").css("max-width","100%");O.attr("width",M).removeAttr("height")}else{O.css("max-height","100%").css("max-width","none");O.removeAttr("width").attr("height",M)}}}var L=O.width();if(L){N.css({width:(P?L+"px":M+"px"),height:M+"px"})}else{var R=N.attr("data-tries");if(!R){R=0}if(typeof R=="undefined"){R=0}R=parseInt(R);if(R>3){N.css({width:M+"px",height:M+"px"})}else{r.push(N);N.attr("data-tries",R+1)}}}function A(M){if(M.find(".InputfieldImageListToggle").length){return}var P=v("<a class='InputfieldImageListToggle' href='list'></a>").append("<i class='fa fa-th-list'></i>");var R=v("<a class='InputfieldImageListToggle' href='left'></a>").append("<i class='fa fa-tasks'></i>");var L=v("<a class='InputfieldImageListToggle' href='grid'></a>").append("<i class='fa fa-th'></i>");var Q="InputfieldImageListToggle--active";var O="";var N=function(W){var V=v(this);var U=V.closest(".Inputfield");var S=V.attr("href");var T;V.parent().children("."+Q).removeClass(Q);V.addClass(Q);if(S=="list"){if(!U.hasClass("InputfieldImageEditAll")){U.find(".InputfieldImageEdit--active .InputfieldImageEdit__close").click();U.addClass("InputfieldImageEditAll")}T=E(U,"listSize");l(U,T);e(U,"mode","list")}else{if(S=="left"){U.removeClass("InputfieldImageEditAll");T=E(U,"size");j(U,T,true);e(U,"mode","left");J()}else{if(S=="grid"){U.removeClass("InputfieldImageEditAll");T=E(U,"size");j(U,T,false);e(U,"mode","grid")}}}B(U.find(".gridImages"));V.blur();return false};P.click(N);R.click(N);L.click(N);if(M.hasClass("InputfieldImage")){M.find(".InputfieldHeader").append(P).append(R).append(L);O=E(M,"mode")}else{v(".InputfieldImage .InputfieldHeader",M).append(P).append(R).append(L)}if(O=="list"){P.click()}else{if(O=="left"){R.click()}else{}}}function z(Q){var N=Q.children(".InputfieldHeader");if(N.children(".InputfieldImageSizeSlider").length){return}var P=Q.find(".gridImages");var M=P.attr("data-gridsize");var O=M/2;var L=M*2;var R=v('<span class="InputfieldImageSizeSlider"></span>');N.append(R);R.slider({min:O,max:L,value:E(Q,"size"),range:"min",slide:function(U,W){var V=W.value;var X=15;var Y=Math.floor(M/X);var S=V-O;var T=Math.floor(X+(S/Y));if(Q.hasClass("InputfieldImageEditAll")){e(Q,"size",V);l(Q,T)}else{e(Q,"listSize",T);j(Q,V)}},start:function(S,T){if(Q.find(".InputfieldImageEdit:visible").length){Q.find(".InputfieldImageEdit__close").click()}},stop:function(S,T){J(Q)}})}function e(M,P,O){var N=E(M);var Q=M.attr("id");var L=Q?Q.replace("wrap_Inputfield_",""):"";if(!L.length||typeof O=="undefined"){return}if(N[L][P]==O){return}N[L][P]=O;v.cookie("InputfieldImage",N);c=N}function E(M,P){if(c&&typeof P=="undefined"){return c}var Q=M.attr("id");var L=Q?Q.replace("wrap_Inputfield_",""):"na";var O=c?c:v.cookie("InputfieldImage");var N=null;if(!O){var O={}}if(typeof O[L]=="undefined"){O[L]={}}if(typeof O[L].size=="undefined"){O[L].size=parseInt(M.find(".gridImages").attr("data-size"))}if(typeof O[L].listSize=="undefined"){O[L].listSize=23}if(typeof O[L].mode=="undefined"){O[L].mode=M.find(".gridImages").attr("data-gridMode")}if(c==null){c=O}if(typeof P=="undefined"){N=O}else{if(P===true){N=O[L]}else{if(typeof O[L][P]!="undefined"){N=O[L][P]}}}return N}function a(P){if(P.hasClass("InputfieldStateCollapsed")){return}var Q=parseInt(P.find(".InputfieldImageMaxFiles").val());var O=P.find(".gridImages");var N=E(P,"size");var R=E(P,"mode");var M=R=="left"?true:false;if(!N){N=O.attr("data-gridsize")}N=parseInt(N);if(P.hasClass("InputfieldImageEditAll")||R=="list"){var L=E(P,"listSize");l(P,L)}else{j(P,N,M)}if(!P.hasClass("InputfieldImageInit")){P.addClass("InputfieldImageInit");if(P.hasClass("InputfieldRenderValueMode")){return p(P)}else{if(Q==1){P.addClass("InputfieldImageMax1");t(P)}else{B(O)}}A(P);z(P)}w(P)}function I(){v("body").addClass("ie-no-drop");v(".InputfieldImage.InputfieldFileMultiple").each(function(){var M=v(this),O=parseInt(M.find(".InputfieldFileMaxFiles").val()),L=M.find(".gridImages"),N=M.find(".InputfieldImageUpload");N.on("change","input[type=file]",function(){var S=v(this),Q=S.parent(".InputMask");if(S.val().length>1){Q.addClass("ui-state-disabled")}else{Q.removeClass("ui-state-disabled")}if(S.next("input.InputfieldFile").length>0){return}var P=L.children("li").length+N.find("input[type=file]").length+1;if(O>0&&P>=O){return}N.find(".InputMask").not(":last").each(function(){var T=v(this);if(T.find("input[type=file]").val()<1){T.remove()}});var R=Q.clone().removeClass("ui-state-disabled");R.children("input[type=file]").val("");R.insertAfter(Q)})})}function K(N){var M;if(N.length>0){M=N.find(".InputfieldImageUpload")}else{M=v(".InputfieldImageUpload")}M.each(function(Q){var R=v(this);var P=R.closest(".InputfieldContent");if(R.hasClass("InputfieldImageInitUpload")){return}O(P,Q);R.addClass("InputfieldImageInitUpload")});function O(Y,ak){var X=Y.parents("form");var P=Y.closest(".InputfieldRepeaterItem");var T=P.length?P.attr("data-editUrl"):X.attr("action");T+=(T.indexOf("?")>-1?"&":"?")+"InputfieldFileAjax=1";var ap=X.find("input._post_token");var W=ap.attr("name");var ab=ap.val();var aa=Y.find(".InputfieldImageErrors").first();var S=Y.find(".InputfieldImageUpload").data("fieldname");S=S.slice(0,-2);var ai=Y.closest(".Inputfield.InputfieldImage");var ao=Y.find(".InputfieldImageUpload").data("extensions").toLowerCase();var ah=Y.find(".InputfieldImageUpload").data("maxfilesize");var Z=Y.find("input[type=file]").get(0);var R=Y.find(".gridImages");var al=R.get(0);var ad=R.data("gridsize");var ae=null;var ac=parseInt(Y.find(".InputfieldImageMaxFiles").val());var an=n(ai);var aj=an.maxWidth>0||an.maxHeight>0||an.maxSize>0;am(Y);if(ac!=1){ag(R)}R.children().addClass("InputfieldFileItemExisting");function V(ar,aq){if(typeof aq!=="undefined"){ar="<b>"+aq+":</b> "+ar}return"<li>"+ar+"</li>"}function Q(ar){var aq=new String(ar).substring(ar.lastIndexOf("/")+1);if(aq.lastIndexOf(".")!=-1){aq=aq.substring(0,aq.lastIndexOf("."))}return aq}function am(ar){if(ar.hasClass("InputfieldImageDropzoneInit")){return}var av=ar.get(0);var au=ar.closest(".Inputfield");function aq(){if(au.hasClass("pw-drag-in-file")){return}ar.addClass("ui-state-hover");au.addClass("pw-drag-in-file")}function at(){if(!au.hasClass("pw-drag-in-file")){return}ar.removeClass("ui-state-hover");au.removeClass("pw-drag-in-file")}av.addEventListener("dragleave",function(){at()},false);av.addEventListener("dragenter",function(aw){aw.preventDefault();aq()},false);av.addEventListener("dragover",function(aw){if(!ar.is("ui-state-hover")){aq()}aw.preventDefault();aw.stopPropagation();return false},false);av.addEventListener("drop",function(aw){af(aw.dataTransfer.files);at();aw.preventDefault();aw.stopPropagation();return false},false);ar.addClass("InputfieldImageDropzoneInit")}function ag(az){var aD=null;var aB=false;var ar=null;var aq=az.closest(".Inputfield");function aw(){aq.addClass("pw-drag-in-file")}function aC(){aq.removeClass("pw-drag-in-file")}function av(aF){var aJ=aF.offset();var aG=aF.width();var aE=aF.height();var aI=aJ.left+aG/2;var aH=aJ.top+aE/2;return{clientX:aI,clientY:aH}}function ay(){return az.find(".InputfieldImageEdit--active").length>0}function ax(aF){if(ay()){return}aF.preventDefault();aF.stopPropagation();aw();aB=false;if(aD==null){var aE=az.attr("data-size")+"px";var aG=v("<div/>").addClass("gridImage__overflow");if(az.closest(".InputfieldImageEditAll").length){aG.css({width:"100%",height:aE})}else{aG.css({width:aE,height:aE})}aD=v("<li/>").addClass("ImageOuter gridImage gridImagePlaceholder").append(aG);az.append(aD)}var aH=av(aD);aD.simulate("mousedown",aH)}function aA(aE){if(ay()){return}aE.preventDefault();aE.stopPropagation();aw();aB=false;if(aD==null){return}var aF={clientX:aE.originalEvent.clientX,clientY:aE.originalEvent.clientY};aD.simulate("mousemove",aF)}function au(aE){if(ay()){return}aE.preventDefault();aE.stopPropagation();if(aD==null){return false}aB=true;if(ar){clearTimeout(ar)}ar=setTimeout(function(){if(!aB||aD==null){return}aD.remove();aD=null;aC()},1000)}function at(aE){if(ay()){return}aC();aB=false;var aF={clientX:aE.clientX,clientY:aE.clientY};aD.simulate("mouseup",aF);k=aD.next(".gridImage");aD.remove();aD=null}if(az.length&&!az.hasClass("gridImagesInitDropInPlace")){az.on("dragenter",ax);az.on("dragover",aA);az.on("dragleave",au);az.on("drop",at);az.addClass("gridImagesInitDropInPlace")}}function U(aO,aC){var aL=ProcessWire.config.InputfieldImage.labels;var ax=parseInt(aO.size/1024,10)+"&nbsp;kB";var aN='<div class="gridImage__tooltip"><table><tbody><tr><th>'+aL.dimensions+'</th><td class="dimensions">'+aL.na+"</td></tr><tr><th>"+aL.filesize+"</th><td>"+ax+"</td></tr><tr><th>"+aL.variations+"</th><td>0</td></tr></tbody></table></div>";var aQ=v('<li class="gridImage gridImageUploading"></li>'),aI=v(aN),ay=v('<div class="gridImage__overflow"></div>'),aq=v('<div class="ImageData"></div>'),aF=v("<div class='gridImage__hover'><div class='gridImage__inner'></div></div>"),aH=v("<progress class='gridImage__progress' min='-1' max='100' value='0'></progress>"),aK=v('<a class="gridImage__edit" title="'+aO.name+'"><span>&nbsp;</span></a>'),aJ=v('<div class="gridImage__resize"><i class="fa fa-spinner fa-spin fa-2x fa-fw"></i></div>'),ar,aA,aP,aD=URL.createObjectURL(aO),at=ai.find(".gridImages"),av=ac==1,aG=E(ai,"size"),aw=E(ai,"listSize"),au=ai.hasClass("InputfieldImageEditAll"),az=v('<img height="'+aG+'" alt="">');ay.append(az);aF.find(".gridImage__inner").append(aK);aF.find(".gridImage__inner").append(aJ.css("display","none"));aF.find(".gridImage__inner").append(aH);aq.append(v('<h2 class="InputfieldImageEdit__name">'+aO.name+'</h2><span class="InputfieldImageEdit__info">'+ax+"</span>"));if(au){ay.css("width",aw+"%");aq.css("width",(100-aw)+"%")}else{ay.css({width:aG+"px",height:aG+"px"})}aQ.append(aI).append(ay).append(aF).append(aq);az.attr({src:aD,"data-original":aD});img=new Image();img.addEventListener("load",function(){aI.find(".dimensions").html(this.width+"&nbsp;&times;&nbsp;"+this.height);var aR=Math.min(this.width,this.height)/aG;az.attr({width:this.width/aR,height:this.height/aR})},false);img.src=aD;aA=new XMLHttpRequest();function aB(aR){if(typeof aR!="undefined"){if(!aR.lengthComputable){return}aH.attr("value",parseInt((aR.loaded/aR.total)*100))}v("body").addClass("pw-uploading");aJ.css("display","block")}aA.upload.addEventListener("progress",aB,false);aA.addEventListener("load",function(){aA.getAllResponseHeaders();var aU=v.parseJSON(aA.responseText),aS=aU.length>1;if(aU.error!==undefined){aU=[aU]}for(var aT=0;aT<aU.length;aT++){var aR=aU[aT];if(aR.error){aa.append(V(aR.message));continue}var a0=null;var aW=v(aR.markup).hide();var aZ=Y.find("input[type=file]");if(aZ.val()){aZ.replaceWith(aZ.clone(true))}if(aR.overwrite){a0=at.children("#"+aW.attr("id"))}if(ac==1||aR.replace){a0=at.children(".gridImage:eq(0)")}else{if(b.item&&aU.length==1){a0=b.item}}if(a0&&a0.length){a0.replaceWith(aW)}else{if(k&&k.length){k.before(aW);k=aW}else{if(aT===0){aQ.replaceWith(aW)}else{at.append(aW)}}}if(au){aW.find(".gridImage__overflow").css("width",aw+"%")}else{aW.find(".gridImage__overflow").css({height:aG+"px",width:aG+"px"});aW.find("img").hide()}aW.fadeIn(150,function(){aW.find("img").fadeIn();if(au){l(ai,aw)}else{j(ai,aG)}}).css("display","");aW.addClass("InputfieldFileItemExisting");if(a0&&a0.length){aW.effect("highlight",500)}if(aQ.length){aQ.remove()}if(b.item&&ac!=1){aW.find(".InputfieldFileReplace").val(b.file);var a2=aW.find(".InputfieldImageEdit__name");var aY=a2.text();var a1=aY.substring(aY.lastIndexOf(".")+1).toLowerCase();aY=aY.substring(0,aY.lastIndexOf("."));var aX=b.file;if(aX.indexOf("?")>-1){aX=aX.substring(0,aX.indexOf("?"))}var aV=aX.substring(aX.lastIndexOf(".")+1).toLowerCase();aX=aX.substring(0,aX.lastIndexOf("."));if(aV==a1){a2.children("span").text(aX).removeAttr("contenteditable")}aW.find(".gridImage__edit").click()}b.file="";b.item=null;b.edit=null}if(ae){clearTimeout(ae)}k=null;ae=setTimeout(function(){if(ac!=1){B(at)}else{t(ai)}v("body").removeClass("pw-uploading");at.trigger("AjaxUploadDone")},500);ai.trigger("change").removeClass("InputfieldFileEmpty")},false);if(b.edit){b.edit.find(".InputfieldImageEdit__close").click()}else{if(ai.find(".InputfieldImageEdit:visible").length){ai.find(".InputfieldImageEdit__close").click()}}if(b.item){b.item.replaceWith(aQ);b.item=aQ}else{if(k&&k.length){k.before(aQ)}else{at.append(aQ)}}function aM(aR,aT){aA.open("POST",T,true);aA.setRequestHeader("X-FILENAME",encodeURIComponent(aR.name));aA.setRequestHeader("X-FIELDNAME",S);if(b.item){aA.setRequestHeader("X-REPLACENAME",b.file)}aA.setRequestHeader("Content-Type","application/octet-stream");aA.setRequestHeader("X-"+W,ab);aA.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");if(typeof aT!="undefined"&&aT!=false){aA.send(aT)}else{aA.send(aR)}J();ai.trigger("change");var aS=ai.find(".InputfieldFileItem").length;if(aS==1){ai.removeClass("InputfieldFileEmpty").removeClass("InputfieldFileMultiple").addClass("InputfieldFileSingle")}else{if(aS>1){ai.removeClass("InputfieldFileEmpty").removeClass("InputfieldFileSingle").addClass("InputfieldFileMultiple")}}}aB();if(aj){var aE=new PWImageResizer(an);aJ.addClass("pw-resizing");aE.resize(aO,function(aR){aJ.removeClass("pw-resizing");aM(aO,aR)})}else{aM(aO)}}function af(av){var ar=function(az){return parseInt(az/1024,10)};if(typeof av==="undefined"){al.innerHTML="No support for the File API in this web browser";return}for(var at=0,aq=av.length;at<aq;at++){var ay=av[at].name.split(".").pop().toLowerCase();var au;if(ao.indexOf(ay)==-1){au=ay+" is a invalid file extension, please use one of:  "+ao;aa.append(V(au,av[at].name))}else{if(!aj&&av[at].size>ah&&ah>2000000){var ax=ar(av[at].size),aw=ar(ah);au="Filesize "+ax+" kb is too big. Maximum allowed is "+aw+" kb";aa.append(V(au,av[at].name))}else{U(av[at],ay)}}if(ac==1){break}}}Z.addEventListener("change",function(aq){af(this.files);aq.preventDefault();aq.stopPropagation();this.value=""},false)}function L(){var P=".InputfieldImageEdit__imagewrapper img";v(document).on("dragenter",P,function(){var S=v(this);if(S.closest(".InputfieldImageMax1").length){return}var T=S.attr("src");var Q=S.closest(".InputfieldImageEdit");var R=S.closest(".InputfieldImageEdit__imagewrapper");R.addClass("InputfieldImageEdit__replace");b.file=new String(T).substring(T.lastIndexOf("/")+1);b.item=v("#"+Q.attr("data-for"));b.edit=Q}).on("dragleave",P,function(){var R=v(this);if(R.closest(".InputfieldImageMax1").length){return}var Q=R.closest(".InputfieldImageEdit__imagewrapper");Q.removeClass("InputfieldImageEdit__replace");b.file="";b.item=null;b.edit=null})}L()}function n(M){var L={maxWidth:0,maxHeight:0,maxSize:0,quality:1,autoRotate:true,debug:ProcessWire.config.debug};var N=M.attr("data-resize");if(typeof N!="undefined"&&N.length){N=N.split(";");L.maxWidth=parseInt(N[0]);L.maxHeight=parseInt(N[1]);L.maxSize=parseFloat(N[2]);L.quality=parseFloat(N[3])}return L}function H(){v(".InputfieldImage.Inputfield").each(function(){a(v(this))});x();if(s()){K("")}else{I()}v(document).on("reloaded",".InputfieldImage",function(){var L=v(this);a(L);K(L)}).on("wiretabclick",function(N,M,L){M.find(".InputfieldImage").each(function(){a(v(this))})}).on("opened",".InputfieldImage",function(){a(v(this))})}H()}jQuery(document).ready(function(a){InputfieldImage(a)});