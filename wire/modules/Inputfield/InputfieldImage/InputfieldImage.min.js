function InputfieldImage(u){var k=null;var b={file:"",item:null,edit:null};var E={type:"image",closeOnContentClick:true,closeBtnInside:true};var c=null;var q=[];function r(){var L=window.File&&window.FileList&&window.FileReader;var K=u(".InputfieldAllowAjaxUpload").length>0;var M=u("#PageIDIndicator").length>0;return(L&&(M||K))}function x(M,K,L){K||(K=250);var N,O;return function(){var R=L||this;var Q=+new Date(),P=arguments;if(N&&Q<N+K){clearTimeout(O);O=setTimeout(function(){N=Q;M.apply(R,P)},K)}else{N=Q;M.apply(R,P)}}}function f(L,K){return !K}function A(L){if(L.hasClass("ui-sortable")){L.sortable("destroy");L.children("li").each(function(O){var N=u(this).find("input.InputfieldFileSort");N.val(O)})}var M;var K={items:"> .gridImage",start:function(P,O){var N=D(L.closest(".Inputfield"),"size");O.placeholder.append(u("<div/>").css({display:"block",height:N+"px",width:N+"px"}));M=window.setTimeout(function(){F(L,null)},100);L.addClass("InputfieldImageSorting")},stop:function(P,N){var O=u(this);if(M!==null){N.item.find(".InputfieldImageEdit__edit").click();clearTimeout(M)}O.children("li").each(function(R){var Q=u(this).find(".InputfieldFileSort");if(Q.val()!=R){Q.val(R).change()}});L.removeClass("InputfieldImageSorting")},cancel:".InputfieldImageEdit"};L.sortable(K)}function o(L){var K=u.extend(true,{},E);K.callbacks={elementParse:function(M){var N=u(M.el).attr("data-original");if(typeof N=="undefined"||!N){N=u(M.el).attr("src")}M.src=N}};K.gallery={enabled:true};L.find("img").magnificPopup(K)}function s(L){var K=u.extend(true,{},E);K.callbacks={elementParse:function(M){M.src=u(M.el).attr("src")}};K.gallery={enabled:false};L.find("img").magnificPopup(K)}function B(K){return K.find(".InputfieldImageEdit--active")}function t(K){return u("#"+K.find(".InputfieldImageEdit__edit").attr("data-current"))}function C(M){var K=M.is(":checked");var L=M.parents(".gridImages").find(".gridImage__deletebox");if(K){L.prop("checked","checked").change()}else{L.removeAttr("checked").change()}}function I(L){if(typeof L=="undefined"){var K=u(".gridImages")}else{var K=L.find(".gridImages")}K.each(function(){var M=u(this),N=B(M);if(N.length){i(t(N),N)}})}function v(Q){var M=[];var P=[];var O=0,K=0;var N;if(typeof Q=="undefined"){N=u(".InputfieldImage.Inputfield")}else{N=Q}N.removeClass("InputfieldImageNarrow");N.each(function(){var S=u(this);var T=S.width();if(T<1){return}if(T<=500){M[O]=S;O++}});for(var R=0;R<O;R++){var L=M[R];L.addClass("InputfieldImageNarrow")}}function g(){I();v()}function n(K){if(K.is(":checked")){K.parents(".ImageOuter").addClass("gridImage--delete")}else{K.parents(".ImageOuter").removeClass("gridImage--delete")}}function d(N,K){if(N.closest(".InputfieldImageEditAll").length){return}var M=K.find(".InputfieldImageEdit__image");var P=N.find("img");M.attr({src:P.attr("data-original"),"data-original":P.attr("data-original"),alt:P.attr("alt")});var L=u.extend(true,{},E);L.callbacks={elementParse:function(Q){Q.src=u(Q.el).attr("data-original")}};L.gallery={enabled:true};K.attr("id","edit-"+N.attr("id"));var O=K.parents(".gridImages").find(".gridImage").not(N).find("img").add(M).magnificPopup(L);K.find(".InputfieldImageEdit__edit").attr("data-current",N.attr("id")).append(N.find(".ImageData").children().not(".InputfieldFileSort"))}function m(K){$inputArea=K.find(".InputfieldImageEdit__edit");if($inputArea.children().not(".InputfieldFileSort").length){var L=$inputArea.children();u("#"+$inputArea.attr("data-current")).find(".ImageData").append(L)}}function F(M,L){var K;if(M){K=M.find(".InputfieldImageEdit--active")}else{if(L){K=u(".InputfieldImageEdit--active").not(L.find(".InputfieldImageEdit--active"))}else{K=u(".InputfieldImageEdit--active")}}if(K.length){m(K);K.removeClass("InputfieldImageEdit--active").removeAttr("id");u("#"+K.attr("data-for")).removeClass("gridImageEditing")}u(".InputfieldImageEdit__replace").removeClass("InputfieldImageEdit__replace")}function i(N,L){if(!N||!N.length){return}var K=N.parent().children().not(".InputfieldImageEdit");var O=0;var P=false;var Q=null;K.each(function(){if(Q){return}var R=u(this);var S=R.offset().top;if(P&&S!=O){Q=R}else{if(R.attr("id")==N.attr("id")){P=true}}O=S});if(Q){L.insertBefore(Q)}else{L.insertAfter(K.eq(K.length-1))}var M=L.find(".InputfieldImageEdit__arrow");if(M.length){M.css("left",N.position().left+(N.outerWidth()/2)+"px")}}function w(){u(window).resize(x(g,200));u(document).on("click dblclick",".gridImage__trash",function(K){var L=u(this).find("input");L.prop("checked",f).change();if(K.type=="dblclick"){C(L);K.preventDefault();K.stopPropagation()}});u(document).on("change",".gridImage__deletebox",function(){n(u(this))});u(document).on("click",".gridImage__edit",function(N){var L=u(this).closest(".gridImage");if(!L.length){return}if(L.closest(".InputfieldImageEditAll").length){return false}var M=L.closest(".gridImages");var K=M.find(".InputfieldImageEdit");if(L.hasClass("gridImageEditing")){K.find(".InputfieldImageEdit__close").click()}else{i(L,K);m(K);d(L,K);K.addClass("InputfieldImageEdit--active").attr("data-for",L.attr("id"));M.find(".gridImageEditing").removeClass("gridImageEditing");L.addClass("gridImageEditing")}}).on("click",".InputfieldImageEditAll img",function(M){M.stopPropagation();M.preventDefault();u.magnificPopup.close();var K=u.extend(true,{},E);var L=u(this);K.items={src:L.attr("data-original"),title:L.attr("alt")};u.magnificPopup.open(K);return true});u(document).on("click",function(L){var K=u(L.target);if(K.closest(".InputfieldImageEdit").length){F(null,K.parents(".gridImages"))}else{if(K.is("input, textarea")&&K.closest(".InputfieldImageEditAll").length){K.focus().one("blur",function(){K.closest(".gridImages").sortable("enable")});K.closest(".gridImages").sortable("disable")}else{if(K.closest(".gridImage__inner").length){F(null,K.parents(".gridImages"))}else{if(K.closest(".mfp-container").length){return}else{if(K.closest(".ui-dialog").length){return}else{if(K.is(".mfp-close")){return}else{F(null,null)}}}}}}});u(document).on("click",".InputfieldImageEdit__close",function(K){F(u(this).parents(".gridImages"),null)});u(document).on("change",".InputfieldImage",function(){u(this).find(".InputfieldImageButtonCrop:not(.pw-modal-dblclick)").addClass("pw-modal-dblclick ui-state-disabled")}).on("click",".InputfieldImageButtonCrop.ui-state-disabled",function(M){var L=u(this);var K=L.closest(".gridImages");if(!K.hasClass("gridImagesAlerted")){ProcessWire.alert(ProcessWire.config.InputfieldImage.labels.changes);K.addClass("gridImagesAlerted")}setTimeout(function(){L.removeClass("ui-state-active")},500);return false});u(".ImagesGrid").on("click","button.pw-modal",function(K){K.preventDefault()});p();v()}function p(){u(document).on("click",".InputfieldImageEdit__name",function(M){var K=u(this).children("span");var N=K.closest(".gridImage, .InputfieldImageEdit").find(".InputfieldFileRename");var L=K.closest(".gridImages");L.sortable("disable");N.val(K.text());K.on("keypress",function(O){if(O.which==13){K.blur();return false}return true});K.attr("autocomplete","off").attr("autocorrect","off").attr("autocapitalize","off").attr("spellcheck","false");K.focus().on("blur",function(){var O=u(this).text();if(u.trim(O).length<1){K.text(N.val())}else{if(O!=N.val()){N.val(O).change();L.closest(".Inputfield").trigger("change")}}K.off("keypress");L.sortable("enable")})})}function l(K,L){L=Math.floor(L);K.find(".gridImage__overflow").each(function(){var M=100-L;u(this).css("width",L+"%");u(this).siblings(".ImageData").css("width",M+"%")});e(K,"listSize",L)}function j(O,K,M){if(!K){return}var L=K+"px";var N=O.find(".gridImages");if(typeof M=="undefined"||M==null){M=N.attr("data-ragged")?true:false}if(M){N.attr("data-ragged",1)}else{N.removeAttr("data-ragged")}N.find(".gridImage__overflow").each(function(){h(u(this),K,M)});N.find(".gridImage__edit, .gridImage__resize").css("line-height",L);N.attr("data-size",K);e(O,"size",K);if(q.length){setTimeout(function(){while(q.length){var P=q.pop();h(P,K,M)}},150)}}function h(M,L,O){if(M.hasClass("gridImage__overflow")){var N=M.children("img")}else{if(M.is("img")){var N=M;M=N.closest(".gridImage__overflow")}else{return}}if(!L){N.removeAttr("width").removeAttr("height");M.width("auto").height("auto");return}var K=N.width();var P=N.height();if(!K){K=parseInt(N.attr("data-w"))}if(!P){P=parseInt(N.attr("data-h"))}if(O){N.css("max-height","100%").css("max-width","none");N.attr("height",L).removeAttr("width")}else{if(K>=P){N.css("max-height","100%").css("max-width","none");N.attr("height",L).removeAttr("width")}else{if(P>K){N.css("max-height","none").css("max-width","100%");N.attr("width",L).removeAttr("height")}else{N.css("max-height","100%").css("max-width","none");N.removeAttr("width").attr("height",L)}}}var K=N.width();if(K){M.css({width:(O?K+"px":L+"px"),height:L+"px"})}else{var Q=M.attr("data-tries");if(!Q){Q=0}if(typeof Q=="undefined"){Q=0}Q=parseInt(Q);if(Q>3){M.css({width:L+"px",height:L+"px"})}else{q.push(M);M.attr("data-tries",Q+1)}}}function z(L){if(L.find(".InputfieldImageListToggle").length){return}var O=u("<a class='InputfieldImageListToggle' href='list'></a>").append("<i class='fa fa-th-list'></i>");var Q=u("<a class='InputfieldImageListToggle' href='left'></a>").append("<i class='fa fa-tasks'></i>");var K=u("<a class='InputfieldImageListToggle' href='grid'></a>").append("<i class='fa fa-th'></i>");var P="InputfieldImageListToggle--active";var N="";var M=function(V){var U=u(this);var T=U.closest(".Inputfield");var R=U.attr("href");var S;U.parent().children("."+P).removeClass(P);U.addClass(P);if(R=="list"){if(!T.hasClass("InputfieldImageEditAll")){T.find(".InputfieldImageEdit--active .InputfieldImageEdit__close").click();T.addClass("InputfieldImageEditAll")}S=D(T,"listSize");l(T,S);e(T,"mode","list")}else{if(R=="left"){T.removeClass("InputfieldImageEditAll");S=D(T,"size");j(T,S,true);e(T,"mode","left");I()}else{if(R=="grid"){T.removeClass("InputfieldImageEditAll");S=D(T,"size");j(T,S,false);e(T,"mode","grid")}}}A(T.find(".gridImages"));U.blur();return false};O.click(M);Q.click(M);K.click(M);if(L.hasClass("InputfieldImage")){L.find(".InputfieldHeader").append(O).append(Q).append(K);N=D(L,"mode")}else{u(".InputfieldImage .InputfieldHeader",L).append(O).append(Q).append(K)}if(N=="list"){O.click()}else{if(N=="left"){Q.click()}else{}}}function y(P){var M=P.children(".InputfieldHeader");if(M.children(".InputfieldImageSizeSlider").length){return}var O=P.find(".gridImages");var L=O.attr("data-gridsize");var N=L/2;var K=L*2;var Q=u('<span class="InputfieldImageSizeSlider"></span>');M.append(Q);Q.slider({min:N,max:K,value:D(P,"size"),range:"min",slide:function(T,V){var U=V.value;var W=15;var X=Math.floor(L/W);var R=U-N;var S=Math.floor(W+(R/X));if(P.hasClass("InputfieldImageEditAll")){e(P,"size",U);l(P,S)}else{e(P,"listSize",S);j(P,U)}},start:function(R,S){if(P.find(".InputfieldImageEdit:visible").length){P.find(".InputfieldImageEdit__close").click()}},stop:function(R,S){I(P)}})}function e(L,O,N){var M=D(L);var P=L.attr("id");var K=P?P.replace("wrap_Inputfield_",""):"";if(!K.length||typeof N=="undefined"){return}if(M[K][O]==N){return}M[K][O]=N;u.cookie("InputfieldImage",M);c=M}function D(L,O){if(c&&typeof O=="undefined"){return c}var P=L.attr("id");var K=P?P.replace("wrap_Inputfield_",""):"na";var N=c?c:u.cookie("InputfieldImage");var M=null;if(!N){var N={}}if(typeof N[K]=="undefined"){N[K]={}}if(typeof N[K].size=="undefined"){N[K].size=parseInt(L.find(".gridImages").attr("data-size"))}if(typeof N[K].listSize=="undefined"){N[K].listSize=23}if(typeof N[K].mode=="undefined"){N[K].mode=L.find(".gridImages").attr("data-gridMode")}if(c==null){c=N}if(typeof O=="undefined"){M=N}else{if(O===true){M=N[K]}else{if(typeof N[K][O]!="undefined"){M=N[K][O]}}}return M}function a(O){if(O.hasClass("InputfieldStateCollapsed")){return}var P=parseInt(O.find(".InputfieldImageMaxFiles").val());var N=O.find(".gridImages");var M=D(O,"size");var Q=D(O,"mode");var L=Q=="left"?true:false;if(!M){M=N.attr("data-gridsize")}M=parseInt(M);j(O,M,L);if(O.hasClass("InputfieldImageEditAll")||Q=="list"){var K=D(O,"listSize");l(O,K)}if(!O.hasClass("InputfieldImageInit")){O.addClass("InputfieldImageInit");if(O.hasClass("InputfieldRenderValueMode")){return o(O)}else{if(P==1){O.addClass("InputfieldImageMax1");s(O)}else{A(N)}}z(O);y(O)}v(O)}function H(){u("body").addClass("ie-no-drop");u(".InputfieldImage.InputfieldFileMultiple").each(function(){var L=u(this),N=parseInt(L.find(".InputfieldFileMaxFiles").val()),K=L.find(".gridImages"),M=L.find(".InputfieldImageUpload");M.on("change","input[type=file]",function(){var R=u(this),P=R.parent(".InputMask");if(R.val().length>1){P.addClass("ui-state-disabled")}else{P.removeClass("ui-state-disabled")}if(R.next("input.InputfieldFile").length>0){return}var O=K.children("li").length+M.find("input[type=file]").length+1;if(N>0&&O>=N){return}M.find(".InputMask").not(":last").each(function(){var S=u(this);if(S.find("input[type=file]").val()<1){S.remove()}});var Q=P.clone().removeClass("ui-state-disabled");Q.children("input[type=file]").val("");Q.insertAfter(P)})})}function J(M){var L;if(M.length>0){L=M.find(".InputfieldImageUpload")}else{L=u(".InputfieldImageUpload")}L.each(function(P){var Q=u(this);var O=Q.closest(".InputfieldContent");if(Q.hasClass("InputfieldImageInitUpload")){return}N(O,P);Q.addClass("InputfieldImageInitUpload")});function N(X,ai){var W=X.parents("form");var O=X.closest(".InputfieldRepeaterItem");var S=O.length?O.attr("data-editUrl"):W.attr("action");S+=(S.indexOf("?")>-1?"&":"?")+"InputfieldFileAjax=1";var am=W.find("input._post_token");var V=am.attr("name");var aa=am.val();var Z=X.find(".InputfieldImageErrors").first();var R=X.find(".InputfieldImageUpload").data("fieldname");R=R.slice(0,-2);var ah=X.closest(".Inputfield.InputfieldImage");var al=X.find(".InputfieldImageUpload").data("extensions").toLowerCase();var ag=X.find(".InputfieldImageUpload").data("maxfilesize");var Y=X.find("input[type=file]").get(0);var Q=X.find(".gridImages");var aj=Q.get(0);var ac=Q.data("gridsize");var ad=null;var ab=parseInt(X.find(".InputfieldImageMaxFiles").val());ak(X);if(ab!=1){af(Q)}Q.children().addClass("InputfieldFileItemExisting");function U(ao,an){if(typeof an!=="undefined"){ao="<b>"+an+":</b> "+ao}return"<li>"+ao+"</li>"}function P(ao){var an=new String(ao).substring(ao.lastIndexOf("/")+1);if(an.lastIndexOf(".")!=-1){an=an.substring(0,an.lastIndexOf("."))}return an}function ak(ao){if(ao.hasClass("InputfieldImageDropzoneInit")){return}var ar=ao.get(0);var aq=ao.closest(".Inputfield");function an(){if(aq.hasClass("pw-drag-in-file")){return}ao.addClass("ui-state-hover");aq.addClass("pw-drag-in-file")}function ap(){if(!aq.hasClass("pw-drag-in-file")){return}ao.removeClass("ui-state-hover");aq.removeClass("pw-drag-in-file")}ar.addEventListener("dragleave",function(){ap()},false);ar.addEventListener("dragenter",function(){an()},false);ar.addEventListener("dragover",function(at){if(!ao.is("ui-state-hover")){an()}at.preventDefault();at.stopPropagation();return false},false);ar.addEventListener("drop",function(at){ae(at.dataTransfer.files);ap();at.preventDefault();at.stopPropagation();return false},false);ao.addClass("InputfieldImageDropzoneInit")}function af(aw){var aA=null;var ay=false;var ao=null;var an=aw.closest(".Inputfield");function at(){an.addClass("pw-drag-in-file")}function az(){an.removeClass("pw-drag-in-file")}function ar(aC){var aG=aC.offset();var aD=aC.width();var aB=aC.height();var aF=aG.left+aD/2;var aE=aG.top+aB/2;return{clientX:aF,clientY:aE}}function av(){return aw.find(".InputfieldImageEdit--active").length>0}function au(aC){if(av()){return}aC.preventDefault();aC.stopPropagation();at();ay=false;if(aA==null){var aB=aw.attr("data-size")+"px";var aD=u("<div/>").addClass("gridImage__overflow");if(aw.closest(".InputfieldImageEditAll").length){aD.css({width:"100%",height:aB})}else{aD.css({width:aB,height:aB})}aA=u("<li/>").addClass("ImageOuter gridImage gridImagePlaceholder").append(aD);aw.append(aA)}var aE=ar(aA);aA.simulate("mousedown",aE)}function ax(aB){if(av()){return}aB.preventDefault();aB.stopPropagation();at();ay=false;if(aA==null){return}var aC={clientX:aB.originalEvent.clientX,clientY:aB.originalEvent.clientY};aA.simulate("mousemove",aC)}function aq(aB){if(av()){return}aB.preventDefault();aB.stopPropagation();if(aA==null){return false}ay=true;if(ao){clearTimeout(ao)}ao=setTimeout(function(){if(!ay||aA==null){return}aA.remove();aA=null;az()},1000)}function ap(aB){if(av()){return}az();ay=false;var aC={clientX:aB.clientX,clientY:aB.clientY};aA.simulate("mouseup",aC);k=aA.next(".gridImage");aA.remove();aA=null}if(aw.length&&!aw.hasClass("gridImagesInitDropInPlace")){aw.on("dragenter",au);aw.on("dragover",ax);aw.on("dragleave",aq);aw.on("drop",ap);aw.addClass("gridImagesInitDropInPlace")}}function T(aI){var aG=ProcessWire.config.InputfieldImage.labels;var au=parseInt(aI.size/1024,10)+"&nbsp;kB";var aH='<div class="gridImage__tooltip"><table><tbody><tr><th>'+aG.dimensions+'</th><td class="dimensions">'+aG.na+"</td></tr><tr><th>"+aG.filesize+"</th><td>"+au+"</td></tr><tr><th>"+aG.variations+"</th><td>0</td></tr></tbody></table></div>";var aK=u('<li class="gridImage gridImageUploading"></li>'),aD=u(aH),aw=u('<div class="gridImage__overflow"></div>'),an=u('<div class="ImageData"></div>'),aA=u("<div class='gridImage__hover'><div class='gridImage__inner'></div></div>"),aC=u("<progress class='gridImage__progress' min='-1' max='100' value='0'></progress>"),aF=u('<a class="gridImage__edit" title="'+aI.name+'"><span>&nbsp;</span></a>'),aE=u('<div class="gridImage__resize"><i class="fa fa-spinner fa-spin fa-2x fa-fw"></i></div>'),ao,ay,aJ,az=URL.createObjectURL(aI),ap=ah.find(".gridImages"),ar=ab==1,aB=D(ah,"size"),at=D(ah,"listSize"),aq=ah.hasClass("InputfieldImageEditAll"),ax=u('<img height="'+aB+'" alt="">');aw.append(ax);aA.find(".gridImage__inner").append(aF);aA.find(".gridImage__inner").append(aE.css("display","none"));aA.find(".gridImage__inner").append(aC);an.append(u('<h2 class="InputfieldImageEdit__name">'+aI.name+'</h2><span class="InputfieldImageEdit__info">'+au+"</span>"));if(aq){aw.css("width",at+"%");an.css("width",(100-at)+"%")}else{aw.css({width:aB+"px",height:aB+"px"})}aK.append(aD).append(aw).append(aA).append(an);ax.attr({src:az,"data-original":az});img=new Image();img.addEventListener("load",function(){aD.find(".dimensions").html(this.width+"&nbsp;&times;&nbsp;"+this.height);var aL=Math.min(this.width,this.height)/aB;ax.attr({width:this.width/aL,height:this.height/aL})},false);img.src=az;ay=new XMLHttpRequest();ay.upload.addEventListener("progress",function(aL){if(!aL.lengthComputable){return}u("body").addClass("pw-uploading");aC.attr("value",parseInt((aL.loaded/aL.total)*100));aE.css("display","block")},false);ay.addEventListener("load",function(){ay.getAllResponseHeaders();var aM=u.parseJSON(ay.responseText),aP=aM.length>1;if(aM.error!==undefined){aM=[aM]}for(var aR=0;aR<aM.length;aR++){var aO=aM[aR];if(aO.error){Z.append(U(aO.message));continue}var aL=null;var aN=u(aO.markup).hide();var aQ=X.find("input[type=file]");if(aQ.val()){aQ.replaceWith(aQ.clone(true))}if(aO.overwrite){aL=ap.children("#"+aN.attr("id"))}if(ab==1||aO.replace){aL=ap.children(".gridImage:eq(0)")}else{if(b.item&&aM.length==1){aL=b.item}}if(aL&&aL.length){aL.replaceWith(aN)}else{if(k&&k.length){k.before(aN);k=aN}else{if(aR===0){aK.replaceWith(aN)}else{ap.append(aN)}}}if(aq){aN.find(".gridImage__overflow").css("width",at+"%")}else{aN.find(".gridImage__overflow").css({height:aB+"px",width:aB+"px"});aN.find("img").hide()}aN.fadeIn(150,function(){aN.find("img").fadeIn();if(aq){l(ah,at)}else{j(ah,aB)}}).css("display","");aN.addClass("InputfieldFileItemExisting");if(aL&&aL.length){aN.effect("highlight",500)}if(aK.length){aK.remove()}if(b.item&&ab!=1){aN.find(".gridImage__edit").click();aN.find(".InputfieldFileReplace").val(b.file)}b.file="";b.item=null;b.edit=null}if(ad){clearTimeout(ad)}k=null;ad=setTimeout(function(){if(ab!=1){A(ap)}else{s(ah)}u("body").removeClass("pw-uploading");ap.trigger("AjaxUploadDone")},500);ah.trigger("change").removeClass("InputfieldFileEmpty")},false);if(b.edit){b.edit.find(".InputfieldImageEdit__close").click()}else{if(ah.find(".InputfieldImageEdit:visible").length){ah.find(".InputfieldImageEdit__close").click()}}ay.open("POST",S,true);ay.setRequestHeader("X-FILENAME",encodeURIComponent(aI.name));ay.setRequestHeader("X-FIELDNAME",R);ay.setRequestHeader("Content-Type","application/octet-stream");ay.setRequestHeader("X-"+V,aa);ay.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");ay.send(aI);if(b.item){b.item.replaceWith(aK);b.item=aK}else{if(k&&k.length){k.before(aK)}else{ap.append(aK)}}I();ah.trigger("change");var av=ah.find(".InputfieldFileItem").length;if(av==1){ah.removeClass("InputfieldFileEmpty").removeClass("InputfieldFileMultiple").addClass("InputfieldFileSingle")}else{if(av>1){ah.removeClass("InputfieldFileEmpty").removeClass("InputfieldFileSingle").addClass("InputfieldFileMultiple")}}}function ae(ar){var ao=function(aw){return parseInt(aw/1024,10)};if(typeof ar==="undefined"){aj.innerHTML="No support for the File API in this web browser";return}for(var ap=0,an=ar.length;ap<an;ap++){var av=ar[ap].name.split(".").pop().toLowerCase();var aq;if(al.indexOf(av)==-1){aq=av+" is a invalid file extension, please use one of:  "+al;Z.append(U(aq,ar[ap].name))}else{if(ar[ap].size>ag&&ag>2000000){var au=ao(ar[ap].size),at=ao(ag);aq="Filesize "+au+" kb is too big. Maximum allowed is "+at+" kb";Z.append(U(aq,ar[ap].name))}else{T(ar[ap])}}if(ab==1){break}}}Y.addEventListener("change",function(an){ae(this.files);an.preventDefault();an.stopPropagation();this.value=""},false)}function K(){var O=".InputfieldImageEdit__imagewrapper img";u(document).on("dragenter",O,function(){var R=u(this);if(R.closest(".InputfieldImageMax1").length){return}var S=R.attr("src");var P=R.closest(".InputfieldImageEdit");var Q=R.closest(".InputfieldImageEdit__imagewrapper");Q.addClass("InputfieldImageEdit__replace");b.file=new String(S).substring(S.lastIndexOf("/")+1);b.item=u("#"+P.attr("data-for"));b.edit=P}).on("dragleave",O,function(){var Q=u(this);if(Q.closest(".InputfieldImageMax1").length){return}var P=Q.closest(".InputfieldImageEdit__imagewrapper");P.removeClass("InputfieldImageEdit__replace");b.file="";b.item=null;b.edit=null})}K()}function G(){u(".InputfieldImage.Inputfield").each(function(){a(u(this))});w();if(r()){J("")}else{H()}u(document).on("reloaded",".InputfieldImage",function(){var K=u(this);a(K);J(K)}).on("wiretabclick",function(M,L,K){L.find(".InputfieldImage").each(function(){a(u(this))})}).on("opened",".InputfieldImage",function(){a(u(this))})}G()}jQuery(document).ready(function(a){InputfieldImage(a)});