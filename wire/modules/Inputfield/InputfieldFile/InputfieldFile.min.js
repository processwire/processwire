$(document).ready(function(){$(document).on("change",".InputfieldFileDelete input",function(){d($(this))}).on("dblclick",".InputfieldFileDelete",function(){var k=$(this).find("input");var j=$(this).parents(".InputfieldFileList").find(".InputfieldFileDelete input");if(k.is(":checked")){j.removeAttr("checked").change()}else{j.attr("checked","checked").change()}return false});function d(l){var j=l.parents(".InputfieldFileInfo");var k=l.closest(".InputfieldFile").hasClass("InputfieldItemListCollapse");if(l.is(":checked")){j.addClass("ui-state-error");if(!k){j.siblings(".InputfieldFileData").slideUp("fast")}}else{j.removeClass("ui-state-error");if(!k){j.siblings(".InputfieldFileData").slideDown("fast")}}}function i(j){j.each(function(){var l=$(this);var m=l.children("li").length;if(l.closest(".InputfieldRenderValueMode").length){return}var k=l.closest(".Inputfield");if(m<2){if(m==0){k.addClass("InputfieldFileEmpty").removeClass("InputfieldFileMultiple InputfieldFileSingle")}else{k.addClass("InputfieldFileSingle").removeClass("InputfieldFileEmpty InputfieldFileMultiple")}return}else{l.closest(".Inputfield").removeClass("InputfieldFileSingle InputfieldFileEmpty").addClass("InputfieldFileMultiple")}l.sortable({start:function(o,n){n.item.children(".InputfieldFileInfo").addClass("ui-state-highlight")},stop:function(o,n){$(this).children("li").each(function(p){$(this).find(".InputfieldFileSort").val(p)});n.item.children(".InputfieldFileInfo").removeClass("ui-state-highlight");k.addClass("InputfieldFileJustSorted InputfieldStateChanged");setTimeout(function(){k.removeClass("InputfieldFileJustSorted")},500)}})}).find(".ui-widget-header, .ui-state-default").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")})}function f(){$("body").addClass("ie-no-drop");$(document).on("change",".InputfieldFileUpload input[type=file]",function(){var n=$(this);var u=n.closest(".InputMask");if(n.val().length>1){u.addClass("ui-state-disabled")}else{u.removeClass("ui-state-disabled")}if(u.next(".InputMask").length>0){return}var j=n.closest(".InputfieldFile");var p=n.closest(".InputfieldFileUpload");var o=j.find(".InputfieldFileList");var t=parseInt(p.find(".InputfieldFileMaxFiles").val());var l=o.children("li").length+p.find("input[type=file]").length+1;var v=parseInt(p.attr("data-maxfilesize"));var m=false;p.find("input[type=file]").each(function(){if(typeof this.files[0]!=="undefined"){var w=this.files[0].size;if(w>v){ProcessWire.alert("File "+this.files[0].name+" is "+w+" bytes which exceeds max allowed size of "+v+" bytes");$(this).val("").closest(".InputMask").removeClass("ui-state-disabled ui-state-active");m=true}}});if(m){return false}if(t>0&&l>=t){}else{p.find(".InputMask").not(":last").each(function(){var w=$(this);if(w.find("input[type=file]").val()<1){w.remove()}});var s=u.clone().removeClass("ui-state-disabled");var r=s.find("input[type=file]");r.attr("id",r.attr("id")+"-");r.val("");s.insertAfter(u);s.css("margin-left","0.5em").removeClass("ui-state-active")}var k=n.val();var q=k.lastIndexOf("/");if(q===-1){q=k.lastIndexOf("\\")}k=k.substring(q+1);u.find(".ui-button-text").text(k).prepend("<i class='fa fa-fw fa-file-o'></i>");u.removeClass("ui-state-active")})}function b(k){if(k.length>0){var j=k.find(".InputfieldFileUpload")}else{var j=$(".InputfieldFileUpload")}j.closest(".InputfieldContent").each(function(m){if($(this).hasClass("InputfieldFileInit")){return}l($(this),m);$(this).addClass("InputfieldFileInit")});function l(t,B){var s=t.parents("form");var m=t.closest(".InputfieldRepeaterItem");var p=m.length?m.attr("data-editUrl"):s.attr("action");p+=(p.indexOf("?")>-1?"&":"?")+"InputfieldFileAjax=1";var F=s.find("input._post_token");var r=F.attr("name");var w=F.val();var D=t.find(".InputfieldFileUpload");var o=D.data("fieldname");o=o.slice(0,-2);var E=D.data("extensions").toLowerCase();var A=D.data("maxfilesize");var v=t.find("input[type=file]").get(0);var u=t.get(0);var n=t.find(".InputfieldFileList");if(n.size()<1){n=$("<ul class='InputfieldFileList InputfieldFileListBlank'></ul>");t.prepend(n);t.parent(".Inputfield").addClass("InputfieldFileEmpty")}var C=n.get(0);var x=parseInt(t.find(".InputfieldFileMaxFiles").val());n.children().addClass("InputfieldFileItemExisting");t.find(".AjaxUploadDropHere").show();var y=null;function q(I){var L=$('<li class="InputfieldFile ui-widget AjaxUpload"><p class="InputfieldFileInfo ui-widget ui-widget-header InputfieldItemHeader"></p></li>'),K=$('<div class="ui-progressbar ui-widget ui-widget-content ui-corner-all" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>'),J=$('<div class="ui-progressbar-value ui-widget-header InputfieldItemHeader ui-corner-left" style="width: 0%; "></div>'),M,N,P,O;K.append(J);L.append(K);P=new XMLHttpRequest();P.upload.addEventListener("progress",function(Q){if(Q.lengthComputable){var R=(Q.loaded/Q.total)*100;J.width(R+"%");if(R>4){J.html("<span>"+parseInt(R)+"%</span>")}$("body").addClass("pw-uploading")}else{}},false);P.addEventListener("load",function(){P.getAllResponseHeaders();var W=$.parseJSON(P.responseText);if(W.error!==undefined){W=[W]}for(var U=0;U<W.length;U++){var R=W[U];if(R.error){var V=L.clone();V.find(".InputfieldFileInfo").addClass("ui-state-error");V.find(".InputfieldFileStats").text(" - "+R.message);V.find(".ui-progressbar").remove();L.after(V)}else{if(R.replace){var T=t.find(".InputfieldFileList").children("li:eq(0)");if(T.size()>0){T.slideUp("fast",function(){T.remove()})}}var ab=t.find("input[type=file]");if(ab.val()){ab.replaceWith(ab.clone(true))}var Y=$(R.markup);Y.hide();if(R.overwrite){var aa=Y.find(".InputfieldFileName").text();var ac=null;n.children(".InputfieldFileItemExisting").each(function(){if(ac===null&&$(this).find(".InputfieldFileName").text()==aa){ac=$(this)}});if(ac!==null){var X=Y.find(".InputfieldFileInfo");var Q=Y.find(".InputfieldFileLink");var S=ac.find(".InputfieldFileInfo");var Z=ac.find(".InputfieldFileLink");S.html(X.html()+"<i class='fa fa-check'></i>");Z.html(Q.html());ac.addClass("InputfieldFileItemExisting");ac.effect("highlight",500)}else{n.append(Y);Y.slideDown();Y.addClass("InputfieldFileItemExisting")}}else{n.append(Y);Y.slideDown()}}}L.remove();if(y){clearTimeout(y)}y=setTimeout(function(){$("body").removeClass("pw-uploading");if(x!=1&&!n.is(".ui-sortable")){i(n)}n.trigger("AjaxUploadDone")},500)},false);P.open("POST",p,true);P.setRequestHeader("X-FILENAME",encodeURIComponent(I.name));P.setRequestHeader("X-FIELDNAME",o);P.setRequestHeader("Content-Type","application/octet-stream");P.setRequestHeader("X-"+r,w);P.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");P.send(I);O="<i class='fa fa-fw fa-spin fa-spinner'></i> <span class=\"InputfieldFileName\">"+I.name+'</span><span class="InputfieldFileStats"> &bull; '+parseInt(I.size/1024,10)+" kb</span>";L.find("p.ui-widget-header").html(O);n.append(L);var G=n.closest(".Inputfield");G.addClass("InputfieldStateChanged");var H=G.find(".InputfieldFileItem").length;if(H==1){G.removeClass("InputfieldFileEmpty").removeClass("InputfieldFileMultiple").addClass("InputfieldFileSingle")}else{if(H>1){G.removeClass("InputfieldFileEmpty").removeClass("InputfieldFileSingle").addClass("InputfieldFileMultiple")}}}function z(I){function J(L,M){return'<li class="InputfieldFile ui-widget AjaxUpload"><p class="InputfieldFileInfo ui-widget ui-widget-header InputfieldItemHeader ui-state-error">&nbsp; '+L+' <span class="InputfieldFileStats"> &bull; '+M+"</span></p></li>"}if(typeof I!=="undefined"){for(var H=0,G=I.length;H<G;H++){var K=I[H].name.split(".").pop().toLowerCase();if(E.indexOf(K)==-1){n.append(J(I[H].name,K+" is a invalid file extension, please use one of:  "+E))}else{if(I[H].size>A&&A>2000000){n.append(J(I[H].name,"Filesize "+parseInt(I[H].size/1024,10)+" kb is too big. Maximum allowed is "+parseInt(A/1024,10)+" kb"))}else{q(I[H])}}if(x==1){break}}}else{C.innerHTML="No support for the File API in this web browser"}}v.addEventListener("change",function(G){z(this.files);G.preventDefault();G.stopPropagation();this.value=""},false);u.addEventListener("dragleave",function(){$(this).removeClass("ui-state-hover");$(this).closest(".Inputfield").removeClass("pw-drag-in-file")},false);u.addEventListener("dragenter",function(G){G.preventDefault();$(this).addClass("ui-state-hover");$(this).closest(".Inputfield").addClass("pw-drag-in-file")},false);u.addEventListener("dragover",function(G){if(!$(this).is("ui-state-hover")){$(this).addClass("ui-state-hover");$(this).closest(".Inputfield").addClass("pw-drag-in-file")}G.preventDefault();G.stopPropagation()},false);u.addEventListener("drop",function(G){z(G.dataTransfer.files);$(this).removeClass("ui-state-hover").closest(".Inputfield").removeClass("pw-drag-in-file");G.preventDefault();G.stopPropagation()},false)}}function g(j){j.each(function(){var q=$(this);var o=q.find("input.InputfieldFileTagsInput:not(.selectized)");var m=q.find("input.InputfieldFileTagsSelect:not(.selectized)");if(o.length){o.selectize({plugins:["remove_button","drag_drop"],delimiter:" ",persist:false,createOnBlur:true,submitOnReturn:false,create:function(n){return{value:n,text:n}}})}if(m.length){if(!q.hasClass("Inputfield")){q=q.closest(".Inputfield")}var r=q.attr("data-configName");var p=ProcessWire.config[r];var l=[];for(var s=0;s<p.tags.length;s++){var k=p.tags[s];l[s]={value:k}}m.selectize({plugins:["remove_button","drag_drop"],delimiter:" ",persist:true,submitOnReturn:false,closeAfterSelect:true,createOnBlur:true,maxItems:null,valueField:"value",labelField:"value",searchField:["value"],options:l,create:function(n){return{value:n,text:n}},createFilter:function(t){if(p.allowUserTags){return true}allow=false;for(var u=0;u<l.length;u++){if(t==l[u]){allow=true;break}}return allow},onDropdownOpen:function(n){n.closest("li, .InputfieldImageEdit").css("z-index",100)},onDropdownClose:function(n){n.closest("li, .InputfieldImageEdit").css("z-index","auto")},render:{item:function(t,n){return"<div>"+n(t.value)+"</div>"},option:function(t,n){return"<div>"+n(t.value)+"</div>"}}})}})}i($(".InputfieldFileList"));g($(".InputfieldFileHasTags"));var a=false;if(window.File&&window.FileList&&window.FileReader&&($("#PageIDIndicator").length>0||$(".InputfieldAllowAjaxUpload").length>0)){b("");a=true}else{f()}var c=767;var h=false;var e=function(){if(!a){return}$(".AjaxUploadDropHere").each(function(){var j=$(this);if(j.parent().width()<=c){j.hide()}else{j.show()}});h=false};if(a){$(window).resize(function(){if(h){return}h=true;setTimeout(e,1000)}).resize();$(document).on("AjaxUploadDone",".InputfieldFileHasTags",function(j){g($(this))})}$(document).on("reloaded",".InputfieldHasFileList",function(j){i($(this).find(".InputfieldFileList"));b($(this));g($(this));if(a){e()}})});