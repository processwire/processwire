$(document).ready(function(){$(document).on("change",".InputfieldFileDelete input",function(){a($(this))}).on("dblclick",".InputfieldFileDelete",function(){var i=$(this).find("input");var h=$(this).parents(".InputfieldFileList").find(".InputfieldFileDelete input");if(i.is(":checked")){h.removeAttr("checked").change()}else{h.attr("checked","checked").change()}return false});function a(j){var h=j.parents(".InputfieldFileInfo");var i=j.closest(".InputfieldFile").hasClass("InputfieldItemListCollapse");if(j.is(":checked")){h.addClass("ui-state-error");if(!i){h.siblings(".InputfieldFileData").slideUp("fast")}}else{h.removeClass("ui-state-error");if(!i){h.siblings(".InputfieldFileData").slideDown("fast")}}}function c(h){h.each(function(){var j=$(this);var k=j.children("li").length;if(j.closest(".InputfieldRenderValueMode").length){return}var i=j.closest(".Inputfield");if(k<2){if(k==0){i.addClass("InputfieldFileEmpty").removeClass("InputfieldFileMultiple InputfieldFileSingle")}else{i.addClass("InputfieldFileSingle").removeClass("InputfieldFileEmpty InputfieldFileMultiple")}return}else{j.closest(".Inputfield").removeClass("InputfieldFileSingle InputfieldFileEmpty").addClass("InputfieldFileMultiple")}j.sortable({start:function(m,l){l.item.children(".InputfieldFileInfo").addClass("ui-state-highlight")},stop:function(m,l){$(this).children("li").each(function(o){$(this).find(".InputfieldFileSort").val(o)});l.item.children(".InputfieldFileInfo").removeClass("ui-state-highlight");i.addClass("InputfieldFileJustSorted InputfieldStateChanged");setTimeout(function(){i.removeClass("InputfieldFileJustSorted")},500)}})}).find(".ui-widget-header, .ui-state-default").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")})}function d(){$("body").addClass("ie-no-drop");$(document).on("change",".InputfieldFileUpload input[type=file]",function(){var k=$(this);var p=k.parent(".InputMask");if(k.val().length>1){p.addClass("ui-state-disabled")}else{p.removeClass("ui-state-disabled")}if(p.next(".InputMask").length>0){return}var h=k.closest(".InputfieldFile");var m=k.closest(".InputfieldFileUpload");var l=h.find(".InputfieldFileList");var o=parseInt(m.find(".InputfieldFileMaxFiles").val());var j=l.children("li").length+m.find("input[type=file]").length+1;if(o>0&&j>=o){return}m.find(".InputMask").not(":last").each(function(){var r=$(this);if(r.find("input[type=file]").val()<1){r.remove()}});var q=p.clone().removeClass("ui-state-disabled");q.children("input[type=file]").val("");q.insertAfter(p);q.css("margin-left","0.5em").removeClass("ui-state-active");var i=k.val();var n=i.lastIndexOf("/");if(n===-1){n=i.lastIndexOf("\\")}i=i.substring(n+1);p.find(".ui-button-text").text(i).prepend("<i class='fa fa-fw fa-file-o'></i>");p.removeClass("ui-state-active")})}function e(i){if(i.length>0){var h=i.find(".InputfieldFileUpload")}else{var h=$(".InputfieldFileUpload")}h.closest(".InputfieldContent").each(function(k){if($(this).hasClass("InputfieldFileInit")){return}j($(this),k);$(this).addClass("InputfieldFileInit")});function j(r,z){var q=r.parents("form");var k=r.closest(".InputfieldRepeaterItem");var n=k.length?k.attr("data-editUrl"):q.attr("action");n+=(n.indexOf("?")>-1?"&":"?")+"InputfieldFileAjax=1";var D=q.find("input._post_token");var p=D.attr("name");var u=D.val();var B=r.find(".InputfieldFileUpload");var m=B.data("fieldname");m=m.slice(0,-2);var C=B.data("extensions").toLowerCase();var y=B.data("maxfilesize");var t=r.find("input[type=file]").get(0);var s=r.get(0);var l=r.find(".InputfieldFileList");if(l.size()<1){l=$("<ul class='InputfieldFileList InputfieldFileListBlank'></ul>");r.prepend(l);r.parent(".Inputfield").addClass("InputfieldFileEmpty")}var A=l.get(0);var v=parseInt(r.find(".InputfieldFileMaxFiles").val());l.children().addClass("InputfieldFileItemExisting");r.find(".AjaxUploadDropHere").show();var w=null;function o(G){var J=$('<li class="InputfieldFile ui-widget AjaxUpload"><p class="InputfieldFileInfo ui-widget ui-widget-header InputfieldItemHeader"></p></li>'),I=$('<div class="ui-progressbar ui-widget ui-widget-content ui-corner-all" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>'),H=$('<div class="ui-progressbar-value ui-widget-header InputfieldItemHeader ui-corner-left" style="width: 0%; "></div>'),K,L,N,M;I.append(H);J.append(I);N=new XMLHttpRequest();N.upload.addEventListener("progress",function(O){if(O.lengthComputable){var P=(O.loaded/O.total)*100;H.width(P+"%");if(P>4){H.html("<span>"+parseInt(P)+"%</span>")}$("body").addClass("pw-uploading")}else{}},false);N.addEventListener("load",function(){N.getAllResponseHeaders();var U=$.parseJSON(N.responseText);if(U.error!==undefined){U=[U]}for(var S=0;S<U.length;S++){var P=U[S];if(P.error){var T=J.clone();T.find(".InputfieldFileInfo").addClass("ui-state-error");T.find(".InputfieldFileStats").text(" - "+P.message);T.find(".ui-progressbar").remove();J.after(T)}else{if(P.replace){var R=r.find(".InputfieldFileList").children("li:eq(0)");if(R.size()>0){R.slideUp("fast",function(){R.remove()})}}var Z=r.find("input[type=file]");if(Z.val()){Z.replaceWith(Z.clone(true))}var W=$(P.markup);W.hide();if(P.overwrite){var Y=W.find(".InputfieldFileName").text();var aa=null;l.children(".InputfieldFileItemExisting").each(function(){if(aa===null&&$(this).find(".InputfieldFileName").text()==Y){aa=$(this)}});if(aa!==null){var V=W.find(".InputfieldFileInfo");var O=W.find(".InputfieldFileLink");var Q=aa.find(".InputfieldFileInfo");var X=aa.find(".InputfieldFileLink");Q.html(V.html()+"<i class='fa fa-check'></i>");X.html(O.html());aa.addClass("InputfieldFileItemExisting");aa.effect("highlight",500)}else{l.append(W);W.slideDown();W.addClass("InputfieldFileItemExisting")}}else{l.append(W);W.slideDown()}}}J.remove();if(w){clearTimeout(w)}w=setTimeout(function(){$("body").removeClass("pw-uploading");if(v!=1&&!l.is(".ui-sortable")){c(l)}l.trigger("AjaxUploadDone")},500)},false);N.open("POST",n,true);N.setRequestHeader("X-FILENAME",encodeURIComponent(G.name));N.setRequestHeader("X-FIELDNAME",m);N.setRequestHeader("Content-Type","application/octet-stream");N.setRequestHeader("X-"+p,u);N.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");N.send(G);M="<i class='fa fa-fw fa-spin fa-spinner'></i> <span class=\"InputfieldFileName\">"+G.name+'</span><span class="InputfieldFileStats"> &bull; '+parseInt(G.size/1024,10)+" kb</span>";J.find("p.ui-widget-header").html(M);l.append(J);var E=l.closest(".Inputfield");E.addClass("InputfieldStateChanged");var F=E.find(".InputfieldFileItem").length;if(F==1){E.removeClass("InputfieldFileEmpty").removeClass("InputfieldFileMultiple").addClass("InputfieldFileSingle")}else{if(F>1){E.removeClass("InputfieldFileEmpty").removeClass("InputfieldFileSingle").addClass("InputfieldFileMultiple")}}}function x(G){function H(J,K){return'<li class="InputfieldFile ui-widget AjaxUpload"><p class="InputfieldFileInfo ui-widget ui-widget-header InputfieldItemHeader ui-state-error">&nbsp; '+J+' <span class="InputfieldFileStats"> &bull; '+K+"</span></p></li>"}if(typeof G!=="undefined"){for(var F=0,E=G.length;F<E;F++){var I=G[F].name.split(".").pop().toLowerCase();if(C.indexOf(I)==-1){l.append(H(G[F].name,I+" is a invalid file extension, please use one of:  "+C))}else{if(G[F].size>y&&y>2000000){l.append(H(G[F].name,"Filesize "+parseInt(G[F].size/1024,10)+" kb is too big. Maximum allowed is "+parseInt(y/1024,10)+" kb"))}else{o(G[F])}}if(v==1){break}}}else{A.innerHTML="No support for the File API in this web browser"}}t.addEventListener("change",function(E){x(this.files);E.preventDefault();E.stopPropagation();this.value=""},false);s.addEventListener("dragleave",function(){$(this).removeClass("ui-state-hover")},false);s.addEventListener("dragenter",function(){$(this).addClass("ui-state-hover")},false);s.addEventListener("dragover",function(E){if(!$(this).is("ui-state-hover")){$(this).addClass("ui-state-hover")}E.preventDefault();E.stopPropagation()},false);s.addEventListener("drop",function(E){x(E.dataTransfer.files);$(this).removeClass("ui-state-hover");E.preventDefault();E.stopPropagation()},false)}}c($(".InputfieldFileList"));if(window.File&&window.FileList&&window.FileReader&&($("#PageIDIndicator").length>0||$(".InputfieldAllowAjaxUpload").length>0)){e("")}else{d()}var g=767;var f=false;var b=function(){$(".AjaxUploadDropHere").each(function(){var h=$(this);if(h.parent().width()<=g){h.hide()}else{h.show()}});f=false};$(window).resize(function(){if(f){return}f=true;setTimeout(b,1000)}).resize();$(document).on("reloaded",".InputfieldHasFileList",function(h){c($(this).find(".InputfieldFileList"));e($(this));b()})});