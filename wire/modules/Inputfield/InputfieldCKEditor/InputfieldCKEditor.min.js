function ckeGetProcessWireConfig(e){var t="string"==typeof e?e:e.name,i=t.replace("Inputfield_","InputfieldCKEditor_"),n="",a={};return i=i.replace("Inputfield_","InputfieldCKEditor_"),void 0===ProcessWire.config[i]&&i.indexOf("_repeater")>0&&(i=i.replace(/_repeater[0-9]+/,""),n=$("#"+t).closest(".InputfieldRepeaterItem")),void 0===ProcessWire.config[i]&&i.indexOf("_ckeditor")>0&&(i=i.replace(/_ckeditor$/,"")),void 0===ProcessWire.config[i]&&i.indexOf("__")>0&&(i=i.replace(/__\d+$/,"")),void 0===ProcessWire.config[i]?a.error="Cannot find CKEditor settings for "+i:a=ProcessWire.config[i],n.length?a.repeaterItem=n:a.repeaterItem="",a}function ckeLoadPlugins(){for(var e in ProcessWire.config.InputfieldCKEditor.plugins){var t=ProcessWire.config.InputfieldCKEditor.plugins[e];CKEDITOR.plugins.addExternal(e,t,"")}}ckeLoadPlugins();function ckeBlurEvent(e){var t=e.editor,i=$(t.element.$);t.checkDirty()&&i.length&&(i.is("textarea")&&i.change(),i.closest(".Inputfield").addClass("InputfieldStateChanged"))}function ckeFocusEvent(e){var t=e.editor;$(t.element.$).trigger("pw-focus")}function ckeResizeEvent(e){var t=e.editor,i=$(t.element.$);i.length&&i.closest(".Inputfield").trigger("heightChanged")}function ckeUploadEvent(e){var t=e.data.fileLoader.xhr,i=e.data.fileLoader,n=ckeGetProcessWireConfig(e.editor),a=n?n.pwUploadField:"_unknown",r=$("#Inputfield_"+a);if(void 0!==n.repeaterItem&&n.repeaterItem.length){var o=n.repeaterItem.find(".InputfieldImage:not(.InputfieldFileSingle)");o.length&&(r=o)}if(!r.length)return void 0!==n.error&&n.error.length?ProcessWire.alert(n.error):ProcessWire.alert("Unable to find images field for upload"),e.stop(),!1;t.open("POST",i.uploadUrl,!0),r.trigger("pwimageupload",{name:i.fileName,file:i.file,xhr:t}),e.stop()}function ckeInitEvents(e){e.on("blur",ckeBlurEvent),e.on("focus",ckeFocusEvent),e.on("change",ckeBlurEvent),e.on("resize",ckeResizeEvent),e.on("fileUploadRequest",ckeUploadEvent,null,null,4);var t=$(e.element.$).closest(".Inputfield.InputfieldColumnWidth");t.length&&setTimeout(function(){t.trigger("heightChanged")},1e3)}function ckeSaveReadyInline(e){if(e.length){var t=e.hasClass(".InputfieldCKEditorInline")?e:e.find(".InputfieldCKEditorInline");t.length&&t.each(function(){var e,t=$(this);if(t.hasClass("InputfieldCKEditorLoaded")){var i=CKEDITOR.instances[t.attr("id")];void 0!==i&&(i.focusManager.hasFocus&&(i.focusManager.focus(!0),i.focus()),e=i.getData())}else e=t.html();t.next("input").attr("value",e)})}}function ckeSaveReadyNormal(e){(e.hasClass("InputfieldCKEditorNormal")?e:e.find(".InputfieldCKEditorNormal")).each(function(){var e=$(this);if(e.hasClass("InputfieldCKEditorLoaded")){CKEDITOR.instances[e.attr("id")].updateElement()}})}function ckeInlineActivateEvent(e){var t=$(this);if(!t.hasClass("InputfieldCKEditorLoaded")){t.effect("highlight",{},500),t.attr("contenteditable","true");var i=t.attr("data-configName");"focusin"==e.type&&CKEDITOR.once("instanceReady",function(e){$(":focus").blur(),e.editor.focus()});ckeInitEvents(CKEDITOR.inline($(this).attr("id"),ProcessWire.config[i])),t.addClass("InputfieldCKEditorLoaded")}}function ckeInitTab(e,t){var i=t.newTab.find("a");if(!i.hasClass("InputfieldCKEditor_init")){var n=i.attr("data-editorID"),a=i.attr("data-configName");ckeInitEvents(CKEDITOR.replace(n,config[a])),i.addClass("InputfieldCKEditor_init"),t.oldTab.find("a").addClass("InputfieldCKEditor_init");$("#"+n).addClass("InputfieldCKEditorLoaded")}}function ckeInitNormal(e){var t=$("#"+e),i=t.parent();if(void 0!==ProcessWire.config.InputfieldCKEditor.editors[e])var n=ProcessWire.config.InputfieldCKEditor.editors[e];else n=t.attr("data-configName");if(i.hasClass("ui-tabs-panel")&&"none"==i.css("display")){var a=t.parent().attr("id");i.closest(".ui-tabs, .langTabs").find("a[href=#"+a+"]").attr("data-editorID",e).attr("data-configName",n),i.closest(".ui-tabs, .langTabs").on("tabsactivate",ckeInitTab)}else{ckeInitEvents(CKEDITOR.replace(e,ProcessWire.config[n])),t.addClass("InputfieldCKEditorLoaded")}}$(document).ready(function(){CKEDITOR.timestamp=ProcessWire.config.InputfieldCKEditor.timestamp;for(var e in ProcessWire.config.InputfieldCKEditor.editors)ckeInitNormal(e);$(document).on("reloaded",".InputfieldCKEditor",function(){return $(this).find(".InputfieldCKEditorNormal:not(.InputfieldCKEditorLoaded)").each(function(){ckeInitNormal($(this).attr("id"))}),!1}),CKEDITOR.disableAutoInline=!0,$(document).on("mouseover focus",".InputfieldCKEditorInlineEditor",ckeInlineActivateEvent),$(document).on("submit","form.InputfieldForm",function(){ckeSaveReadyInline($(this))}),$(document).on("saveReady",".InputfieldCKEditor",function(){ckeSaveReadyNormal($(this)),ckeSaveReadyInline($(this))})});