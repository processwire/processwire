CKEDITOR.dialog.add("colordialog",function(c){function L(){O.getById(K).removeStyle("background-color");J.getContentElement("picker","selectedColor").setValue("");b()}function a(d){d=d.data.getTarget();var e;"td"==d.getName()&&(e=d.getChild(0).getHtml())&&(b(),P=d,P.setAttribute("aria-selected",!0),P.addClass("cke_colordialog_selected"),J.getContentElement("picker","selectedColor").setValue(e))}function b(){P&&(P.removeClass("cke_colordialog_selected"),P.removeAttribute("aria-selected"),P=null)}function s(e){e=e.replace(/^#/,"");for(var f=0,d=[];2>=f;f++){d[f]=parseInt(e.substr(2*f,2),16)}return 165<=0.2126*d[0]+0.7152*d[1]+0.0722*d[2]}function I(e){!e.name&&(e=new CKEDITOR.event(e));var h=!/mouse/.test(e.name),d=e.data.getTarget(),f;"td"==d.getName()&&(f=d.getChild(0).getHtml())&&(H(e),h?R=d:G=d,h&&d.addClass(s(f)?"cke_colordialog_focused_light":"cke_colordialog_focused_dark"),F(f))}function H(d){if(d=!/mouse/.test(d.name)&&R){d.removeClass("cke_colordialog_focused_light"),d.removeClass("cke_colordialog_focused_dark")}R||G||F(!1)}function F(d){d?(O.getById(j).setStyle("background-color",d),O.getById(i).setHtml(d)):(O.getById(j).removeStyle("background-color"),O.getById(i).setHtml("\x26nbsp;"))}function o(f){var l=f.data,d=l.getTarget(),h=l.getKeystroke(),k="rtl"==c.lang.dir;switch(h){case 38:if(f=d.getParent().getPrevious()){f=f.getChild([d.getIndex()]),f.focus()}l.preventDefault();break;case 40:(f=d.getParent().getNext())&&(f=f.getChild([d.getIndex()]))&&1==f.type&&f.focus();l.preventDefault();break;case 32:case 13:a(f);l.preventDefault();break;case k?37:39:(f=d.getNext())?1==f.type&&(f.focus(),l.preventDefault(!0)):(f=d.getParent().getNext())&&(f=f.getChild([0]))&&1==f.type&&(f.focus(),l.preventDefault(!0));break;case k?39:37:if(f=d.getPrevious()){f.focus(),l.preventDefault(!0)}else{if(f=d.getParent().getPrevious()){f=f.getLast(),f.focus(),l.preventDefault(!0)}}}}var g=CKEDITOR.dom.element,O=CKEDITOR.document,Q=c.lang.colordialog,J,P,w={type:"html",html:"\x26nbsp;"},R,G,M=function(d){return CKEDITOR.tools.getNextId()+"_"+d},j=M("hicolor"),i=M("hicolortext"),K=M("selhicolor"),N;(function(){function h(q,v){for(var p=q;p<q+3;p++){var t=new g(N.$.insertRow(-1));t.setAttribute("role","row");for(var u=v;u<v+3;u++){for(var r=0;6>r;r++){n(t.$,"#"+e[u]+e[r]+e[p])}}}}function n(p,r){var f=new g(p.insertCell(-1));f.setAttribute("class","ColorCell cke_colordialog_colorcell");f.setAttribute("tabIndex",-1);f.setAttribute("role","gridcell");f.on("keydown",o);f.on("click",a);f.on("focus",I);f.on("blur",H);f.setStyle("background-color",r);var q=M("color_table_cell");f.setAttribute("aria-labelledby",q);f.append(CKEDITOR.dom.element.createFromHtml('\x3cspan id\x3d"'+q+'" class\x3d"cke_voice_label"\x3e'+r+"\x3c/span\x3e",CKEDITOR.document))}N=CKEDITOR.dom.element.createFromHtml('\x3ctable tabIndex\x3d"-1" class\x3d"cke_colordialog_table" aria-label\x3d"'+Q.options+'" role\x3d"grid" style\x3d"border-collapse:separate;" cellspacing\x3d"0"\x3e\x3ccaption class\x3d"cke_voice_label"\x3e'+Q.options+'\x3c/caption\x3e\x3ctbody role\x3d"presentation"\x3e\x3c/tbody\x3e\x3c/table\x3e');N.on("mouseover",I);N.on("mouseout",H);var e="00 33 66 99 cc ff".split(" ");h(0,0);h(3,0);h(0,3);h(3,3);var k=new g(N.$.insertRow(-1));k.setAttribute("role","row");n(k.$,"#000000");for(var l=0;16>l;l++){var m=l.toString(16);n(k.$,"#"+m+m+m+m+m+m)}n(k.$,"#ffffff")})();CKEDITOR.document.appendStyleSheet(CKEDITOR.getUrl(CKEDITOR.plugins.get("colordialog").path+"dialogs/colordialog.css"));return{title:Q.title,minWidth:360,minHeight:220,onLoad:function(){J=this},onHide:function(){L();R.removeClass("cke_colordialog_focused_light");R.removeClass("cke_colordialog_focused_dark");F(!1);R=null},contents:[{id:"picker",label:Q.title,accessKey:"I",elements:[{type:"hbox",padding:0,widths:["70%","10%","30%"],children:[{type:"html",html:"\x3cdiv\x3e\x3c/div\x3e",onLoad:function(){CKEDITOR.document.getById(this.domId).append(N)},focus:function(){(R||this.getElement().getElementsByTag("td").getItem(0)).focus()}},w,{type:"vbox",padding:0,widths:["70%","5%","25%"],children:[{type:"html",html:"\x3cspan\x3e"+Q.highlight+'\x3c/span\x3e\x3cdiv id\x3d"'+j+'" style\x3d"border: 1px solid; height: 74px; width: 74px;"\x3e\x3c/div\x3e\x3cdiv id\x3d"'+i+'"\x3e\x26nbsp;\x3c/div\x3e\x3cspan\x3e'+Q.selected+'\x3c/span\x3e\x3cdiv id\x3d"'+K+'" style\x3d"border: 1px solid; height: 20px; width: 74px;"\x3e\x3c/div\x3e'},{type:"text",label:Q.selected,labelStyle:"display:none",id:"selectedColor",style:"width: 76px;margin-top:4px",onChange:function(){try{O.getById(K).setStyle("background-color",this.getValue())}catch(d){L()}}},w,{type:"button",id:"clear",label:Q.clear,onClick:L}]}]}]}]}});