(function(){CKEDITOR.dialog.add("templates",function(m){function i(g,f){var c=CKEDITOR.dom.element.createFromHtml('\x3ca href\x3d"javascript:void(0)" tabIndex\x3d"-1" role\x3d"option" \x3e\x3cdiv class\x3d"cke_tpl_item"\x3e\x3c/div\x3e\x3c/a\x3e'),h='\x3ctable style\x3d"width:350px;" class\x3d"cke_tpl_preview" role\x3d"presentation"\x3e\x3ctr\x3e';g.image&&f&&(h+='\x3ctd class\x3d"cke_tpl_preview_img"\x3e\x3cimg src\x3d"'+CKEDITOR.getUrl(f+g.image)+'"'+(CKEDITOR.env.ie6Compat?' onload\x3d"this.width\x3dthis.width"':"")+' alt\x3d"" title\x3d""\x3e\x3c/td\x3e');h+='\x3ctd style\x3d"white-space:normal;"\x3e\x3cspan class\x3d"cke_tpl_title"\x3e'+g.title+"\x3c/span\x3e\x3cbr/\x3e";g.description&&(h+="\x3cspan\x3e"+g.description+"\x3c/span\x3e");h+="\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e";c.getFirst().setHtml(h);c.on("click",function(){b(g.html)});return c}function b(f){var c=CKEDITOR.dialog.getCurrent();c.getValueOf("selectTpl","chkInsertOpt")?(m.fire("saveSnapshot"),m.setData(f,function(){c.hide();var g=m.createRange();g.moveToElementEditStart(m.editable());g.select();setTimeout(function(){m.fire("saveSnapshot")},0)})):(m.insertHtml(f),c.hide())}function a(h){var g=h.data.getTarget(),p=e.equals(g);if(p||e.contains(g)){var o=h.data.getKeystroke(),k=e.getElementsByTag("a"),n;if(k){if(p){n=k.getItem(0)}else{switch(o){case 40:n=g.getNext();break;case 38:n=g.getPrevious();break;case 13:case 32:g.fire("click")}}n&&(n.focus(),h.data.preventDefault())}}}var d=CKEDITOR.plugins.get("templates");CKEDITOR.document.appendStyleSheet(CKEDITOR.getUrl(d.path+"dialogs/templates.css"));var e,d="cke_tpl_list_label_"+CKEDITOR.tools.getNextNumber(),j=m.lang.templates,l=m.config;return{title:m.lang.templates.title,minWidth:CKEDITOR.env.ie?440:400,minHeight:340,contents:[{id:"selectTpl",label:j.title,elements:[{type:"vbox",padding:5,children:[{id:"selectTplText",type:"html",html:"\x3cspan\x3e"+j.selectPromptMsg+"\x3c/span\x3e"},{id:"templatesList",type:"html",focus:!0,html:'\x3cdiv class\x3d"cke_tpl_list" tabIndex\x3d"-1" role\x3d"listbox" aria-labelledby\x3d"'+d+'"\x3e\x3cdiv class\x3d"cke_tpl_loading"\x3e\x3cspan\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cspan class\x3d"cke_voice_label" id\x3d"'+d+'"\x3e'+j.options+"\x3c/span\x3e"},{id:"chkInsertOpt",type:"checkbox",label:j.insertOption,"default":l.templates_replaceContent}]}]}],buttons:[CKEDITOR.dialog.cancelButton],onShow:function(){var c=this.getContentElement("selectTpl","templatesList");e=c.getElement();CKEDITOR.loadTemplates(l.templates_files,function(){var v=(l.templates||"default").split(",");if(v.length){var u=e;u.setHtml("");for(var t=0,r=v.length;t<r;t++){for(var s=CKEDITOR.getTemplates(v[t]),o=s.imagesPath,s=s.templates,f=s.length,n=0;n<f;n++){var g=i(s[n],o);g.setAttribute("aria-posinset",n+1);g.setAttribute("aria-setsize",f);u.append(g)}}c.focus()}else{e.setHtml('\x3cdiv class\x3d"cke_tpl_empty"\x3e\x3cspan\x3e'+j.emptyListMsg+"\x3c/span\x3e\x3c/div\x3e")}});this._.element.on("keydown",a)},onHide:function(){this._.element.removeListener("keydown",a)}}})})();