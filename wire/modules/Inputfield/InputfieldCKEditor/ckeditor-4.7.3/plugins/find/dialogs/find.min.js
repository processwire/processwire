(function(){function e(h){return h.type==CKEDITOR.NODE_TEXT&&0<h.getLength()&&(!c||!h.isReadOnly())}function a(h){return !(h.type==CKEDITOR.NODE_ELEMENT&&h.isBlockBoundary(CKEDITOR.tools.extend({},CKEDITOR.dtd.$empty,CKEDITOR.dtd.$nonEditable)))}function d(p,l){function k(q,n){var t=this,u=new CKEDITOR.dom.walker(q);u.guard=n?a:function(x){!a(x)&&(t._.matchBoundary=!0)};u.evaluator=e;u.breakOnFalse=1;q.startContainer.type==CKEDITOR.NODE_TEXT&&(this.textNode=q.startContainer,this.offset=q.startOffset-1);this._={matchWord:n,walker:u,matchBoundary:!1}}function i(q,n){var t=p.createRange();t.setStart(q.textNode,n?q.offset:q.offset+1);t.setEndAt(p.editable(),CKEDITOR.POSITION_BEFORE_END);return t}function w(q){var n=p.getSelection().getRanges()[0],t=p.editable();n&&!q?(q=n.clone(),q.collapse(!0)):(q=p.createRange(),q.setStartAt(t,CKEDITOR.POSITION_AFTER_START));q.setEndAt(t,CKEDITOR.POSITION_BEFORE_END);return q}var s=new CKEDITOR.style(CKEDITOR.tools.extend({attributes:{"data-cke-highlight":1},fullMatch:1,ignoreReadonly:1,childRule:function(){return 0}},p.config.find_highlight,!0));k.prototype={next:function(){return this.move()},back:function(){return this.move(!0)},move:function(q){var n=this.textNode;if(null===n){return g.call(this)}this._.matchBoundary=!1;if(n&&q&&0<this.offset){this.offset--}else{if(n&&this.offset<n.getLength()-1){this.offset++}else{for(n=null;!n&&!(n=this._.walker[q?"previous":"next"].call(this._.walker),this._.matchWord&&!n||this._.walker._.end);){}this.offset=(this.textNode=n)?q?n.getLength()-1:0:0}}return g.call(this)}};var v=function(q,n){this._={walker:q,cursors:[],rangeLength:n,highlightRange:null,isMatched:0}};v.prototype={toDomRange:function(){var q=p.createRange(),n=this._.cursors;if(1>n.length){var t=this._.walker.textNode;if(t){q.setStartAfter(t)}else{return null}}else{t=n[0],n=n[n.length-1],q.setStart(t.textNode,t.offset),q.setEnd(n.textNode,n.offset+1)}return q},updateFromDomRange:function(q){var n=new k(q);this._.cursors=[];do{q=n.next(),q.character&&this._.cursors.push(q)}while(q.character);this._.rangeLength=this._.cursors.length},setMatched:function(){this._.isMatched=!0},clearMatched:function(){this._.isMatched=!1},isMatched:function(){return this._.isMatched},highlight:function(){if(!(1>this._.cursors.length)){this._.highlightRange&&this.removeHighlight();var q=this.toDomRange(),n=q.createBookmark();s.applyToRange(q,p);q.moveToBookmark(n);this._.highlightRange=q;n=q.startContainer;n.type!=CKEDITOR.NODE_ELEMENT&&(n=n.getParent());n.scrollIntoView();this.updateFromDomRange(q)}},removeHighlight:function(){if(this._.highlightRange){var n=this._.highlightRange.createBookmark();s.removeFromRange(this._.highlightRange,p);this._.highlightRange.moveToBookmark(n);this.updateFromDomRange(this._.highlightRange);this._.highlightRange=null}},isReadOnly:function(){return this._.highlightRange?this._.highlightRange.startContainer.isReadOnly():0},moveBack:function(){var q=this._.walker.back(),n=this._.cursors;q.hitMatchBoundary&&(this._.cursors=n=[]);n.unshift(q);n.length>this._.rangeLength&&n.pop();return q},moveNext:function(){var q=this._.walker.next(),n=this._.cursors;q.hitMatchBoundary&&(this._.cursors=n=[]);n.push(q);n.length>this._.rangeLength&&n.shift();return q},getEndCharacter:function(){var n=this._.cursors;return 1>n.length?null:n[n.length-1].character},getNextCharacterRange:function(q){var n,t;t=this._.cursors;t=(n=t[t.length-1])&&n.textNode?new k(i(n)):this._.walker;return new v(t,q)},getCursors:function(){return this._.cursors}};var r=function(q,n){var t=[-1];n&&(q=q.toLowerCase());for(var u=0;u<q.length;u++){for(t.push(t[u]+1);0<t[u+1]&&q.charAt(u)!=q.charAt(t[u+1]-1);){t[u+1]=t[t[u+1]-1]+1}}this._={overlap:t,state:0,ignoreCase:!!n,pattern:q}};r.prototype={feedCharacter:function(n){for(this._.ignoreCase&&(n=n.toLowerCase());;){if(n==this._.pattern.charAt(this._.state)){return this._.state++,this._.state==this._.pattern.length?(this._.state=0,2):1}if(this._.state){this._.state=this._.overlap[this._.state]}else{return 0}}},reset:function(){this._.state=0}};var h=/[.,"'?!;: \u0085\u00a0\u1680\u280e\u2028\u2029\u202f\u205f\u3000]/,j=function(q){if(!q){return !0}var n=q.charCodeAt(0);return 9<=n&&13>=n||8192<=n&&8202>=n||h.test(q)},o={searchRange:null,matchRange:null,find:function(D,C,B,z,A,F){this.matchRange?(this.matchRange.removeHighlight(),this.matchRange=this.matchRange.getNextCharacterRange(D.length)):this.matchRange=new v(new k(this.searchRange),D.length);for(var u=new r(D,!C),t=0,q="%";null!==q;){for(this.matchRange.moveNext();q=this.matchRange.getEndCharacter();){t=u.feedCharacter(q);if(2==t){break}this.matchRange.moveNext().hitMatchBoundary&&u.reset()}if(2==t){if(B){var x=this.matchRange.getCursors(),n=x[x.length-1],x=x[0],y=p.createRange();y.setStartAt(p.editable(),CKEDITOR.POSITION_AFTER_START);y.setEnd(x.textNode,x.offset);x=y;n=i(n);x.trim();n.trim();x=new k(x,!0);n=new k(n,!0);if(!j(x.back().character)||!j(n.next().character)){continue}}this.matchRange.setMatched();!1!==A&&this.matchRange.highlight();return !0}}this.matchRange.clearMatched();this.matchRange.removeHighlight();return z&&!F?(this.searchRange=w(1),this.matchRange=null,arguments.callee.apply(this,Array.prototype.slice.call(arguments).concat([!0]))):!1},replaceCounter:0,replace:function(t,n,A,y,z,x,u){c=1;t=0;t=this.hasMatchOptionsChanged(n,y,z);if(!this.matchRange||!this.matchRange.isMatched()||this.matchRange._.isReplaced||this.matchRange.isReadOnly()||t){t&&this.matchRange&&(this.matchRange.clearMatched(),this.matchRange.removeHighlight(),this.matchRange=null),t=this.find(n,y,z,x,!u)}else{this.matchRange.removeHighlight();n=this.matchRange.toDomRange();A=p.document.createText(A);if(!u){var q=p.getSelection();q.selectRanges([n]);p.fire("saveSnapshot")}n.deleteContents();n.insertNode(A);u||(q.selectRanges([n]),p.fire("saveSnapshot"));this.matchRange.updateFromDomRange(n);u||this.matchRange.highlight();this.matchRange._.isReplaced=!0;this.replaceCounter++;t=1}c=0;return t},matchOptions:null,hasMatchOptionsChanged:function(q,n,t){q=[q,n,t].join(".");n=this.matchOptions&&this.matchOptions!=q;this.matchOptions=q;return n}},m=p.lang.find;return{title:m.title,resizable:CKEDITOR.DIALOG_RESIZE_NONE,minWidth:350,minHeight:170,buttons:[CKEDITOR.dialog.cancelButton(p,{label:p.lang.common.close})],contents:[{id:"find",label:m.find,title:m.find,accessKey:"",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindFind",label:m.findWhat,isChanged:!1,labelLayout:"horizontal",accessKey:"F"},{type:"button",id:"btnFind",align:"left",style:"width:100%",label:m.find,onClick:function(){var n=this.getDialog();o.find(n.getValueOf("find","txtFindFind"),n.getValueOf("find","txtFindCaseChk"),n.getValueOf("find","txtFindWordChk"),n.getValueOf("find","txtFindCyclic"))||alert(m.notFoundMsg)}}]},{type:"fieldset",className:"cke_dialog_find_fieldset",label:CKEDITOR.tools.htmlEncode(m.findOptions),style:"margin-top:29px",children:[{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtFindCaseChk",isChanged:!1,label:m.matchCase},{type:"checkbox",id:"txtFindWordChk",isChanged:!1,label:m.matchWord},{type:"checkbox",id:"txtFindCyclic",isChanged:!1,"default":!0,label:m.matchCyclic}]}]}]},{id:"replace",label:m.replace,accessKey:"M",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindReplace",label:m.findWhat,isChanged:!1,labelLayout:"horizontal",accessKey:"F"},{type:"button",id:"btnFindReplace",align:"left",style:"width:100%",label:m.replace,onClick:function(){var n=this.getDialog();o.replace(n,n.getValueOf("replace","txtFindReplace"),n.getValueOf("replace","txtReplace"),n.getValueOf("replace","txtReplaceCaseChk"),n.getValueOf("replace","txtReplaceWordChk"),n.getValueOf("replace","txtReplaceCyclic"))||alert(m.notFoundMsg)}}]},{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtReplace",label:m.replaceWith,isChanged:!1,labelLayout:"horizontal",accessKey:"R"},{type:"button",id:"btnReplaceAll",align:"left",style:"width:100%",label:m.replaceAll,isChanged:!1,onClick:function(){var n=this.getDialog();o.replaceCounter=0;o.searchRange=w(1);o.matchRange&&(o.matchRange.removeHighlight(),o.matchRange=null);for(p.fire("saveSnapshot");o.replace(n,n.getValueOf("replace","txtFindReplace"),n.getValueOf("replace","txtReplace"),n.getValueOf("replace","txtReplaceCaseChk"),n.getValueOf("replace","txtReplaceWordChk"),!1,!0);){}o.replaceCounter?(alert(m.replaceSuccessMsg.replace(/%1/,o.replaceCounter)),p.fire("saveSnapshot")):alert(m.notFoundMsg)}}]},{type:"fieldset",label:CKEDITOR.tools.htmlEncode(m.findOptions),children:[{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtReplaceCaseChk",isChanged:!1,label:m.matchCase},{type:"checkbox",id:"txtReplaceWordChk",isChanged:!1,label:m.matchWord},{type:"checkbox",id:"txtReplaceCyclic",isChanged:!1,"default":!0,label:m.matchCyclic}]}]}]}],onLoad:function(){var q=this,n,t=0;this.on("hide",function(){t=0});this.on("show",function(){t=1});this.selectPage=CKEDITOR.tools.override(this.selectPage,function(u){return function(C){u.call(q,C);var B=q._.tabs[C],z;z="find"===C?"txtFindWordChk":"txtReplaceWordChk";n=q.getContentElement(C,"find"===C?"txtFindFind":"txtFindReplace");q.getContentElement(C,z);B.initialized||(CKEDITOR.document.getById(n._.inputId),B.initialized=!0);if(t){var y;C="find"===C?1:0;var B=1-C,x,A=b.length;for(x=0;x<A;x++){z=this.getContentElement(f[C],b[x][C]),y=this.getContentElement(f[B],b[x][B]),y.setValue(z.getValue())}}}})},onShow:function(){o.searchRange=w();var q=this.getParentEditor().getSelection().getSelectedText(),n=this.getContentElement(l,"find"==l?"txtFindFind":"txtFindReplace");n.setValue(q);n.select();this.selectPage(l);this[("find"==l&&this._.editor.readOnly?"hide":"show")+"Page"]("replace")},onHide:function(){var n;o.matchRange&&o.matchRange.isMatched()&&(o.matchRange.removeHighlight(),(n=o.matchRange.toDomRange())&&p.getSelection().selectRanges([n]),p.focus());delete o.matchRange},onFocus:function(){return"replace"==l?this.getContentElement("replace","txtFindReplace"):this.getContentElement("find","txtFindFind")}}}var c,g=function(){return{textNode:this.textNode,offset:this.offset,character:this.textNode?this.textNode.getText().charAt(this.offset):null,hitMatchBoundary:this._.matchBoundary}},f=["find","replace"],b=[["txtFindFind","txtFindReplace"],["txtFindCaseChk","txtReplaceCaseChk"],["txtFindWordChk","txtReplaceWordChk"],["txtFindCyclic","txtReplaceCyclic"]];CKEDITOR.dialog.add("find",function(h){return d(h,"find")});CKEDITOR.dialog.add("replace",function(h){return d(h,"replace")})})();