function enablePWImageDialogButtons(){var a=parent.jQuery(".ui-dialog-buttonpane");a.find("button").button("enable");return}function disablePWImageDialogButtons(){var a=parent.jQuery(".ui-dialog-buttonpane");a.find("button").button("disable");return}function closePWImageDialog(){parent.jQuery("iframe.ui-dialog-content").dialog("close")}function setupProcessSaveReloaded(b,a){if(a){var c=parent.jQuery("#"+b).offset().top-20;parent.jQuery("html, body").animate({scrollTop:c},1000,"swing");parent.jQuery("#"+b).hide();setTimeout(function(){parent.jQuery("#"+b).slideDown()},900)}else{parent.jQuery("#"+b).find("img").hide();setTimeout(function(){parent.jQuery("#"+b).find("img").fadeIn("normal",function(){parent.jQuery("#"+b).find(".gridImage__edit").click()})},500)}closePWImageDialog()}function setupProcessSave(e,b,a){var d=false;var c=parent.jQuery("#wrap_Inputfield_"+e);if(!c.length){c=parent.jQuery("#"+b).closest(".Inputfield")}c.trigger("reload");parent.jQuery(".Inputfield").on("reloaded",function(){if(d){return}d=true;if(b.length>0){setTimeout(function(){setupProcessSaveReloaded(b,a)},250)}})}function refreshPageEditField(a){parent.jQuery("#wrap_Inputfield_"+a).trigger("reload")}function setupExecuteVariations(){$(document).on("click","input#delete_all",function(e){if($(this).is(":checked")){$("input.delete").attr("checked","checked")}else{$("input.delete").removeAttr("checked")}e.stopPropagation()});var d={type:"image",closeOnContentClick:true,closeBtnInside:true};$("a.preview").magnificPopup(d);var c=$("#varcnt_id");var a=c.val();var b=c.attr("data-cnt");window.parent.jQuery("#"+a).text(b)}function setupSelectedImage(){var f=false;var i=$("#selected_image_settings");var h=$("#selected_image_container");var b=$("#selected_image");var d=$("#selected_image_hidpi");var e;var c=parseInt($("#input_width").data("min"));var g=parseInt($("#input_height").data("min"));function a(k){var m=k.width();var v=$("#input_width").data("max");var w=$("#input_height").data("max");function u(x){if(x<(e-(e*0.2))){if(!d.is(":visible")){d.closest("label").fadeIn()}d.removeAttr("disabled")}else{d.attr("disabled","disabled");if(d.is(":visible")){d.closest("label").fadeOut()}}}function s(){var y=k.width();var A=k.height();var z=$("#wrap_link_original");if((A>=w||y>=v)&&i.hasClass("croppable")){y=v;A=w;$("#selected_image_link").removeAttr("checked");z.hide()}else{if(!z.is(":visible")){z.fadeIn();if(z.attr("data-was-checked")==1){z.attr("checked","checked")}}}$("#input_width").val(y);$("#input_height").val(A);k.attr("width",y);k.attr("height",A);u(y);var x=$("#latin");if(x.is(":visible")){x.height(A)}if(!i.hasClass("rte")){var B=$("#selected_image_resize");if(m<=y){B.hide()}else{if(!B.is(":visible")){B.fadeIn()}}}}function t(){k.resizable({aspectRatio:true,handles:"n, ne, e, se, s, sw, w",alsoResize:"#selected_image_container",maxWidth:v,maxHeight:w,minWidth:c<10?10:c,minHeight:g<10?10:g,start:function(){i.addClass("resizing_active")},stop:function(){k.attr("width",k.width()).attr("height",k.height());if(m!=k.width()){k.addClass("resized");if(!i.hasClass("rte")){var x=$("#selected_image_resize_yes");if(!x.is(":checked")){x.attr("checked","checked");$("#selected_image_resize_no").removeAttr("checked")}}}i.removeClass("resizing_active");if($("#resize_action").hasClass("on")){$("#resize_action").click().mouseout()}},resize:s});k.addClass("resizable_setup")}var l=null;function q(){var x=[{html:$("#button_crop").html(),click:function(){$("#button_crop").click()}},{html:$("#button_cancel_crop").html(),click:function(){$("#button_cancel_crop").click()},"class":"ui-priority-secondary"}];$(".show_when_crop").hide();$("#crop_action, .crop_trigger").click(function(D){var B=$(this).attr("data-recrop");if(B&&B.length>0){window.location.assign(B);return true}if(!i.hasClass("croppable")){return}if(f){return false}f=true;$("#selected_image_settings").addClass("cropping_active");$(".hide_when_crop").hide();$(".show_when_crop").show();if(k.hasClass("resizable_setup")){k.resizable("destroy")}var A={autoCrop:true,autoCropArea:0.35,zoomable:false,rotatable:false,maxWidth:k.attr("data-origwidth"),maxHeight:k.attr("data-origheight"),minCropBoxWidth:(c<2?0:c),minCropBoxHeight:(g<2?0:g),minWidth:(c<2?0:c),minHeight:(g<2?0:g),done:function(E){$("#crop_x").val(Math.floor(E.x));$("#crop_y").val(Math.floor(E.y));$("#crop_w").val(Math.floor(E.width));$("#crop_h").val(Math.floor(E.height));l=E}};var C=k.attr("data-crop");if(C&&C.length>0){C=C.split(",");A.data={x:C[0],y:C[1],width:C[2],height:C[3]};setTimeout(function(){disablePWImageDialogButtons(x)},1000)}else{disablePWImageDialogButtons(x)}k.cropper(A);setTimeout(function(){$(".cropper-canvas").width($(".cropper-container").width()).height($(".cropper-container").height())},500);var z=function(){var E={x:parseInt($("#crop_x").val()),y:parseInt($("#crop_y").val()),width:parseInt($("#crop_w").val()),height:parseInt($("#crop_h").val()),rotate:0};k.cropper("setData",E)};$("#crop_coordinates input").change(z)});function y(){k.cropper("destroy");$(".show_when_crop").hide();$(".hide_when_crop").show();f=false;$("#selected_image_settings").removeClass("cropping_active");t();enablePWImageDialogButtons()}$("#button_cancel_crop").click(function(){y()});$("#button_crop").click(function(){if(i.hasClass("processing")){return false}i.addClass("processing");return true});if(k.attr("data-crop")){$("#crop_action").click()}}function n(){if($(this).parents("#crop_coordinates").length){return}var x,y;if($(this).attr("id")=="input_width"){x=parseInt($(this).val());y=(x/k.attr("width"))*k.attr("height")}else{y=parseInt($(this).val());x=(y/k.attr("height"))*k.attr("width")}x=Math.floor(x);y=Math.floor(y);if(x<1||y<1||x==k.attr("width")||y==k.attr("height")||x>v||(c>1&&x<c)||(g>1&&y<g)){$("#input_width").val(k.attr("width"));$("#input_height").val(k.attr("height"));return false}t();$("#input_height").val(y);h.width(x).height(y);k.parent(".ui-wrapper").width(x).height(y);k.width(x).height(y).attr("width",x).attr("height",y);k.addClass("resized");s()}function o(){var y=k.is(".resized");k.attr("class",$(this).val());h.attr("class",$(this).val());if(y){k.addClass("resized")}var z=h.css("float");var x=$("#latin");if(z=="left"||z=="right"){if(!x.is(":visible")){x.height(h.height());x.fadeIn()}}else{if(x.is(":visible")){x.hide()}}t()}function p(){$("#max_action").click(function(){var y=parseInt(k.attr("data-origwidth"));if(y>v){y=v}$("#input_width").val(y).change()});$("#min_action").click(function(){var A=k.width();var y=k.height();var B=$(window).width()-30;var C=$(window).height()-$("#wrap_info").height()-20;var z=false;if(y>C){$("#input_height").val(C).change();z=true}if(A>B){$("#input_width").val(B).change();z=true}if(!z){$("#input_width").val(Math.ceil(A/2)).change()}});$("#align_left_action, #align_center_action, #align_right_action").click(function(){var z=$("#selected_image_class");var y=$(this).attr("data-label");if($(this).hasClass("on")){z.children("option").removeAttr("selected");$(this).removeClass("on")}else{$(this).siblings(".on").removeClass("on");z.children("option").removeAttr("selected");z.find("option[data-label="+y+"]").attr("selected","selected");$(this).addClass("on")}z.change()});var x=$("#selected_image_class").find("option[selected=selected]").attr("data-label");if(x){$("#action_icons").find("span[data-label="+x+"]").addClass("on")}$("#resize_action").hover(function(){if($(this).hasClass("on")){return}$("#resize_tips").show();$("#input_width, #input_height").addClass("ui-state-highlight")},function(){if($(this).hasClass("on")){return}$("#resize_tips").hide();$("#input_width, #input_height").removeClass("ui-state-highlight")}).click(function(){if($(this).hasClass("on")){$(this).removeClass("on");$("#input_width, #input_height").removeClass("ui-state-highlight")}else{$(this).addClass("on");$("#input_width, #input_height").addClass("ui-state-highlight")}});$("#description_action").click(function(){if($(this).hasClass("on")){$(this).removeClass("on");$("#wrap_description").slideUp("fast")}else{$(this).addClass("on");$("#wrap_description").slideDown("fast")}})}function j(){$("#selected_image_caption").change(function(){if(i.hasClass("cropping_active")){return}var x=$("#caption_preview");if($(this).is(":checked")){x.fadeIn()}else{if(x.is(":visible")){x.fadeOut()}}}).change()}function r(){var y=$(window).width()-30;var x=$(window).height()-($("#wrap_info").height()+80);if(k.width()>y){k.width(y).css("height","auto").removeAttr("height");k.removeAttr("height")}if(k.height()>x){k.removeAttr("width").css("width","auto").height(x)}h.width(k.width()).height(k.height())}$("#loading_button").hide();if(k.attr("data-fit")){r()}else{h.width(k.width()).height(k.height())}$("#selected_image_settings .input_pixels").change(n);$("#selected_image_class").change(o).change();e=k.attr("data-origwidth");s();q();p();j();$("button.submit_save_copy, button.submit_save_replace").click(function(){i.addClass("processing");disablePWImageDialogButtons()})}if(b.length>0){b=b.first();if(b.width()>0&&b.height()>0){a(b)}else{b.load(function(){b=$(this);a(b)})}}}$(document).ready(function(){var b=$("#page_id");if(b.length>0){var a=b.val();b.bind("pageSelected",function(c,d){if(d.id==a){return}window.location="./?id="+d.id+"&modal=1"})}if($("#selected_image").length>0){setupSelectedImage()}else{if($("#ImageVariations").length>0){setupExecuteVariations()}}enablePWImageDialogButtons();$(window).keydown(function(c){if(c.keyCode==13){c.preventDefault();return false}})});
