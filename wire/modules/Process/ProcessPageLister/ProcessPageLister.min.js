var ProcessLister={inInit:true,inTimeout:false,spinner:null,numSubmits:0,results:null,filters:null,lister:null,initialized:false,resetTotal:false,clickAfterRefresh:"",refreshRowPageIDs:[],extraSubmitData:{},init:function(){if(ProcessLister.initialized){return}ProcessLister.initialized=true;if($("#ProcessLister").length==0){return}ProcessLister.spinner=$("<li class='title' id='ProcessListerSpinner'><i class='fa fa-lg fa-spin fa-spinner'></i></li>");$("#breadcrumbs ul.nav").append(ProcessLister.spinner);ProcessLister.filters=$("#ProcessListerFilters");ProcessLister.results=$("#ProcessListerResults");ProcessLister.lister=$("#ProcessLister");ProcessLister.filters.change(function(){ProcessLister.submit()});ProcessLister.results.on("click",".ProcessListerTable > thead th",ProcessLister.columnSort);$(document).on("click","a.actions_toggle",ProcessLister.pageClick);$(document).on("click",".actions a.ajax",ProcessLister.actionClickAjax);$("#actions_items_open").attr("disabled","disabled").parent("label").addClass("ui-state-disabled");$(document).on("click",".MarkupPagerNav a",function(){var a=$(this).attr("href");ProcessLister.submit(a);return false});$("#submit_refresh").click(function(){ProcessLister.resetTotal=true;ProcessLister.submit();$(this).fadeOut("normal",function(){$("#submit_refresh").removeClass("ui-state-active").fadeIn()});return false});$("#lister_columns").change(function(){ProcessLister.submit()});$("#ProcessListerActionsForm").find("script").remove();if(ProcessLister.lister.size()>0){ProcessLister.lister.WireTabs({items:$(".WireTab")})}$("#_ProcessListerRefreshTab").html("<i class='fa fa-refresh ui-priority-secondary'></i>").unbind("click").click(function(){ProcessLister.resetTotal=true;ProcessLister.submit();return false});$("#_ProcessListerResetTab").html("<i class='fa fa-rotate-left ui-priority-secondary'></i>").unbind("click").click(function(){window.location.href="./?reset=1";return false});ProcessLister.inInit=false;if(ProcessLister.numSubmits==0){ProcessLister.submit()}else{ProcessLister.spinner.fadeOut()}},columnSort:function(){$(this).find("span").remove();var a=$(this).find("b").text();var b=$("#lister_sort").val();if(b==a){a="-"+a}if(a.length<1){a=b}$("#lister_sort").val(a);ProcessLister.submit()},submit:function(a){if(ProcessLister.inTimeout){clearTimeout(ProcessLister.inTimeout)}ProcessLister.inTimeout=setTimeout(function(){ProcessLister._submit(a)},250)},_submit:function(c){var e=true;if(ProcessLister.refreshRowPageIDs.length==0){var a=ProcessLister.results.find(".InputfieldFormConfirm");if(a.length){var g=InputfieldFormBeforeUnloadEvent(true);if(typeof g!="undefined"&&g.length){if(!confirm(g)){return false}}}}else{e=false}ProcessLister.numSubmits++;if(typeof c=="undefined"){var c="./"}ProcessLister.spinner.fadeIn("fast");var b={filters:e?ProcessLister.filters.val():"",columns:$("#lister_columns").val(),sort:$("#lister_sort").val()};for(var d in ProcessLister.extraSubmitData){var f=ProcessLister.extraSubmitData[d];b[d]=f}ProcessLister.extraSubmitData={};if(ProcessLister.resetTotal){b.reset_total=1;ProcessLister.resetTotal=false}if(ProcessLister.refreshRowPageIDs.length>0){b.row_page_id=ProcessLister.refreshRowPageIDs.join(",");ProcessLister.resetTotal=false}$.ajax({url:c,type:"POST",data:b,success:ProcessLister._submitSuccess,error:function(h){ProcessLister.results.html("<p>Error retrieving results: "+h+"</p>")}})},_submitSuccess:function(g){if(ProcessLister.refreshRowPageIDs.length){for(var c in ProcessLister.refreshRowPageIDs){var l=ProcessLister.refreshRowPageIDs[c];var h="#page"+l;var b=$(h).closest("tr");var j=$(g).find(h).closest("tr");var o=b.find(".actions_toggle").attr("data-message");if(b.length&&j.length){b.replaceWith(j);j.addClass("row_refreshed_"+l);j.effect("highlight","normal");if(o){var i=$("<span class='row_message notes'>"+o+"</span>");j.find(".actions_toggle").addClass("row_message_on").closest(".col_preview, td").append(i);setTimeout(function(){i.fadeOut("normal",function(){j.find(".actions_toggle").removeClass("row_message_on").click()})},1000)}if(j.find(".Inputfield").length){InputfieldsInit(j)}}}ProcessLister.refreshRowPageIDs=[]}else{var f=$("#lister_sort").val();ProcessLister.results.html(g).find("table.ProcessListerTable > thead th").each(function(){var q=$(this).find("b");var d=q.text();q.remove();$(this).find("span").remove();var n=$(this).find("i");var p=$(this).text();if(d==f){$(this).html("<u>"+p+"</u><span>&nbsp;&darr;</span><b>"+d+"</b>")}else{if(f=="-"+d){$(this).html("<u>"+p+"</u><span>&nbsp;&uarr;</span><b>"+d+"</b>")}else{$(this).html(p+"<b>"+d+"</b>")}}if(n.length>0){$(this).prepend(n)}}).end().effect("highlight","fast");if(ProcessLister.results.find(".Inputfield").length){InputfieldsInit(ProcessLister.results)}}if(ProcessLister.clickAfterRefresh.length>0){if(ProcessLister.clickAfterRefresh.indexOf("#")<0&&ProcessLister.clickAfterRefresh.indexOf(".")<0){ProcessLister.clickAfterRefresh="#"+ProcessLister.clickAfterRefresh}$(ProcessLister.clickAfterRefresh).each(function(){var n=$(this);n.click();var d=n.closest("tr");d.fadeTo(100,0.1);setTimeout(function(){d.fadeTo(250,1)},250)});ProcessLister.clickAfterRefresh=""}ProcessLister.spinner.fadeOut();setTimeout(function(){ProcessLister.results.trigger("loaded");ProcessLister.results.find(".Inputfield:not(.reloaded)").addClass("reloaded").trigger("reloaded",["ProcessPageLister"]);$("a.actions_toggle.open").click().removeClass("open");if(typeof AdminDataTable!="undefined"){AdminDataTable.init()}$("a.lister-lightbox",ProcessLister.results).magnificPopup({type:"image",closeOnContentClick:true,closeBtnInside:true})},250);var m=g.indexOf("ProcessListerScript");if(m){var a=g.substring(m+21);if(a!="</div>"){m=a.indexOf("</div>");a=a.substring(0,m);$("body").append("<script>"+a+"<\/script>")}}if(g.indexOf("<\/script>")>-1){var k=document.createElement("div");k.innerHTML=g;var e=k.querySelectorAll(".Inputfield script");$(e).each(function(){$.globalEval(this.text||this.textContent||this.innerHTML||"")})}},_refreshRow:function(a,b){if(typeof a=="string"&&a.indexOf("page")>-1){a=parseInt(a.substring(4))}if(a>0){if(typeof b!="undefined"){$("#page"+a).attr("data-message",b)}ProcessLister.refreshRowPageIDs[a]=a;return true}else{return false}},refreshRow:function(a,b){if(ProcessLister._refreshRow(parseInt(a),b)){ProcessLister.submit()}},refreshRows:function(a){var c=0;for(var d in a){var b=parseInt(a[d]);if(ProcessLister._refreshRow(b,"")){c++}}if(c){ProcessLister.submit()}},refreshAll:function(){var a=ProcessLister.results.find(".MarkupPagerNavOn a");if(a.length==0){a=$("#submit_refresh")}if(a.length==0){a=$("#_ProcessListerRefreshTab")}a.click()},pageClick:function(){var b=$(this);if(b.hasClass("row_message_on")){return false}var e=b.closest("tr");var d=b.next(".actions");var a=d.find(".PageExtra").hide();var c=d.find(".PageExtras");var f=d.find("a:not(.PageExtra):not(.PageExtras)");if(e.is(".open")){d.hide();e.removeClass("open");return false}else{d.css("display","inline-block");e.addClass("open");if(c.hasClass("extras-open")){c.find("i.fa").toggleClass("fa-flip-horizontal");c.removeClass("extras-open")}a.hide();f.show()}if($("body").hasClass("AdminThemeDefault")){c.addClass("ui-priority-secondary")}c.unbind("click").click(function(){var g=$(this);if(g.hasClass("extras-open")){a.hide();f.show();g.removeClass("extras-open")}else{f.hide();a.show();g.addClass("extras-open")}g.children("i.fa").toggleClass("fa-flip-horizontal");return false});return false},getPageID:function(a){if(!a.is("tr")){a=a.closest("tr")}if(!a.length){return 0}return parseInt(a.attr("data-pid"))},actionClickAjax:function(){var d=$(this);var a=d.closest("td").find(".actions_toggle");var g=parseInt(a.attr("id").replace("page",""));var j=d.closest(".actions");var b=d.attr("href");var h=b.match(/\?action=([-_a-zA-Z0-9]+)/)[1];var f=$("input._post_token");var e=f.attr("name");var i=f.attr("value");var c={action:h,id:g,ProcessPageLister:1};c[e]=i;j.after("<i class='fa fa-spin fa-spinner ui-priority-secondary'></i>");j.hide();$.post(b,c,function(k){if(typeof k.page!="undefined"||k.action=="trash"){ProcessLister.clickAfterRefresh="#page"+k.page;ProcessLister.resetTotal=true}else{ProcessLister.refreshRowPageIDs[g]=g}if(k.message){a.attr("data-message",k.message)}ProcessLister.submit()},"json");return false}};$(document).ready(function(){ProcessLister.init()});