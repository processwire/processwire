function ProcessPageListInit(){if(ProcessWire.config.ProcessPageList){$("#"+ProcessWire.config.ProcessPageList.containerID).ProcessPageList(ProcessWire.config.ProcessPageList)}}$(document).ready(function(){ProcessPageListInit()});(function(a){a.fn.ProcessPageList=function(c){var d={mode:"",limit:35,rootPageID:0,showRootPage:true,selectedPageID:0,adminPageID:2,trashPageID:7,langID:0,selectAllowUnselect:false,selectShowPageHeader:true,selectShowPath:true,selectStartLabel:"Change",selectCancelLabel:"Cancel",selectSelectLabel:"Select",selectUnselectLabel:"Unselect",moreLabel:"More",trashLabel:"Trash",moveInstructionLabel:"Click and drag to move",selectSelectHref:"#",selectUnselectHref:"#",ajaxURL:ProcessWire.config.urls.admin+"page/list/",ajaxMoveURL:ProcessWire.config.urls.admin+"page/sort/",paginationClass:"PageListPagination",paginationCurrentClass:"PageListPaginationCurrent",paginationLinkClass:"ui-state-default",paginationLinkCurrentClass:"ui-state-active",paginationHoverClass:"ui-state-hover",paginationDisabledClass:"ui-priority-secondary",openPagination:0,openPageIDs:[],openPageData:{},speed:200,useHoverActions:false,hoverActionDelay:250,hoverActionFade:150,spinnerMarkup:"<span class='PageListLoading'><i class='ui-priority-secondary fa fa-fw fa-spin fa-spinner'></i></span>",labelName:""};var b=[];var f=false;var e=a("body").hasClass("modal");a.extend(d,c);return this.each(function(l){var v=a(this);var E;var u=a(d.spinnerMarkup);var F=0;var h=0;function y(){E=a("<div class='PageListRoot'></div>");if(v.is(":input")){d.selectedPageID=v.val();if(!d.selectedPageID.length){d.selectedPageID=0}d.mode="select";v.before(E);C()}else{d.mode="actions";v.append(E);m(d.rootPageID>0?d.rootPageID:1,E,0,true)}if(d.useHoverActions){E.addClass("PageListUseHoverActions");o()}}function o(){var I=null;var J=null;var H=null;function G(L){var M=L.find(".PageListActions");if(!M.is(":visible")||L.hasClass("PageListItemOpen")){L.addClass("PageListItemHover");M.css("display","inline").css("opacity",0).animate({opacity:1},d.hoverActionFade)}}function K(L){var M=L.find(".PageListActions");L.removeClass("PageListItemHover");if(M.is(":visible")){M.animate({opacity:0},d.hoverActionFade,function(){M.hide()})}}a(document).on("keydown",".PageListItem",function(M){M=M||window.event;if(M.keyCode==0||M.keyCode==32){var L=a(this).find(".PageListActions");if(L.is(":visible")){L.css("display","none")}else{L.css("display","inline-block")}return false}});a(document).on("mouseover",".PageListItem",function(N){if(E.is(".PageListSorting")||E.is(".PageListSortSaving")){return}if(!a(this).children("a:first").is(":hover")){return}H=a(this);if(H.hasClass("PageListItemHover")){return}var L=a(this);if(I){clearTimeout(I)}var M=d.hoverActionDelay;I=setTimeout(function(){if(H.attr("class")==L.attr("class")){if(!H.children("a:first").is(":hover")){return}var O=a(".PageListItemHover");G(H);O.each(function(){K(a(this))})}},M)}).on("mouseout",".PageListItem",function(N){if(E.is(".PageListSorting")||E.is(".PageListSortSaving")){return}var L=a(this);if(L.hasClass("PageListItemOpen")){return}if(!L.hasClass("PageListItemHover")){return}var M=d.hoverActionDelay*0.7;J=setTimeout(function(){if(L.is(":hover")){return}if(L.attr("class")==H.attr("class")){return}K(L)},M)})}function C(){var G=a("<ul></ul>").addClass("PageListActions PageListSelectActions actions");var I=a("<p></p>").addClass("PageListSelectName");if(d.selectShowPageHeader){I.append(u)}var J=a("<a></a>").addClass("PageListSelectActionToggle").attr("href","#").text(d.selectStartLabel).click(function(){if(a(this).text()==d.selectStartLabel){m(d.rootPageID>0?d.rootPageID:1,E,0,true);a(this).text(d.selectCancelLabel)}else{E.children(".PageList").slideUp(d.speed,function(){a(this).remove()});a(this).text(d.selectStartLabel)}return false});G.append(a("<li></li>").append(J));E.append(a("<div></div>").addClass("PageListSelectHeader").append(I).append(G));if(d.selectShowPageHeader){var H=d.ajaxURL+"?id="+d.selectedPageID+"&render=JSON&start=0&limit=0&lang="+d.langID+"&mode="+d.mode;if(d.labelName.length){H+="&labelName="+d.labelName}a.getJSON(H,function(M){var K="";if(d.selectShowPath){K=M.page.path;if(K.substring(-1)=="/"){K=K.substring(0,K.length-1)}K=K.substring(0,K.lastIndexOf("/")+1);K='<span class="detail">'+K+"</span> "}var L=d.selectedPageID>0?K+M.page.label:"";E.children(".PageListSelectHeader").find(".PageListSelectName").html(L)})}}function x(){f=false}function z(G,H,N,R){var P=9;var I=Math.ceil(R/N);h=H>=N?Math.floor(H/N):0;if(h==0){F=0}else{if((h-P+1)>F){F=h-Math.floor(P/2)}else{if(F>0&&h==F){F=h-Math.ceil(P/2)}}}if(F>I-P){F=I-P}if(F<0){F=0}var O=a("<ul></ul>").addClass(d.paginationClass).data("paginationInfo",{start:H,limit:N,total:R});var Q=function(aa){var U=a(this).parents("ul."+d.paginationClass);var Z=U.data("paginationInfo");if(!Z){return false}var ab=parseInt(a(this).attr("href"))*Z.limit;if(ab===NaN){ab=0}var V=z(G,ab,Z.limit,Z.total);var X=a(d.spinnerMarkup);var Y=a("<li>&nbsp;</li>").addClass(d.paginationDisabledClass).append(X.hide());U.siblings(".PageList").remove();U.replaceWith(V);V.append(Y);X.fadeIn("fast");var W=V.siblings().css("opacity",0.5);m(G,V.parent(),a(this).attr("href")*Z.limit,false,false,true,function(){X.fadeOut("fast",function(){Y.remove()});V.parent(".PageList").prev(".PageListItem").data("start",ab);g()});return false};var M=null;var J=null;for(var T=F,K=0;T<I;T++,K++){var L=a("<a></a>").html(T+1).attr("href",T).addClass(d.paginationLinkClass);var S=a("<li></li>").addClass(d.paginationClass+K).append(L);if(T==h){S.addClass(d.paginationCurrentClass).find("a").removeClass(d.paginationLinkClass).addClass(d.paginationLinkCurrentClass)}O.append(S);if(!J){J=S.clone().removeClass(d.paginationCurrentClass+" "+d.paginationLinkCurrentClass);J.find("a").removeClass(d.paginationLinkCurrentClass).addClass(d.paginationLinkClass)}if(!M){M=J.clone().removeClass(d.paginationLinkClass).addClass(d.paginationDisabledClass).html("&hellip;")}if(K>=P&&T<I){$lastItem=J.clone();$lastItem.find("a").text(I).attr("href",I-1);O.append(M.clone()).append($lastItem);break}}if(F>0){$firstItem=J.clone();$firstItem.find("a").text("1").attr("href","0").click(Q);O.prepend(M.clone()).prepend($firstItem)}if(h+1<I){$nextBtn=J.clone();$nextBtn.find("a").html("<i class='fa fa-angle-right'></i>").attr("href",h+1);O.append($nextBtn)}if(h>0){$prevBtn=J.clone();$prevBtn.find("a").attr("href",h-1).html("<i class='fa fa-angle-left'></i>");O.prepend($prevBtn)}O.find("a").click(Q).hover(function(){a(this).addClass(d.paginationHoverClass)},function(){a(this).removeClass(d.paginationHoverClass)});return O}function m(H,K,I,M,P,J,O){if(P==undefined){P=true}if(J==undefined){J=false}var L=function(U){if(U&&U.error){ProcessWire.alert(U.message);u.hide();f=false;return}var Q=k(a(U.children));var T=U.start+U.limit;if(U.page.numChildren>T){var S=a("<a></a>").attr("href",T).data("pageId",H).text(d.moreLabel).click(B);Q.append(a("<ul></ul>").addClass("PageListActions actions").append(a("<li></li>").addClass("PageListActionMore").append(S)))}if(P&&(U.page.numChildren>T||U.start>0)){Q.prepend(z(H,U.start,U.limit,U.page.numChildren))}Q.hide();if(M){var V;V=k(a(U.page));if(d.showRootPage){V.children(".PageListItem").addClass("PageListItemOpen")}else{V.children(".PageListItem").hide().parent(".PageList").addClass("PageListRootHidden")}V.append(Q);K.append(V)}else{if(K.is(".PageList")){var R=Q.children(".PageListItem, .PageListActions");if(J){K.children(".PageListItem, .PageListActions").replaceWith(R)}else{K.append(R)}}else{K.after(Q)}}if(u.parent().is(".PageListRoot")){u.hide()}else{u.fadeOut("fast")}if(J){Q.show();x();if(O!=undefined){O()}}else{Q.slideDown(d.speed,function(){x();if(O!=undefined){O()}})}Q.prev(".PageListItem").data("start",U.start);K.removeClass("PageListForceReload")};if(!J){K.append(u.fadeIn("fast"))}var N=H+"-"+I;if(typeof d.openPageData[N]!="undefined"&&!K.hasClass("PageListID7")&&!K.hasClass("PageListForceReload")){L(d.openPageData[N]);return}var G=d.ajaxURL+"?id="+H+"&render=JSON&start="+I+"&lang="+d.langID+"&open="+d.openPageIDs[0]+"&mode="+d.mode;if(d.labelName.length){G+="&labelName="+d.labelName}a.getJSON(G).done(function(R,S,Q){L(R)}).fail(function(Q,S,R){L({error:1,message:!Q.status?d.ajaxNetworkError:d.ajaxUnknownError})})}function k(G){var I=a("<div></div>").addClass("PageList");var H=I;G.each(function(K,J){H.append(j(J))});s(H);return I}function s(G){a("a.PageListPage",G).click(t);a(".PageListActionMove a",G).click(i);a(".PageListActionSelect a",G).click(A);a(".PageListTriggerOpen:not(.PageListID1) > a.PageListPage",G).click();a(".PageListActionExtras > a:not(.clickExtras)",G).addClass("clickExtras").on("click",p)}function j(M){var L=a("<div></div>").data("pageId",M.id).addClass("PageListItem").addClass("PageListTemplate_"+M.template);var K=a("<a></a>").attr("href","#").attr("title",M.path).html(M.label).addClass("PageListPage label");L.addClass("PageListID"+M.id);if(M.status==0){L.addClass("PageListStatusOff disabled")}if(M.status&2048){L.addClass("PageListStatusUnpublished secondary")}if(M.status&1024){L.addClass("PageListStatusHidden secondary")}if(M.status&512){L.addClass("PageListStatusTemp secondary")}if(M.status&16){L.addClass("PageListStatusSystem")}if(M.status&8){L.addClass("PageListStatusSystem")}if(M.status&4){L.addClass("PageListStatusLocked")}if(M.addClass&&M.addClass.length){L.addClass(M.addClass)}if(M.type&&M.type.length>0){if(M.type=="System"){L.addClass("PageListStatusSystem")}}a(d.openPageIDs).each(function(O,N){N=parseInt(N);if(M.id==N){L.addClass("PageListTriggerOpen")}});L.append(K);var I=a("<span>"+(M.numChildren?M.numChildren:"")+"</span>").addClass("PageListNumChildren detail");L.append(I);if(M.note&&M.note.length){L.append(a("<span>"+M.note+"</span>").addClass("PageListNote detail"))}var J=a("<ul></ul>").addClass("PageListActions actions");var H=d.rootPageID==M.id?[]:[{name:d.selectSelectLabel,url:d.selectSelectHref}];if(d.mode=="actions"){H=M.actions}else{if(d.selectAllowUnselect){if(M.id==v.val()){H=[{name:d.selectUnselectLabel,url:d.selectUnselectHref}]}}}var G=null;a(H).each(function(R,P){var N;if(P.name==d.selectSelectLabel){N="Select"}else{if(P.name==d.selectUnselectLabel){N="Select"}else{N=P.cn}}var O=a("<a></a>").html(P.name).attr("href",P.url);if(!e){if(P.cn=="Edit"){O.addClass("pw-modal pw-modal-large pw-modal-longclick");O.attr("data-buttons","#ProcessPageEdit > .Inputfields > .InputfieldSubmit .ui-button")}else{if(P.cn=="View"){O.addClass("pw-modal pw-modal-large pw-modal-longclick")}}}if(typeof P.extras!="undefined"){O.data("extras",P.extras)}var Q=a("<li></li>").addClass("PageListAction"+N).append(O);if(N=="Extras"){G=Q}else{J.append(Q)}});if(G){J.append(G);G.addClass("ui-priority-secondary")}L.append(J);return L}function p(N){var H=a(this);var J=H.data("extras");if(typeof J=="undefined"){return false}var Q=H.closest(".PageListItem");var R=H.closest(".PageListActions");var L=null;var O=H.children("i.fa");var P=R.find("li.PageListActionExtra");O.toggleClass("fa-flip-horizontal");if(P.length){P.fadeOut(100,function(){P.remove()});return false}for(var I in J){var G=J[I];var M=a("<a />").addClass("PageListActionExtra PageListAction"+G.cn).attr("href",G.url).html(G.name);if(typeof G.ajax!="undefined"&&G.ajax==true){M.click(function(){Q.find(".PageListActions").hide();var Y=a(d.spinnerMarkup);var V=a(this).attr("href");var U=V.match(/[\?&]action=([-_a-zA-Z0-9]+)/)[1];var T=parseInt(V.match(/[\?&]id=([0-9]+)/)[1]);var X=a("#PageListContainer").attr("data-token-name");var W=a("#PageListContainer").attr("data-token-value");var S={action:U,id:T};S[X]=W;Q.append(Y);a.post(V+"&render=json",S,function(Z){if(Z.success){Q.fadeOut("fast",function(){var af=false;var ag=Z.remove;var ae=Z.refreshChildren;var ac=false;if(typeof Z.child!="undefined"){ac=j(Z.child)}else{if(typeof Z.newChild!="undefined"){ac=j(Z.newChild);af=true}}if(ac){var aa=a("<span />").addClass("notes").html(Z.message);aa.prepend("&nbsp;<i class='fa fa-check-square ui-priority-secondary'></i>&nbsp;");ac.append(aa);s(ac)}if(af){Y.fadeOut("normal",function(){Y.remove()});ac.hide();Q.after(ac);ac.slideDown()}else{if(ac){if(Q.hasClass("PageListItemOpen")){ac.addClass("PageListItemOpen")}Q.replaceWith(ac)}}Q.fadeIn("fast",function(){setTimeout(function(){aa.fadeOut("normal",function(){if(ag){var ah=ac.closest(".PageList").prev(".PageListItem").children(".PageListNumChildren");if(ah.length){var ai=parseInt(ah.text());if(ai>0){ah.text(ai-1)}}ac.next(".PageList").fadeOut("fast");ac.fadeOut("fast",function(){ac.remove()})}else{aa.remove()}})},1000)});if(ae){var ab=a(".PageListID"+ae);if(ab.length){ab.addClass("PageListForceReload");var ad=ab.children("a.PageListPage");if(ab.hasClass("PageListItemOpen")){ad.click();setTimeout(function(){ad.click()},250)}else{ad.click()}}}})}else{Y.remove();ProcessWire.alert(Z.message)}});return false})}else{}var K=a("<li />").addClass("PageListActionExtra PageListAction"+G.cn).append(M);M.hide();if(G.cn=="Trash"){Q.addClass("trashable");L=K}else{R.append(K)}}if(L){R.append(L)}R.find(".PageListActionExtra a").fadeIn(50,function(){a(this).css("display","inline-block")});return false}function t(J){var N=a(this);var M=N.parent(".PageListItem");var L=M.data("pageId");if(f&&!M.hasClass("PageListTriggerOpen")){return false}if(E.is(".PageListSorting")||E.is(".PageListSortSaving")){return false}if(M.hasClass("PageListItemOpen")){var G=true;if(M.hasClass("PageListID1")&&!M.hasClass("PageListForceReload")&&d.mode!="select"){var H=a(this).closest(".PageListRoot").find(".PageListItemOpen:not(.PageListID1)");if(H.length){E.find(".PageListItemOpen:not(.PageListID1)").each(function(){a(this).children("a.PageListPage").click()});G=false}}if(G){M.removeClass("PageListItemOpen").next(".PageList").slideUp(d.speed,function(){a(this).remove()})}}else{M.addClass("PageListItemOpen");var I=parseInt(M.children(".PageListNumChildren").text());if(I>0||M.hasClass("PageListForceReload")){f=true;var K=D(L);m(L,M,K,false)}}if(d.mode!="select"){setTimeout(function(){g()},250)}return false}function D(K){var J=0;for(n=0;n<d.openPageIDs.length;n++){var H=d.openPageIDs[n];if(H.indexOf("-")==-1){continue}var I=d.openPageIDs[n].split("-");var G=parseInt(I[0]);if(G==K){J=parseInt(I[1]);break}}return J}function g(){b=[];a(".PageListItemOpen").each(function(){var H=a(this).data("pageId");var G=a(this).data("start");if(typeof G=="undefined"||G===null){G=0}else{var G=parseInt(G)}if(jQuery.inArray(H,b)==-1){b.push(H+"-"+G)}});a.cookie("pagelist_open",b)}function B(J){var L=a(this);var H=L.parent("li").parent("ul.PageListActions");var G=H.parent(".PageList");var K=L.data("pageId");var I=parseInt(L.attr("href"));m(K,G,I,false);H.remove();return false}function i(){if(f){return false}var M=a(this);if(a(".PageListItem:visible").length==1){M.css("text-decoration","line-through").addClass("ui-state-disabled");return false}var L=M.parent("li").parent("ul.PageListActions").parent(".PageListItem");if(L.hasClass("PageListItemOpen")){L.children(".PageListPage").click()}E.find(".PageListItemOpen").each(function(){var O=a(this).children(".PageListNumChildren").text();if(parseInt(O)>1&&a(this).next().find(".PageList:visible").size()==0){return}var N=a("<div></div>").addClass("PageListPlaceholder").addClass("PageList");N.append(a("<div></div>").addClass("PageListItem PageListPlaceholderItem").html("&nbsp;"));a(this).after(N)});var K={stop:q,helper:"PageListItemHelper",items:".PageListItem:not(.PageListItemOpen)",placeholder:"PageListSortPlaceholder",start:function(O,N){a(".PageListSortPlaceholder").css("width",N.item.children(".PageListPage").outerWidth()+"px")}};var H=E.children(".PageList").children(".PageList");var G=a("<a href='#'>"+d.selectCancelLabel+"</a>").click(function(){return r(L)});var J=L.children("ul.PageListActions");var I=a("<span class='PageListMoveNote detail'><i class='fa fa-fw fa-sort'></i> "+d.moveInstructionLabel+"<i class='fa fa-fw fa-angle-left'></i></span>");I.append(G);J.before(I);L.addClass("PageListSortItem");L.parent(".PageList").attr("id","PageListMoveFrom");E.addClass("PageListSorting");H.addClass("PageListSortingList").sortable(K);return false}function r(H){var G=E.find(".PageListSortingList");G.sortable("destroy").removeClass("PageListSortingList");H.removeClass("PageListSortItem").parent(".PageList").removeAttr("id");H.find(".PageListMoveNote").remove();E.find(".PageListPlaceholder").remove();E.removeClass("PageListSorting");return false}function w(J){var G=E.find(".PageListID"+d.trashPageID);if(!G.hasClass("PageListItemOpen")){E.removeClass("PageListSorting");G.children("a").click();E.addClass("PageListSorting")}var H=G.next(".PageList");if(H.length==0){H=a("<div class='PageList'></div>");G.after(H)}H.prepend(J);var I={item:J};q(null,I)}function q(M,R){var O=R.item;var J=O.children(".PageListPage");var H=parseInt(O.data("pageId"));var L=O.parent(".PageList");var P=a("#PageListMoveFrom");var Q=L.prev().is(".PageListItem")?L.prev():L.prev().prev();var N=parseInt(Q.data("pageId"));var I=O.prev(".PageListItem");if(I.is(".PageListItemOpen")){return false}if(L.is(".PageListPlaceholder")){L.removeClass("PageListPlaceholder").children(".PageListPlaceholderItem").remove()}E.addClass("PageListSortSaving");r(O);O.append(u.fadeIn("fast"));var K="";L.children(".PageListItem").each(function(){K+=a(this).data("pageId")+","});var G={id:H,parent_id:N,sort:K};G[a("#PageListContainer").attr("data-token-name")]=a("#PageListContainer").attr("data-token-value");var S="unknown";a.post(d.ajaxMoveURL,G,function(V){u.fadeOut("fast");J.fadeOut("fast",function(){a(this).fadeIn("fast");O.removeClass("PageListSortItem");E.removeClass("PageListSorting")});if(V&&V.error){ProcessWire.alert(V.message)}if(!L.is("#PageListMoveFrom")){var U=P.prev(".PageListItem");var T=U.children(".PageListNumChildren");var X=T.text().length>0?parseInt(T.text())-1:0;if(X==0){X="";P.remove()}T.text(X);var W=L.prev(".PageListItem");T=W.children(".PageListNumChildren");X=T.text().length>0?parseInt(T.text())+1:1;T.text(X)}P.attr("id","");E.removeClass("PageListSortSaving")},"json");O.trigger("pageMoved");return true}function A(){var M=a(this);var L=M.parent("li").parent("ul.PageListActions").parent(".PageListItem");var K=L.data("pageId");var I=L.children(".PageListPage");var J=I.text();var H=I.attr("title");var G=E.children(".PageListSelectHeader");if(M.text()==d.selectUnselectLabel){K=0;J=""}if(K!=v.val()){v.val(K).change()}if(d.selectShowPageHeader){G.children(".PageListSelectName").text(J)}v.trigger("pageSelected",{id:K,url:H,title:J,a:I});G.find(".PageListSelectActionToggle").click();if(d.selectSelectHref=="#"){return false}return true}y()})}})(jQuery);