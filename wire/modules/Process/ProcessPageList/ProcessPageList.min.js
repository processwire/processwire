function ProcessPageListInit(){if(ProcessWire.config.ProcessPageList){$("#"+ProcessWire.config.ProcessPageList.containerID).ProcessPageList(ProcessWire.config.ProcessPageList)}}$(document).ready(function(){ProcessPageListInit()});(function(a){a.fn.ProcessPageList=function(c){var d={mode:"",limit:35,rootPageID:0,showRootPage:true,selectedPageID:0,adminPageID:2,trashPageID:7,langID:0,selectAllowUnselect:false,selectShowPageHeader:true,selectShowPath:true,selectStartLabel:"Change",selectCancelLabel:"Cancel",selectSelectLabel:"Select",selectUnselectLabel:"Unselect",moreLabel:"More",trashLabel:"Trash",moveInstructionLabel:"Click and drag to move",selectSelectHref:"#",selectUnselectHref:"#",ajaxURL:ProcessWire.config.urls.admin+"page/list/",ajaxMoveURL:ProcessWire.config.urls.admin+"page/sort/",paginationClass:"PageListPagination",paginationCurrentClass:"PageListPaginationCurrent",paginationLinkClass:"ui-state-default",paginationLinkCurrentClass:"ui-state-active",paginationHoverClass:"ui-state-hover",paginationDisabledClass:"ui-priority-secondary",openPagination:0,openPageIDs:[],openPageData:{},speed:200,useHoverActions:false,hoverActionDelay:250,hoverActionFade:150,useNarrowActions:a("body").hasClass("pw-narrow-width"),spinnerMarkup:"<span class='PageListLoading'><i class='ui-priority-secondary fa fa-fw fa-spin fa-spinner'></i></span>",labelName:""};var b=[];var f=false;var e=a("body").hasClass("modal")||a("body").hasClass("pw-iframe");if(typeof ProcessWire.config.ProcessPageList!="undefined"){a.extend(d,ProcessWire.config.ProcessPageList)}a.extend(d,c);return this.each(function(l){var w=a(this);var s;var F;var v=a(d.spinnerMarkup);var H=0;var h=0;function z(){F=a("<div class='PageListRoot'></div>");if(w.is(":input")){d.selectedPageID=w.val();if(!d.selectedPageID.length){d.selectedPageID=0}d.mode="select";w.before(F);s=w.closest(".InputfieldContent");D()}else{d.mode="actions";w.append(F);s=w;m(d.rootPageID>0?d.rootPageID:1,F,0,true)}a(document).on("pageListRefresh",function(J,I){G(I)});if(d.useHoverActions){F.addClass("PageListUseHoverActions");o()}}function o(){var K=null;var L=null;var J=null;function I(N){var O=N.find(".PageListActions");if(!O.is(":visible")||N.hasClass("PageListItemOpen")){N.addClass("PageListItemHover");O.css("display","inline").css("opacity",0).animate({opacity:1},d.hoverActionFade)}}function M(N){var O=N.find(".PageListActions");N.removeClass("PageListItemHover");if(O.is(":visible")){O.animate({opacity:0},d.hoverActionFade,function(){O.hide()})}}s.on("keydown",".PageListItem",function(O){O=O||window.event;if(O.keyCode==0||O.keyCode==32){var N=a(this).find(".PageListActions");if(N.is(":visible")){N.css("display","none")}else{N.css("display","inline-block")}return false}});s.on("mouseover",".PageListItem",function(P){if(F.is(".PageListSorting")||F.is(".PageListSortSaving")){return}if(!a(this).children("a:first").is(":hover")){return}J=a(this);if(J.hasClass("PageListItemHover")){return}var N=a(this);if(K){clearTimeout(K)}var O=d.hoverActionDelay;K=setTimeout(function(){if(J.attr("class")==N.attr("class")){if(!J.children("a:first").is(":hover")){return}var Q=s.find(".PageListItemHover");I(J);Q.each(function(){M(a(this))})}},O)}).on("mouseout",".PageListItem",function(P){if(F.is(".PageListSorting")||F.is(".PageListSortSaving")){return}var N=a(this);if(N.hasClass("PageListItemOpen")){return}if(!N.hasClass("PageListItemHover")){return}var O=d.hoverActionDelay*0.7;L=setTimeout(function(){if(N.is(":hover")){return}if(N.attr("class")==J.attr("class")){return}M(N)},O)})}function D(){var I=a("<ul></ul>").addClass("PageListActions PageListSelectActions actions");var K=a("<p></p>").addClass("PageListSelectName");if(d.selectShowPageHeader){K.append(v)}var L=a("<a></a>").addClass("PageListSelectActionToggle").attr("href","#").text(d.selectStartLabel).click(function(){if(a(this).text()==d.selectStartLabel){m(d.rootPageID>0?d.rootPageID:1,F,0,true);a(this).text(d.selectCancelLabel)}else{F.children(".PageList").slideUp(d.speed,function(){a(this).remove()});a(this).text(d.selectStartLabel)}return false});I.append(a("<li></li>").append(L));F.append(a("<div></div>").addClass("PageListSelectHeader").append(K).append(I));if(d.selectShowPageHeader){var J=d.ajaxURL+"?id="+d.selectedPageID+"&render=JSON&start=0&limit=0&lang="+d.langID+"&mode="+d.mode;if(d.labelName.length){J+="&labelName="+d.labelName}a.getJSON(J,function(O){var M="";if(d.selectShowPath){M=O.page.path;if(M.substring(-1)=="/"){M=M.substring(0,M.length-1)}M=M.substring(0,M.lastIndexOf("/")+1);M='<span class="detail">'+M+"</span> "}var N=d.selectedPageID>0?M+O.page.label:"";F.children(".PageListSelectHeader").find(".PageListSelectName").html(N)})}}function y(){f=false}function A(I,J,P,T){var R=9;var K=Math.ceil(T/P);h=J>=P?Math.floor(J/P):0;if(h==0){H=0}else{if((h-R+1)>H){H=h-Math.floor(R/2)}else{if(H>0&&h==H){H=h-Math.ceil(R/2)}}}if(H>K-R){H=K-R}if(H<0){H=0}var Q=a("<ul></ul>").addClass(d.paginationClass).data("paginationInfo",{start:J,limit:P,total:T});var S=function(ac){var W=a(this).parents("ul."+d.paginationClass);var ab=W.data("paginationInfo");if(!ab){return false}var ad=parseInt(a(this).attr("href"))*ab.limit;if(ad===NaN){ad=0}var X=A(I,ad,ab.limit,ab.total);var Z=a(d.spinnerMarkup);var aa=a("<li>&nbsp;</li>").addClass(d.paginationDisabledClass).append(Z.hide());W.siblings(".PageList").remove();W.replaceWith(X);X.append(aa);Z.fadeIn("fast");var Y=X.siblings().css("opacity",0.5);m(I,X.parent(),a(this).attr("href")*ab.limit,false,false,true,function(){Z.fadeOut("fast",function(){aa.remove()});X.parent(".PageList").prev(".PageListItem").data("start",ad);g()});return false};var O=null;var L=null;for(var V=H,M=0;V<K;V++,M++){var N=a("<a></a>").html(V+1).attr("href",V).addClass(d.paginationLinkClass);var U=a("<li></li>").addClass(d.paginationClass+M).append(N);if(V==h){U.addClass(d.paginationCurrentClass).find("a").removeClass(d.paginationLinkClass).addClass(d.paginationLinkCurrentClass)}Q.append(U);if(!L){L=U.clone().removeClass(d.paginationCurrentClass+" "+d.paginationLinkCurrentClass);L.find("a").removeClass(d.paginationLinkCurrentClass).addClass(d.paginationLinkClass)}if(!O){O=L.clone().removeClass(d.paginationLinkClass).addClass(d.paginationDisabledClass).html("&hellip;")}if(M>=R&&V<K){$lastItem=L.clone();$lastItem.find("a").text(K).attr("href",K-1);Q.append(O.clone()).append($lastItem);break}}if(H>0){$firstItem=L.clone();$firstItem.find("a").text("1").attr("href","0").click(S);Q.prepend(O.clone()).prepend($firstItem)}if(h+1<K){$nextBtn=L.clone();$nextBtn.find("a").html("<i class='fa fa-angle-right'></i>").attr("href",h+1);Q.append($nextBtn)}if(h>0){$prevBtn=L.clone();$prevBtn.find("a").attr("href",h-1).html("<i class='fa fa-angle-left'></i>");Q.prepend($prevBtn)}Q.find("a").click(S).hover(function(){a(this).addClass(d.paginationHoverClass)},function(){a(this).removeClass(d.paginationHoverClass)});return Q}function m(J,M,K,O,R,L,Q){if(R==undefined){R=true}if(L==undefined){L=false}var N=function(W){if(W&&W.error){ProcessWire.alert(W.message);v.hide();f=false;return}var S=k(a(W.children));var V=W.start+W.limit;if(W.page.numChildren>V){var U=a("<a></a>").attr("href",V).data("pageId",J).text(d.moreLabel).click(C);S.append(a("<ul></ul>").addClass("PageListActions actions").append(a("<li></li>").addClass("PageListActionMore").append(U)))}if(R&&(W.page.numChildren>V||W.start>0)){S.prepend(A(J,W.start,W.limit,W.page.numChildren))}S.hide();if(O){var X;X=k(a(W.page));if(d.showRootPage){X.children(".PageListItem").addClass("PageListItemOpen")}else{X.children(".PageListItem").hide().parent(".PageList").addClass("PageListRootHidden")}X.append(S);M.append(X)}else{if(M.is(".PageList")){var T=S.children(".PageListItem, .PageListActions");if(L){M.children(".PageListItem, .PageListActions").replaceWith(T)}else{M.append(T)}}else{M.after(S)}}if(v.parent().is(".PageListRoot")){v.hide()}else{v.fadeOut("fast")}if(L){S.show();y();if(Q!=undefined){Q()}}else{S.slideDown(d.speed,function(){y();if(Q!=undefined){Q()}})}S.prev(".PageListItem").data("start",W.start);M.removeClass("PageListForceReload")};if(!L){M.append(v.fadeIn("fast"))}var P=J+"-"+K;if(typeof d.openPageData[P]!="undefined"&&!M.hasClass("PageListID7")&&!M.hasClass("PageListForceReload")){N(d.openPageData[P]);return}var I=d.ajaxURL+"?id="+J+"&render=JSON&start="+K+"&lang="+d.langID+"&open="+d.openPageIDs[0]+"&mode="+d.mode;if(d.labelName.length){I+="&labelName="+d.labelName}a.getJSON(I).done(function(T,U,S){N(T)}).fail(function(S,U,T){N({error:1,message:!S.status?d.ajaxNetworkError:d.ajaxUnknownError})})}function k(I){var K=a("<div></div>").addClass("PageList");var J=K;I.each(function(M,L){J.append(j(L))});t(J);return K}function t(I){a("a.PageListPage",I).click(u);I.on("click",".PageListActionMove a",i);a(".PageListActionSelect a",I).click(B);a(".PageListTriggerOpen:not(.PageListID1) > a.PageListPage",I).click();a(".PageListActionExtras > a:not(.clickExtras)",I).addClass("clickExtras").on("click",p)}function j(I){var N=a("<div></div>").data("pageId",I.id).addClass("PageListItem").addClass("PageListTemplate_"+I.template);var J=a("<a></a>").attr("href","#").attr("title",I.path).html(I.label).addClass("PageListPage label");N.addClass(I.numChildren>0?"PageListHasChildren":"PageListNoChildren").addClass("PageListID"+I.id);if(I.status==0){N.addClass("PageListStatusOff disabled")}if(I.status&2048){N.addClass("PageListStatusUnpublished secondary")}if(I.status&1024){N.addClass("PageListStatusHidden secondary")}if(I.status&512){N.addClass("PageListStatusTemp secondary")}if(I.status&16){N.addClass("PageListStatusSystem")}if(I.status&8){N.addClass("PageListStatusSystem")}if(I.status&4){N.addClass("PageListStatusLocked")}if(I.addClass&&I.addClass.length){N.addClass(I.addClass)}if(I.type&&I.type.length>0){if(I.type=="System"){N.addClass("PageListStatusSystem")}}a(d.openPageIDs).each(function(S,R){R=parseInt(R);if(I.id==R){N.addClass("PageListTriggerOpen")}});N.append(J);var K=a("<span>"+(I.numChildren?I.numChildren:"")+"</span>").addClass("PageListNumChildren detail");N.append(K);if(I.note&&I.note.length){N.append(a("<span>"+I.note+"</span>").addClass("PageListNote detail"))}var O=a("<ul></ul>").addClass("PageListActions actions");var Q=d.rootPageID==I.id?[]:[{name:d.selectSelectLabel,url:d.selectSelectHref}];if(d.mode=="actions"){Q=I.actions}else{if(d.selectAllowUnselect){if(I.id==w.val()){Q=[{name:d.selectUnselectLabel,url:d.selectUnselectHref}]}}}var M=null;var P=null;var L={};a(Q).each(function(W,U){var R;if(U.name==d.selectSelectLabel){R="Select"}else{if(U.name==d.selectUnselectLabel){R="Select"}else{R=U.cn;if(d.useNarrowActions&&(R!="Edit"&&R!="View"&&R!="Extras")){L[R]=U;return}}}var T=a("<a></a>").html(U.name).attr("href",U.url);if(!e){if(U.cn=="Edit"){T.addClass("pw-modal pw-modal-large pw-modal-longclick");T.attr("data-buttons","#ProcessPageEdit > .Inputfields > .InputfieldSubmit .ui-button")}else{if(U.cn=="View"){T.addClass("pw-modal pw-modal-large pw-modal-longclick")}}}if(typeof U.extras!="undefined"){for(var S in U.extras){L[S]=U.extras[S]}P=T}var V=a("<li></li>").addClass("PageListAction"+R).append(T);if(R=="Extras"){M=V}else{O.append(V)}});if(P){P.data("extras",L)}if(M){O.append(M);M.addClass("ui-priority-secondary")}N.append(O);return N}function p(P){var J=a(this);var L=J.data("extras");if(typeof L=="undefined"){return false}var S=J.closest(".PageListItem");var T=J.closest(".PageListActions");var N=null;var Q=J.children("i.fa");var R=T.find("li.PageListActionExtra");Q.toggleClass("fa-flip-horizontal");if(R.length){R.fadeOut(100,function(){R.remove()});return false}for(var K in L){var I=L[K];var O=a("<a />").addClass("PageListActionExtra PageListAction"+I.cn).attr("href",I.url).html(I.name);if(typeof I.ajax!="undefined"&&I.ajax==true){O.click(function(){S.find(".PageListActions").hide();var aa=a(d.spinnerMarkup);var X=a(this).attr("href");var W=X.match(/[\?&]action=([-_a-zA-Z0-9]+)/)[1];var V=parseInt(X.match(/[\?&]id=([0-9]+)/)[1]);var Z=a("#PageListContainer").attr("data-token-name");var Y=a("#PageListContainer").attr("data-token-value");var U={action:W,id:V};U[Z]=Y;S.append(aa);a.post(X+"&render=json",U,function(ab){if(ab.success){S.fadeOut("fast",function(){var ah=false;var ai=ab.remove;var ag=ab.refreshChildren;var ae=false;if(typeof ab.child!="undefined"){ae=j(ab.child)}else{if(typeof ab.newChild!="undefined"){ae=j(ab.newChild);ah=true}}if(ae){var ac=a("<span />").addClass("notes").html(ab.message);ac.prepend("&nbsp;<i class='fa fa-check-square ui-priority-secondary'></i>&nbsp;");ae.append(ac);t(ae)}if(ah){aa.fadeOut("normal",function(){aa.remove()});ae.hide();S.after(ae);ae.slideDown()}else{if(ae){if(S.hasClass("PageListItemOpen")){ae.addClass("PageListItemOpen")}S.replaceWith(ae)}}S.fadeIn("fast",function(){setTimeout(function(){ac.fadeOut("normal",function(){if(ai){var aj=ae.closest(".PageList").prev(".PageListItem").children(".PageListNumChildren");if(aj.length){var ak=parseInt(aj.text());if(ak>0){aj.text(ak-1)}}ae.next(".PageList").fadeOut("fast");ae.fadeOut("fast",function(){ae.remove()})}else{ac.remove()}})},1000)});if(ag){var ad=a(".PageListID"+ag);if(ad.length){ad.addClass("PageListForceReload");var af=ad.children("a.PageListPage");if(ad.hasClass("PageListItemOpen")){af.click();setTimeout(function(){af.click()},250)}else{af.click()}}}})}else{aa.remove();ProcessWire.alert(ab.message)}});return false})}else{}var M=a("<li />").addClass("PageListActionExtra PageListAction"+I.cn).append(O);O.hide();if(I.cn=="Trash"){S.addClass("trashable");N=M}else{T.append(M)}}if(N){T.append(N)}T.find(".PageListActionExtra a").fadeIn(50,function(){a(this).css("display","inline-block")});return false}function u(L){var P=a(this);var O=P.parent(".PageListItem");var N=O.data("pageId");if(f&&!O.hasClass("PageListTriggerOpen")){return false}if(F.is(".PageListSorting")||F.is(".PageListSortSaving")){return false}if(O.hasClass("PageListItemOpen")){var I=true;if(O.hasClass("PageListID1")&&!O.hasClass("PageListForceReload")&&d.mode!="select"){var J=a(this).closest(".PageListRoot").find(".PageListItemOpen:not(.PageListID1)");if(J.length){F.find(".PageListItemOpen:not(.PageListID1)").each(function(){a(this).children("a.PageListPage").click()});I=false}}if(I){O.removeClass("PageListItemOpen").next(".PageList").slideUp(d.speed,function(){a(this).remove()})}}else{O.addClass("PageListItemOpen");var K=parseInt(O.children(".PageListNumChildren").text());if(K>0||O.hasClass("PageListForceReload")){f=true;var M=E(N);m(N,O,M,false)}}if(d.mode!="select"){setTimeout(function(){g()},250)}return false}function E(M){var L=0;for(n=0;n<d.openPageIDs.length;n++){var J=d.openPageIDs[n];if(J.indexOf("-")==-1){continue}var K=d.openPageIDs[n].split("-");var I=parseInt(K[0]);if(I==M){L=parseInt(K[1]);break}}return L}function g(){b=[];a(".PageListItemOpen").each(function(){var J=a(this).data("pageId");var I=a(this).data("start");if(typeof I=="undefined"||I===null){I=0}else{var I=parseInt(I)}if(jQuery.inArray(J,b)==-1){b.push(J+"-"+I)}});a.cookie("pagelist_open",b)}function G(O,J){var M=a(".PageListID"+O).parent(".PageList");var P=M.prev(".PageListItem");if(!P.length){return}var Q=P.attr("class").match(/PageListID(\d+)/)[1];var I=0;var N=M.children("ul."+d.paginationClass);var R=N.data("paginationInfo");var L=null;if(R){var K=N.find(".pw-link-active");if(K.length){I=parseInt(K.attr("href"))*R.limit}if(I===NaN){I=0}}if(Q==1){L=M.children();M=P}M.addClass("PageListForceReload");m(Q,M,I,false,true,true,function(){if(L&&L.length){L.remove()}})}function C(L){var N=a(this);var J=N.parent("li").parent("ul.PageListActions");var I=J.parent(".PageList");var M=N.data("pageId");var K=parseInt(N.attr("href"));m(M,I,K,false);J.remove();return false}function i(){if(f){return false}var O=a(this);if(a(".PageListItem:visible").length==1){O.css("text-decoration","line-through").addClass("ui-state-disabled");return false}var N=O.parent("li").parent("ul.PageListActions").parent(".PageListItem");if(N.hasClass("PageListItemOpen")){N.children(".PageListPage").click()}F.find(".PageListItemOpen").each(function(){var Q=a(this).children(".PageListNumChildren").text();if(parseInt(Q)>1&&a(this).next().find(".PageList:visible").size()==0){return}var P=a("<div></div>").addClass("PageListPlaceholder").addClass("PageList");P.append(a("<div></div>").addClass("PageListItem PageListPlaceholderItem").html("&nbsp;"));a(this).after(P)});var M={stop:q,helper:"PageListItemHelper",items:".PageListItem:not(.PageListItemOpen)",placeholder:"PageListSortPlaceholder",start:function(Q,P){a(".PageListSortPlaceholder").css("width",P.item.children(".PageListPage").outerWidth()+"px")}};var J=F.children(".PageList").children(".PageList");var I=a("<a href='#'>"+d.selectCancelLabel+"</a>").click(function(){return r(N)});var L=N.children("ul.PageListActions");var K=a("<span class='PageListMoveNote detail'><i class='fa fa-fw fa-sort'></i> "+d.moveInstructionLabel+"<i class='fa fa-fw fa-angle-left'></i></span>");K.append(I);L.before(K);N.addClass("PageListSortItem");N.parent(".PageList").attr("id","PageListMoveFrom");F.addClass("PageListSorting");J.addClass("PageListSortingList").sortable(M);return false}function r(J){var I=F.find(".PageListSortingList");I.sortable("destroy").removeClass("PageListSortingList");J.removeClass("PageListSortItem").parent(".PageList").removeAttr("id");J.find(".PageListMoveNote").remove();F.find(".PageListPlaceholder").remove();F.removeClass("PageListSorting");return false}function x(L){var I=F.find(".PageListID"+d.trashPageID);if(!I.hasClass("PageListItemOpen")){F.removeClass("PageListSorting");I.children("a").click();F.addClass("PageListSorting")}var J=I.next(".PageList");if(J.length==0){J=a("<div class='PageList'></div>");I.after(J)}J.prepend(L);var K={item:L};q(null,K)}function q(O,T){var Q=T.item;var L=Q.children(".PageListPage");var J=parseInt(Q.data("pageId"));var N=Q.parent(".PageList");var R=a("#PageListMoveFrom");var S=N.prev().is(".PageListItem")?N.prev():N.prev().prev();var P=parseInt(S.data("pageId"));var K=Q.prev(".PageListItem");if(K.is(".PageListItemOpen")){return false}if(N.is(".PageListPlaceholder")){N.removeClass("PageListPlaceholder").children(".PageListPlaceholderItem").remove()}F.addClass("PageListSortSaving");r(Q);Q.append(v.fadeIn("fast"));var M="";N.children(".PageListItem").each(function(){M+=a(this).data("pageId")+","});var I={id:J,parent_id:P,sort:M};I[a("#PageListContainer").attr("data-token-name")]=a("#PageListContainer").attr("data-token-value");var U="unknown";a.post(d.ajaxMoveURL,I,function(X){v.fadeOut("fast");L.fadeOut("fast",function(){a(this).fadeIn("fast");Q.removeClass("PageListSortItem");F.removeClass("PageListSorting")});if(X&&X.error){ProcessWire.alert(X.message)}if(!N.is("#PageListMoveFrom")){var W=R.prev(".PageListItem");var V=W.children(".PageListNumChildren");var Z=V.text().length>0?parseInt(V.text())-1:0;if(Z==0){Z="";R.remove()}V.text(Z);var Y=N.prev(".PageListItem");V=Y.children(".PageListNumChildren");Z=V.text().length>0?parseInt(V.text())+1:1;V.text(Z)}R.attr("id","");F.removeClass("PageListSortSaving")},"json");Q.trigger("pageMoved");return true}function B(){var O=a(this);var N=O.parent("li").parent("ul.PageListActions").parent(".PageListItem");var M=N.data("pageId");var K=N.children(".PageListPage");var L=K.text();var J=K.attr("title");var I=F.children(".PageListSelectHeader");if(O.text()==d.selectUnselectLabel){M=0;L=""}if(M!=w.val()){w.val(M).change()}if(d.selectShowPageHeader){I.children(".PageListSelectName").text(L)}w.trigger("pageSelected",{id:M,url:J,title:L,a:K});I.find(".PageListSelectActionToggle").click();if(d.selectSelectHref=="#"){return false}return true}z()})}})(jQuery);