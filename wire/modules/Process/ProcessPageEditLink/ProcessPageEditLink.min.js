$(document).ready(function(){var m={selectStartLabel:ProcessWire.config.ProcessPageEditLink.selectStartLabel,selectSelectLabel:ProcessWire.config.ProcessPageEditLink.selectStartLabel,langID:ProcessWire.config.ProcessPageEditLink.langID};var k={selectStartLabel:m.selectStartLabel,selectSelectLabel:m.selectStartLabel,langID:m.langID,rootPageID:ProcessWire.config.ProcessPageEditLink.pageID};var f={id:0,title:"",url:""};var e=$("#link_page_file");var h=$("#link_page_anchor");var g=$("#link_page_url_input");g.val($("#link_page_url").val());function c(o){var n=$("#wrap_link_page_file");$.getJSON("./files?id="+o.id,function(p){e.empty();e.append("<option></option>");$.each(p,function(q,s){var r=$("<option value='"+q+"'>"+s+"</option>");e.append(r)});n.find("p.notes strong").text(o.url);n.children().effect("highlight",{},500);e.effect("bounce",{},50)})}function i(q){if(ProcessWire.config.ProcessPageEditLink.urlType==0){return q}function n(r){r=r.replace(/\//g,"../");r=r.replace(/[^.\/]/g,"");return r}if(q===ProcessWire.config.ProcessPageEditLink.pageUrl){q="./";if(!ProcessWire.config.ProcessPageEditLink.slashUrls){q+=ProcessWire.config.ProcessPageEditLink.pageName}}else{if(q.indexOf(ProcessWire.config.ProcessPageEditLink.pageUrl)===0){q=q.substring(ProcessWire.config.ProcessPageEditLink.pageUrl.length);if(!ProcessWire.config.ProcessPageEditLink.slashUrls){q=ProcessWire.config.ProcessPageEditLink.pageName+q}}else{if(ProcessWire.config.ProcessPageEditLink.pageUrl.indexOf(q)===0){var o=ProcessWire.config.ProcessPageEditLink.pageUrl.substring(q.length);if(o.indexOf("/")!=-1){o=n(o)}else{o="./"}q=o}else{if(q.indexOf(ProcessWire.config.ProcessPageEditLink.rootParentUrl)===0){var o=q.substring(ProcessWire.config.ProcessPageEditLink.rootParentUrl.length);var p=o;o=n(o)+p;q=o}else{if(ProcessWire.config.ProcessPageEditLink.urlType==2){var o=ProcessWire.config.ProcessPageEditLink.pageUrl.substring(config.urls.root.length);o=n(o);q=q.substring(ProcessWire.config.urls.root.length);q=o+q}}}}}return q}function j(n,o){if(o.url&&o.url.length){f=o;f.url=ProcessWire.config.urls.root+o.url.substring(1);f.url=i(f.url);g.val(f.url).change();if(e.is(":visible")){c(f)}}$(this).parents(".InputfieldInteger").children(".InputfieldHeader").click().parent().find(".PageListSelectHeader").removeClass("hidden").show()}$("#link_page_id").ProcessPageList(m).hide().bind("pageSelected",j);$("#child_page_id").ProcessPageList(k).hide().bind("pageSelected",j);e.change(function(){var o=$(this);var n=o.val();if(n.length){g.val(n).change()}});if(h.length){var l=h.val();h.change(function(){var n=$(this).val();if(n.length){g.val(n);l=n}else{if(g.val()==l){g.val("")}}g.change()})}function d(){if(!g.val().length){$("#link_markup").text("");return}var o=$("<a />");o.attr("href",g.val());var p=$("#link_title");if(p.length&&p.val().length){var s=$("<div />").text(p.val()).html();o.attr("title",s)}var q=$("#link_rel");if(q.length&&q.val().length){o.attr("rel",q.val())}var r=$("#link_target");if(r.length&&r.val().length){o.attr("target",r.val())}var n=$("#wrap_link_class").find("input:checked");if(n.length){n.each(function(){o.addClass($(this).val())})}$("#link_markup").text(o[0].outerHTML)}function a(){var s=g;var G=$.trim(s.val());var q=G.indexOf(".");var t=G.indexOf("//");var o=t>-1&&t<q;var w=(t>-1?G.indexOf("/",t+2):G.indexOf("/"));if(q>-1&&G.indexOf("..")==-1&&G.indexOf("./")==-1&&((w>q&&!o)||(w==-1&&q>1&&G.match(/^[a-z][-a-z.0-9]+\.[a-z]{2,}($|\/)/i)))){var F=G.substring(0,(w>0?w:G.length));o=true;if(s.attr("data-ignore")==F){}else{s.val("http://"+G);s.closest(".InputfieldContent").find(".notes").text("http://"+G);s.attr("data-ignore",F)}}else{if(q>0&&G.indexOf("@")>0&&G.indexOf(":")==-1&&G.match(/^[^@]+@[-.a-z0-9]{2,}\.[a-z]{2,}$/i)){s.val("mailto:"+G);s.addClass("email")}else{if(G.indexOf("@")==-1&&s.hasClass("email")){s.removeClass("email")}}}if(G.substring(0,1)=="#"){s.addClass("anchor")}else{if(s.hasClass("anchor")){s.removeClass("anchor")}}if(o){if(w==-1){w=G.length}var y=(t>-1?G.substring(t+2,w):G.substring(0,w));s.attr("data-httphost",y)}else{s.removeAttr("data-httphost")}function B(){return s.closest(".Inputfield").children(".InputfieldHeader").children("i").eq(0)}var r=false;var y=s.attr("data-httphost");if(y&&y.length){r=true;for(var z=0;z<ProcessWire.config.httpHosts;z++){if(ProcessWire.config.httpHosts[z]==y){r=false;break}}}var v="fa-external-link-square";var x="fa-external-link";var C="fa-envelope-o";var D="fa-flag-o";var E=v+" "+x+" "+C+" "+D;if(r){if(!s.hasClass("external-link")){B().removeClass(E).addClass(x);s.addClass("external-link");var p=ProcessWire.config.ProcessPageEditLink.extLinkTarget;if(p.length>0){$("#link_target").val(p)}var A=ProcessWire.config.ProcessPageEditLink.extLinkRel;if(A.length>0){$("#link_rel").val(A)}var u=ProcessWire.config.ProcessPageEditLink.extLinkClass;if(u.length>0){u=u.split(" ");for(var z=0;z<u.length;z++){$("#link_class_"+u[z]).attr("checked","checked")}}}}else{s.removeClass("external-link");if(s.hasClass("email")){if(!B().hasClass(C)){B().removeClass(E).addClass(C)}}else{if(s.hasClass("anchor")){if(!B().hasClass(D)){B().removeClass(E).addClass(D)}}else{if(!s.hasClass(v)){B().removeClass(E).addClass(v)}}}}d()}var b=null;g.focus().keydown(function(n){if(b){clearTimeout(b)}b=setTimeout(function(){a()},500)});g.change(function(){var o=$(this).val();if(h.length){if(o.substring(0,1)=="#"){var n="";h.children("option").each(function(){if($(this).attr("value")==o){n=o}});h.val(n)}else{if(h.val().length){h.val("")}}}$("#link_page_url").val(o);a()});setTimeout(function(){g.change()},250);$(":input").change(d);$("#link_title").keydown(function(n){d()});$(".InputfieldInteger .InputfieldHeader").click(function(){var p=$(this);var n=p.parent().find(".PageListSelectActionToggle");var o=n.parents(".PageListSelectHeader");if(o.is(".hidden")){return true}o.addClass("hidden").hide();setTimeout(function(){n.click()},250);return true});$("#ProcessPageEditLinkForm").WireTabs({items:$(".WireTab"),id:"PageEditLinkTabs"})});