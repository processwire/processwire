$(document).ready(function(){function e(e){var i=$("#wrap_link_page_file");$.getJSON("./files?id="+e.id,function(t){o.empty(),o.append("<option></option>"),$.each(t,function(e,i){var t=$("<option value='"+e+"'>"+i+"</option>");o.append(t)}),i.find("p.notes strong").text(e.url),i.children().effect("highlight",{},500),o.effect("bounce",{},50)})}function i(e){function i(e){return e=e.replace(/\//g,"../"),e=e.replace(/[^.\/]/g,"")}if(0==ProcessWire.config.ProcessPageEditLink.urlType)return e;if(e===ProcessWire.config.ProcessPageEditLink.pageUrl)e="./",ProcessWire.config.ProcessPageEditLink.slashUrls||(e+=ProcessWire.config.ProcessPageEditLink.pageName);else if(0===e.indexOf(ProcessWire.config.ProcessPageEditLink.pageUrl))e=e.substring(ProcessWire.config.ProcessPageEditLink.pageUrl.length),ProcessWire.config.ProcessPageEditLink.slashUrls||(e=ProcessWire.config.ProcessPageEditLink.pageName+e);else if(0===ProcessWire.config.ProcessPageEditLink.pageUrl.indexOf(e)){var t=ProcessWire.config.ProcessPageEditLink.pageUrl.substring(e.length);t=-1!=t.indexOf("/")?i(t):"./",e=t}else if(0===e.indexOf(ProcessWire.config.ProcessPageEditLink.rootParentUrl)){var t=e.substring(ProcessWire.config.ProcessPageEditLink.rootParentUrl.length),a=t;t=i(t)+a,e=t}else if(2==ProcessWire.config.ProcessPageEditLink.urlType){var t=ProcessWire.config.ProcessPageEditLink.pageUrl.substring(config.urls.root.length);t=i(t),e=e.substring(ProcessWire.config.urls.root.length),e=t+e}return e}function t(t,a){a.url&&a.url.length&&(l=a,l.url=ProcessWire.config.urls.root+a.url.substring(1),l.url=i(l.url),g.val(l.url).change(),o.is(":visible")&&e(l)),$(this).parents(".InputfieldInteger").children(".InputfieldHeader").click().parent().find(".PageListSelectHeader").removeClass("hidden").show()}function a(){if(!g.val().length)return void $("#link_markup").text("");var e=$("<a />");e.attr("href",g.val());var i=$("#link_title");if(i.length&&i.val().length){var t=$("<div />").text(i.val()).html();e.attr("title",t)}d.length&&d.val().length&&e.text(d.val());var a=$("#link_rel");a.length&&a.val().length&&e.attr("rel",a.val());var n=$("#link_target");n.length&&n.val().length&&e.attr("target",n.val());var s=$("#wrap_link_class").find("input:checked");s.length&&s.each(function(){e.addClass($(this).val())}),$("#link_markup").text(e[0].outerHTML)}function n(){function e(){return i.closest(".Inputfield").children(".InputfieldHeader").children("i").eq(0)}var i=g,t=$.trim(i.val()),n=t.indexOf("."),s=t.indexOf("//"),r=s>-1&&n>s,l=s>-1?t.indexOf("/",s+2):t.indexOf("/");if(n>-1&&-1==t.indexOf("..")&&-1==t.indexOf("./")&&(l>n&&!r||-1==l&&n>1&&t.match(/^[a-z][-a-z.0-9]+\.[a-z]{2,}($|\/)/i))){var o=t.substring(0,l>0?l:t.length);r=!0,i.attr("data-ignore")==o||(i.val("http://"+t),i.closest(".InputfieldContent").find(".notes").text("http://"+t),i.attr("data-ignore",o))}else n>0&&t.indexOf("@")>0&&-1==t.indexOf(":")&&t.match(/^[^@]+@[-.a-z0-9]{2,}\.[a-z]{2,}$/i)?(i.val("mailto:"+t),i.addClass("email")):-1==t.indexOf("@")&&i.hasClass("email")&&i.removeClass("email");if("#"==t.substring(0,1)?i.addClass("anchor"):i.hasClass("anchor")&&i.removeClass("anchor"),r){-1==l&&(l=t.length);var c=s>-1?t.substring(s+2,l):t.substring(0,l);i.attr("data-httphost",c)}else i.removeAttr("data-httphost");var d=!1,c=i.attr("data-httphost");if(c&&c.length){d=!0;for(var f=0;f<ProcessWire.config.httpHosts;f++)if(ProcessWire.config.httpHosts[f]==c){d=!1;break}}var h="fa-external-link-square",u="fa-external-link",P="fa-envelope-o",v="fa-flag-o",k=h+" "+u+" "+P+" "+v;if(d){if(!i.hasClass("external-link")){e().removeClass(k).addClass(u),i.addClass("external-link");var p=ProcessWire.config.ProcessPageEditLink.extLinkTarget;p.length>0&&$("#link_target").val(p);var L=ProcessWire.config.ProcessPageEditLink.extLinkRel;L.length>0&&$("#link_rel").val(L);var _=ProcessWire.config.ProcessPageEditLink.extLinkClass;if(_.length>0){_=_.split(" ");for(var f=0;f<_.length;f++)$("#link_class_"+_[f]).attr("checked","checked")}}}else i.removeClass("external-link"),i.hasClass("email")?e().hasClass(P)||e().removeClass(k).addClass(P):i.hasClass("anchor")?e().hasClass(v)||e().removeClass(k).addClass(v):i.hasClass(h)||e().removeClass(k).addClass(h);a()}var s={selectStartLabel:ProcessWire.config.ProcessPageEditLink.selectStartLabel,selectSelectLabel:ProcessWire.config.ProcessPageEditLink.selectStartLabel,langID:ProcessWire.config.ProcessPageEditLink.langID},r={selectStartLabel:s.selectStartLabel,selectSelectLabel:s.selectStartLabel,langID:s.langID,rootPageID:ProcessWire.config.ProcessPageEditLink.pageID},l={id:0,title:"",url:""},o=$("#link_page_file"),c=$("#link_page_anchor"),g=$("#link_page_url_input"),d=$("#link_text");if(g.val($("#link_page_url").val()),$("#link_page_id").ProcessPageList(s).hide().bind("pageSelected",t),$("#child_page_id").ProcessPageList(r).hide().bind("pageSelected",t),o.change(function(){var e=$(this),i=e.val();i.length&&g.val(i).change()}),c.length){var f=c.val();c.change(function(){var e=$(this).val();e.length?(g.val(e),f=e):g.val()==f&&g.val(""),g.change()})}var h=null;g.focus().keydown(function(){h&&clearTimeout(h),h=setTimeout(function(){n()},500)}),g.change(function(){var e=$(this).val();if(c.length)if("#"==e.substring(0,1)){var i="";c.children("option").each(function(){$(this).attr("value")==e&&(i=e)}),c.val(i)}else c.val().length&&c.val("");$("#link_page_url").val(e),n()}),setTimeout(function(){g.change(),d.change()},250),$(":input").change(a),$("#link_title").keydown(function(){a()}),$("#link_text").keyup(function(){a()}),$(".InputfieldInteger .InputfieldHeader").click(function(){var e=$(this),i=e.parent().find(".PageListSelectActionToggle"),t=i.parents(".PageListSelectHeader");return t.is(".hidden")?!0:(t.addClass("hidden").hide(),setTimeout(function(){i.click()},250),!0)}),$("#ProcessPageEditLinkForm").WireTabs({items:$(".WireTab"),id:"PageEditLinkTabs"})});